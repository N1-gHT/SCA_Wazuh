# Security Configuration Assessment
# CIS Checks for Debia Linux 12
#
# This program is an improved version of the cis_debian12.yml from Wazuh
# You can found it at the following links : 
# https://github.com/wazuh/wazuh/blob/main/ruleset/sca/debian/cis_debian12.yml
#
#
# Based on : 
# Center for Internet Security Debian Linux 12 Benchmark v1.1.0 - 26-09-2024
# I try a rework of the ID to make is more simple and legible

policy:
  id: "cis_debian_12"
  file: "cis_debian_12.yml"
  version: "0.1"
  name: "Center for Internet Security Debian Linux 12 Benchmark v1.1.0"
  description: "This document provide prescriptive guidance for establishing a secure configuration posture for Debian 12. This version is pursuing the best guidance for server so there is level 1 and level 2 rule. It's also applicable to workstation but not guarantee for the current version."
  references:
    - https://www.cisecurity.org/cis-benchmarks

requirements:
  title:  "Check of the Debian version"
  description: "Requirements for running the SCA scan"
  condition: all
  rules:
    - "f:/etc/debian_version -> r:12\\."
    - "f:/proc/sys/kernel/ostype -> r:Linux"
    - "f:/etc/os-release -> r:NAME && r:Debian"
    - "f:/etc/os-release -> r:Version= && r:12"

checks:

# 1 - Initial Setup
# 1.1 - Filesystem
# 1.1.1 - Configure filesystem kernel modules
#
#
# 1.1.1.1 Ensure cramfs kernel module is not available. (Automated)
  - id: 1
    title: "Ensure cramfs kernel module is not available."
    description: "The cramfs filesystem type is a compressed read-only Linux filesystem embedded in small footprint systems. A cramfs image can be used without having to first decompress the image."
    rationale: "Removing support for unneeded filesystem types reduces the local attack surface of the system. If this filesystem type is not needed, disable it."
    remediation: "Create or edit a file in /etc/modprobe.d/ .Add the following lines in it `install cramfs /bin/false or /bin.true` and `blacklist cramfs`. Then run `modprobe -r cramfs 2>/dev/null; rmmod cramfs 2>/dev/null` to remove cramfs from the kernel."
    level: "Level 1"
    references: 
      - ""
    compliance:
      - cis: ["1.1.1.1"]
      - others: ["unknow"]
    condition: all
    rules: 
      - 'c:modprobe -n -v cramfs -> r:^\s*install\s+/bin/false | ^\s*install\s+/bin/true'
      - 'c:modprobe --showconfig | grep blacklist -> r:^\s*blacklist\s+cramfs'
      - 'not c:lsmod -> r:^cramfs\s'

# 1.1.1.2 Ensure freevxfs kernel module is not available. (Automated)
  - id: 2
    title: "Ensure freevxfs kernel module is not available."
    description: "The freevxfs filesystem type is a free version of the Veritas type filesystem. This is the primary filesystem type for HP-UX operating systems."
    rationale: "Removing support for unneeded filesystem types reduces the local attack surface of the system. If this filesystem type is not needed, disable it."
    remediation: "Create or edit a file in /etc/modprobe.d/ .Add the following lines in it `install freevxfs /bin/(false|true)` and `blacklist freevxfs`. Then run `modprobe -r freevxfs 2>/dev/null; rmmod freevxfs 2>/dev/null` to remove freevxfs from the kernel."
    level: "Level 1"
    references: 
      - ""
    compliance:
      - cis: ["1.1.1.2"]
      - others: ["unknow"]
    condition: all
    rules: 
      - 'c:modprobe -n -v freevxfs -> r:^\s*install\s+/bin/false | ^\s*install\s+/bin/true'
      - 'c: modprobe --showconfig | grep blacklist -> r:^\s*blacklist\s+freevxfs'
      - 'not c:lsmod -> r:^freevxfs\s'

# 1.1.1.3 Ensure hfs kernel module is not available. (Automated)
  - id: 3
    title: 'Ensure hfs kernel module is not available.'
    description: "The hfs filesystem type is a hierarchical filesystem that allows you to mount Mac OS filesystems."
    rationale: "Removing support for unneeded filesystem types reduces the local attack surface of the system. If this filesystem type is not needed, disable it."
    remediation: "Create or edit a file in /etc/modprobe.d/ .Add the following lines in it `install hfs /bin/(false|true)` and `blacklist hfs`. Then run `modprobe -r hfs 2>/dev/null; rmmod hfs 2>/dev/null` to remove hfs from the kernel."
    level: "Level 1"
    references: 
      - ""
    compliance:
      - cis: ["1.1.1.3"]
      - others: ["unknow"]
    condition: all
    rules: 
      - 'c:modprobe -n -v hfs -> r:^\s*install\s+/bin/false | ^\s*install\s+/bin/true'
      - 'c:modprobe --showconfig | grep blacklist -> r:^\s*blacklist\s+hfs'
      - 'not c:lsmod -> r:^hfs\s'

# 1.1.1.4 Ensure hfsplus  kernel module is not available. (Automated)
  - id: 4
    title: "Ensure hfs kernel module is not available."
    description: "The hfsplus filesystem type is a hierarchical filesystem that allows you to mount Mac OS filesystems."
    rationale: "Removing support for unneeded filesystem types reduces the local attack surface of the system. If this filesystem type is not needed, disable it."
    remediation: "Create or edit a file in /etc/modprobe.d/ .Add the following lines in it `install hfsplus /bin/(false|true)` and `blacklist hfsplus`. Then run `modprobe -r hfsplus 2>/dev/null; rmmod hfsplus 2>/dev/null` to remove hfs from the kernel."
    level: "Level 1"
    references: 
      - ""
    compliance:
      - cis: ["1.1.1.4"]
      - others: ["unknow"]
    condition: all
    rules: 
      - 'c:modprobe -n -v hfsplus -> r:^\s*install\s+/bin/false | ^\s*install\s+/bin/true'
      - 'c:modprobe --showconfig | grep blacklist -> r:^\s*blacklist\s+hfsplus'
      - 'not c:lsmod -> r:^hfsplus\s'

# 1.1.1.5 Ensure jffs2 kernel module is not available. (Automated)
  - id: 5
    title: "Ensure hfs kernel module is not available."
    description: "The jffs2 (journaling flash filesystem 2) filesystem type is a log-structured filesystem used in flash memory devices."
    rationale: "Removing support for unneeded filesystem types reduces the local attack surface of the system. If this filesystem type is not needed, disable it."
    remediation: "Create or edit a file in /etc/modprobe.d/ .Add the following lines in it `install jffs2 /bin/(false|true)` and `blacklist jffs2`. Then run `modprobe -r jffs2 2>/dev/null; rmmod jffs2 2>/dev/null` to remove hfs from the kernel."
    level: "Level 1"
    references: 
      - ""
    compliance:
      - cis: ["1.1.1.5"]
      - others: ["unknow"]
    condition: all
    rules: 
      - 'c:modprobe -n -v jffs2 -> r:^\s*install\s+/bin/false | ^\s*install\s+/bin/true'
      - 'c:modprobe --showconfig | grep blacklist -> r:^\s*blacklist\s+jffs2'
      - 'not c:lsmod -> r:^jffs2\s'

# 1.1.1.6 Ensure overlayfs kernel module is not available. (Automated)
  - id: 6
    title: "Ensure overlayfs kernel module is not available."
    description: "The overlayfs is a Linux filesystem that layers multiple filesystems to create a single unified view which allows a user to merge several mount points into a unified filesystem."
    rationale: "The overlayfs has known CVEs: CVE-2023-32629, CVE-2023-2640, CVE-2023-0386. Disabling the overlayfs reduces the local attack surface by removing support for unnecessary filesystem types and mitigates potential risks associated with unauthorized execution of setuid files, enhancing the overall system security."
    remediation: "Create or edit a file in /etc/modprobe.d/ .Add the following lines in it `install overlayfs /bin/(false|true)` and `blacklist overlayfs`. Then run `modprobe -r overlayfs 2>/dev/null; rmmod overlayfs 2>/dev/null` to remove hfs from the kernel."
    level: "Level 1"
    references: 
      - ""
    compliance:
      - cis: ["1.1.1.6"]
      - others: ["unknow"]
    condition: all
    rules: 
      - 'c:modprobe -n -v overlayfs -> r:^\s*install\s+/bin/false | ^\s*install\s+/bin/true'
      - 'c:modprobe --showconfig | grep blacklist -> r:^\s*blacklist\s+overlayfs'
      - 'not c:lsmod -> r:^overlayfs\s'

# 1.1.1.7 Ensure squashfs kernel module is not available. (Automated)
  - id: 7
    title: "Ensure squashfs kernel module is not available."
    description: "The squashfs filesystem type is a compressed read-only Linux filesystem embedded in small footprint systems. A squashfs image can be used without having to first decompress the image."
    rationale: "Removing support for unneeded filesystem types reduces the local attack surface of the system. If this filesystem type is not needed, disable it."
    remediation: "Create or edit a file in /etc/modprobe.d/ .Add the following lines in it `install squashfs /bin/(false|true)` and `blacklist squashfs`. Then run `modprobe -r squashfs 2>/dev/null; rmmod squashfs 2>/dev/null` to remove hfs from the kernel."
    level: "Level 1"
    references: 
      - ""
    compliance:
      - cis: ["1.1.1.7"]
      - others: ["unknow"]
    condition: all
    rules: 
      - 'c:modprobe -n -v squashfs -> r:^\s*install\s+/bin/false | ^\s*install\s+/bin/true'
      - 'c:modprobe --showconfig | grep blacklist -> r:^\s*blacklist\s+squashfs'
      - 'not c:lsmod -> r:^squashfs\s'

# 1.1.1.8 Ensure udf kernel module is not available. (Automated)
  - id: 8
    title: "Ensure udf kernel module is not available."
    description: "The udf filesystem type is the universal disk format used to implement ISO/IEC 13346 and ECMA-167 specifications. This is an open vendor filesystem type for data storage on a broad range of media. This filesystem type is necessary to support writing DVDs and newer optical disc formats."
    rationale: "Removing support for unneeded filesystem types reduces the local attack surface of the system. If this filesystem type is not needed, disable it."
    remediation: "Create or edit a file in /etc/modprobe.d/ .Add the following lines in it `install udf /bin/(false|true)` and `blacklist udf`. Then run `modprobe -r udf 2>/dev/null; rmmod udf 2>/dev/null` to remove hfs from the kernel."
    level: "Level 1"
    references: 
      - ""
    compliance:
      - cis: ["1.1.1.8"]
      - others: ["unknow"]
    condition: all
    rules: 
      - 'c:modprobe -n -v udf -> r:^\s*install\s+/bin/false | ^\s*install\s+/bin/true'
      - 'c:modprobe --showconfig | grep blacklist -> r:^\s*blacklist\s+udf'
      - 'not c:lsmod -> r:^udf\s'

# 1.1.1.9 Ensure usb-storage kernel module is not available. (Automated)
  - id: 9
    title: "Ensure usb-storage kernel module is not available."
    description: "USB storage provides a means to transfer and store files ensuring persistence and availability of the files independent of network connection status. Its popularity and utility has led to USB-based malware being a simple and common means for network infiltration and a first step to establishing a persistent threat within a networked environment."
    rationale: "Restricting USB access on the system will decrease the physical attack surface for a device and diminish the possible vectors to introduce malware."
    remediation: "Create or edit a file in /etc/modprobe.d/ .Add the following lines in it `install usb-storage /bin/(false|true)` and `blacklist usb-storage`. Then run `modprobe -r usb-storage 2>/dev/null; rmmod usb-storage 2>/dev/null` to remove hfs from the kernel."
    level: "Level 1"
    references: 
      - ""
    compliance:
      - cis: ["1.1.1.9"]
      - others: ["unknow"]
    condition: all
    rules: 
      - 'c:modprobe -n -v usb-storage -> r:^\s*install\s+/bin/false | ^\s*install\s+/bin/true'
      - 'c:modprobe --showconfig | grep blacklist -> r:^\s*blacklist\s+usb-storage'
      - 'not c:lsmod -> r:^usb-storage\s'

# 1.1.1.10 Ensure unused filesystems kernel modules are not available. (Manual)
#  - id: 11110
#    title: "Ensure unused filesystems are not available."

# 1.1.2.1 - Configure /tmp
#
#

# 1.1.2.1.1 Ensure /tmp is a separate partition. (Automated)
  - id: 10
    title: "Ensure /tmp is a separate partition."
    description: "The /tmp directory is a world-writable directory used for temporary storage by all users and some applications. - IF - an entry for /tmp exists in /etc/fstab it will take precedence over entries in systemd default unit file. Note: In an environment where the main system is diskless and connected to iSCSI, entries in /etc/fstab may not take precedence. /tmp can be configured to use tmpfs. tmpfs puts everything into the kernel internal caches and grows and shrinks to accommodate the files it contains and is able to swap unneeded pages out to swap space. It has maximum size limits which can be adjusted on the fly via mount -o remount. Since tmpfs lives completely in the page cache and on swap, all tmpfs pages will be shown as Shmem in /proc/meminfo and Shared in free. Notice that these counters also include shared memory. The most reliable way to get the count is using df and du. tmpfs has three mount options for sizing: - size: The limit of allocated bytes for this tmpfs instance. The default is half of your physical RAM without swap. If you oversize your tmpfs instances the machine will deadlock since the OOM handler will not be able to free that memory. - nr_blocks: The same as size, but in blocks of PAGE_SIZE. - nr_inodes: The maximum number of inodes for this instance. The default is half of the number of your physical RAM pages, or (on a machine with highmem) the number of lowmem RAM pages, whichever is the lower. These parameters accept a suffix k, m or g and can be changed on remount. The size parameter also accepts a suffix % to limit this tmpfs instance to that percentage of your physical RAM. The default, when neither size nor nr_blocks is specified, is size=50%."
    rationale: "Making /tmp its own file system allows an administrator to set additional mount options such as the noexec option on the mount, making /tmp useless for an attacker to install executable code. It would also prevent an attacker from establishing a hard link to a system setuid program and wait for it to be updated. Once the program was updated, the hard link would be broken, and the attacker would have his own copy of the program. If the program happened to have a security vulnerability, the attacker could continue to exploit the known flaw. This can be accomplished by either mounting tmpfs to /tmp, or creating a separate partition for /tmp."
    impact: "By design files saved to /tmp should have no expectation of surviving a reboot of the system. tmpfs is ram based and all files stored to tmpfs will be lost when the system is rebooted. If files need to be persistent through a reboot, they should be saved to /var/tmp not /tmp. Since the /tmp directory is intended to be world-writable, there is a risk of resource exhaustion if it is not bound to tmpfs or a separate partition. Running out of /tmp space is a problem regardless of what kind of filesystem lies under it, but in a configuration where /tmp is not a separate file system it will essentially have the whole disk available, as the default installation only creates a single / partition. On the other hand, a RAM-based /tmp (as with tmpfs) will almost certainly be much smaller, which can lead to applications filling up the filesystem much more easily. Another alternative is to create a dedicated partition for /tmp from a separate volume or disk. One of the downsides of a disk-based dedicated partition is that it will be slower than tmpfs which is RAM-based."
    remediation: "First ensure that systemd is correctly configured to ensure that /tmp will be mounted at boot time. # systemctl unmask tmp.mount For specific configuration requirements of the /tmp mount for your environment, modify /etc/fstab. Example of using tmpfs with specific mount options: tmpfs /tmp 0 tmpfs defaults,rw,nosuid,nodev,noexec,relatime,size=2G 0 Note: the size=2G is an example of setting a specific size for tmpfs. Example of using a volume or disk with specific mount options. The source location of the volume or disk will vary depending on your environment: <device> /tmp <fstype> defaults,nodev,nosuid,noexec 0 0."
    level: "Level 1"
    references:
      - "https://www.freedesktop.org/wiki/Software/systemd/APIFileSystems/"
      - "https://www.freedesktop.org/software/systemd/man/systemd-fstab-generator.html"
      - "https://www.kernel.org/doc/Documentation/filesystems/tmpfs.txt"
    compliance:
      - cis: ["1.1.2.1.1"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["9.2"]
      - cmmc_v2.0: ["CM.L2-3.4.7", "CM.L2-3.4.8", "SC.L2-3.13.6"]
      - iso_27001-2013: ["A.13.1.3"]
      - mitre_mitigations: ["M1022"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1499", "T1499.001"]
      - pci_dss_v3.2.1: ["1.1.6", "1.2.1", "2.2.2", "2.2.5"]
      - pci_dss_v4.0: ["1.2.5", "2.2.4", "6.4.1"]
      - soc_2: ["CC6.3", "CC6.6"]
    condition: all
    rules:
      - 'c:findmnt -kn /tmp -> r:^\s*/tmp\s'
      - 'c:systemctl is-enabled tmp.mount -> !r:masked|disabled && r:generated|enabled'

# 1.1.2.1.2 Ensure nodev option set on /tmp partition. (Automated)
  - id: 11
    title: "Ensure nodev option set on /tmp partition."
    description: "The nodev mount option specifies that the filesystem cannot contain special devices."
    rationale: "Since the /tmp filesystem is not intended to support devices, set this option to ensure that users cannot create a block or character special devices in /tmp."
    remediation: "- IF - a separate partition exists for /tmp. Edit the /etc/fstab file and add nodev to the fourth field (mounting options) for the /tmp partition. Example: <device> /tmp <fstype> defaults,rw,nosuid,nodev,noexec,relatime 0 0 Run the following command to remount /tmp with the configured options: # mount -o remount /tmp."
    level: "Level 1"
    compliance:
      - cis: ["1.1.2.1.2"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["9.2"]
      - cmmc_v2.0: ["CM.L2-3.4.7", "CM.L2-3.4.8", "SC.L2-3.13.6"]
      - iso_27001-2013: ["A.13.1.3"]
      - mitre_mitigations: ["M1022"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1200"]
      - pci_dss_v3.2.1: ["1.1.6", "1.2.1", "2.2.2", "2.2.5"]
      - pci_dss_v4.0: ["1.2.5", "2.2.4", "6.4.1"]
      - soc_2: ["CC6.3", "CC6.6"]
    condition: all
    rules:
      - 'c:findmnt -kn /tmp -> r:nodev'

# 1.1.2.1.3 Ensure nosuid option set on /tmp partition. (Automated)
  - id: 12
    title: "Ensure nosuid option set on /tmp partition."
    description: "The nosuid mount option specifies that the filesystem cannot contain setuid files."
    rationale: "Since the /tmp filesystem is only intended for temporary file storage, set this option to ensure that users cannot create setuid files in /tmp."
    remediation: "- IF - a separate partition exists for /tmp. Edit the /etc/fstab file and add nosuid to the fourth field (mounting options) for the /tmp partition. Example: <device> /tmp <fstype> defaults,rw,nosuid,nodev,noexec,relatime 0 0 Run the following command to remount /tmp with the configured options: # mount -o remount /tmp."
    level: "Level 1"
    compliance:
      - cis: ["1.1.2.1.3"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0: ["AC.L1-3.1.1", "AC.L1-3.1.2", "AC.L2-3.1.3", "AC.L2-3.1.5", "MP.L2-3.8.2"]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - iso_27001-2013: ["A.9.1.1"]
      - mitre_mitigations: ["M1022"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1548", "T1548.001"]
      - nist_sp_800-53: ["AC-5", "AC-6"]
      - pci_dss_v3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_v4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    condition: all
    rules:
      - 'c:findmnt -kn /tmp -> r:nosuid'

# 1.1.2.1.4 Ensure noexec option set on /tmp partition. (Automated)
  - id: 13
    title: "Ensure noexec option set on /tmp partition."
    description: "The noexec mount option specifies that the filesystem cannot contain executable binaries."
    rationale: "Since the /tmp filesystem is only intended for temporary file storage, set this option to ensure that users cannot run executable binaries from /tmp."
    impact: "Setting the noexec option on /tmp may prevent installation and/or updating of some 3rd party software."
    remediation: "- IF - a separate partition exists for /tmp. Edit the /etc/fstab file and add noexec to the fourth field (mounting options) for the /tmp partition. Example: <device> /tmp <fstype> defaults,rw,nosuid,nodev,noexec,relatime 0 0 Run the following command to remount /tmp with the configured options: # mount -o remount /tmp."
    level: "Level 1"
    compliance:
      - cis: ["1.1.2.1.4"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0: ["AC.L1-3.1.1", "AC.L1-3.1.2", "AC.L2-3.1.3", "AC.L2-3.1.5", "MP.L2-3.8.2"]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - iso_27001-2013: ["A.9.1.1"]
      - mitre_mitigations: ["M1022"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1204", "T1204.002"]
      - nist_sp_800-53: ["AC-5", "AC-6"]
      - pci_dss_v3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_v4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    condition: all
    rules:
      - 'c:findmnt -kn /tmp -> r:noexec'

# 1.1.2.2 - Configure /dev/shm
#
#

# 1.1.2.2.1 Ensure /dev/shm is a separate partition. (Automated)
  - id: 14
    title: "Ensure /dev/shm is a separate partition."
    description: "The /dev/shm directory is a world-writable directory that can function as shared memory that facilitates inter process communication (IPC)."
    rationale: "Making /dev/shm its own file system allows an administrator to set additional mount options such as the noexec option on the mount, making /dev/shm useless for an attacker to install executable code. It would also prevent an attacker from establishing a hard link to a system setuid program and wait for it to be updated. Once the program was updated, the hard link would be broken and the attacker would have his own copy of the program. If the program happened to have a security vulnerability, the attacker could continue to exploit the known flaw. This can be accomplished by mounting tmpfs to /dev/shm."
    impact: "Since the /dev/shm directory is intended to be world-writable, there is a risk of resource exhaustion if it is not bound to a separate partition. /dev/shm utilizing tmpfs can be resized using the size={size} parameter in the relevant entry in /etc/fstab."
    remediation: "For specific configuration requirements of the /dev/shm mount for your environment, modify /etc/fstab. Example: tmpfs /dev/shm defaults,rw,nosuid,nodev,noexec,relatime,size=2G 0 0 tmpfs."
    level: "Level 1"
    references:
      - "https://www.freedesktop.org/wiki/Software/systemd/APIFileSystems/"
      - "https://www.freedesktop.org/software/systemd/man/systemd-fstab-generator.html"
    compliance:
      - cis: ["1.1.2.2.1"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["9.2"]
      - cmmc_v2.0: ["CM.L2-3.4.7", "CM.L2-3.4.8", "SC.L2-3.13.6"]
      - iso_27001-2013: ["A.13.1.3"]
      - mitre_mitigations: ["M1022"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1499", "T1499.001"]
      - pci_dss_v3.2.1: ["1.1.6", "1.2.1", "2.2.2", "2.2.5"]
      - pci_dss_v4.0: ["1.2.5", "2.2.4", "6.4.1"]
      - soc_2: ["CC6.3", "CC6.6"]
    condition: all
    rules:
      - 'c:findmnt -kn /dev/shm -> r:^\s*/dev/shm\s'

# 1.1.2.2.2 Ensure nodev option set on /dev/shm partition. (Automated)
  - id: 15
    title: "Ensure nodev option set on /dev/shm partition."
    description: "The nodev mount option specifies that the filesystem cannot contain special devices."
    rationale: "Since the /dev/shm filesystem is not intended to support devices, set this option to ensure that users cannot attempt to create special devices in /dev/shm partitions."
    remediation: "- IF - a separate partition exists for /dev/shm. Edit the /etc/fstab file and add nodev to the fourth field (mounting options) for the /dev/shm partition. See the fstab(5) manual page for more information. Example: tmpfs /dev/shm tmpfs defaults,rw,nosuid,nodev,noexec,relatime 0 0 Run the following command to remount /dev/shm with the configured options: # mount -o remount /dev/shm Note: It is recommended to use tmpfs as the device/filesystem type as /dev/shm is used as shared memory space by applications."
    level: "Level 1"
    compliance:
      - cis: ["1.1.2.2.2"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0: ["AC.L1-3.1.1", "AC.L1-3.1.2", "AC.L2-3.1.3", "AC.L2-3.1.5", "MP.L2-3.8.2"]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - iso_27001-2013: ["A.9.1.1"]
      - mitre_mitigations: ["M1022"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1200"]
      - nist_sp_800-53: ["AC-5", "AC-6"]
      - pci_dss_v3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_v4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    condition: all
    rules:
      - 'c:findmnt -kn /dev/shm -> r:nodev'

# 1.1.2.2.3 Ensure nosuid option set on /dev/shm partition. (Automated)
  - id: 16
    title: "Ensure nosuid option set on /dev/shm partition."
    description: "The nosuid mount option specifies that the filesystem cannot contain setuid files."
    rationale: "Setting this option on a file system prevents users from introducing privileged programs onto the system and allowing non-root users to execute them."
    remediation: "- IF - a separate partition exists for /dev/shm. Edit the /etc/fstab file and add nosuid to the fourth field (mounting options) for the /dev/shm partition. See the fstab(5) manual page for more information. Example: tmpfs /dev/shm tmpfs defaults,rw,nosuid,nodev,noexec,relatime 0 0 Run the following command to remount /dev/shm with the configured options: # mount -o remount /dev/shm Note: It is recommended to use tmpfs as the device/filesystem type as /dev/shm is used as shared memory space by applications."
    level: "Level 1"
    compliance:
      - cis: ["1.1.2.2.3"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0: ["AC.L1-3.1.1", "AC.L1-3.1.2", "AC.L2-3.1.3", "AC.L2-3.1.5", "MP.L2-3.8.2"]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - iso_27001-2013: ["A.9.1.1"]
      - mitre_mitigations: ["M1038"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1548", "T1548.001"]
      - nist_sp_800-53: ["AC-5", "AC-6"]
      - pci_dss_v3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_v4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    condition: all
    rules:
      - 'c:findmnt -kn /dev/shm -> r:nosuid'

# 1.1.2.2.4 Ensure noexec option set on /dev/shm partition. (Automated)
  - id: 17
    title: "Ensure noexec option set on /dev/shm partition."
    description: "The noexec mount option specifies that the filesystem cannot contain executable binaries."
    rationale: "Setting this option on a file system prevents users from executing programs from shared memory. This deters users from introducing potentially malicious software on the system."
    remediation: "- IF - a separate partition exists for /dev/shm. Edit the /etc/fstab file and add noexec to the fourth field (mounting options) for the /dev/shm partition. Example: tmpfs /dev/shm tmpfs defaults,rw,nosuid,nodev,noexec,relatime 0 0 Run the following command to remount /dev/shm with the configured options: # mount -o remount /dev/shm Note: It is recommended to use tmpfs as the device/filesystem type as /dev/shm is used as shared memory space by applications."
    level: "Level 1"
    compliance:
      - cis: ["1.1.2.2.4"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0: ["AC.L1-3.1.1", "AC.L1-3.1.2", "AC.L2-3.1.3", "AC.L2-3.1.5", "MP.L2-3.8.2"]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - iso_27001-2013: ["A.9.1.1"]
      - mitre_mitigations: ["M1022"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1204", "T1204.002"]
      - nist_sp_800-53: ["AC-5", "AC-6"]
      - pci_dss_v3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_v4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    condition: all
    rules:
      - 'c:findmnt -kn /dev/shm -> r:noexec'

# 1.1.2.3 - Configure /home
#
#

# 1.1.2.3.1 Ensure separate partition exists for /home. (Automated)
  - id: 18
    title: "Ensure separate partition exists for /home."
    description: "The /home directory is used to support disk storage needs of local users."
    rationale: "The default installation only creates a single / partition. Since the /home directory contains user generated data, there is a risk of resource exhaustion. It will essentially have the whole disk available to fill up and impact the system as a whole. In addition, other operations on the system could fill up the disk unrelated to /home and impact all local users. Configuring /home as its own file system allows an administrator to set additional mount options such as noexec/nosuid/nodev. These options limit an attacker's ability to create exploits on the system. In the case of /home options such as usrquota/grpquota may be considered to limit the impact that users can have on each other with regards to disk resource exhaustion. Other options allow for specific behavior. See man mount for exact details regarding filesystem-independent and filesystem-specific options. As /home contains user data, care should be taken to ensure the security and integrity of the data and mount point."
    impact: "Resizing filesystems is a common activity in cloud-hosted servers. Separate filesystem partitions may prevent successful resizing or may require the installation of additional tools solely for the purpose of resizing operations. The use of these additional tools may introduce their own security considerations."
    remediation: "For new installations, during installation create a custom partition setup and specify a separate partition for /home. For systems that were previously installed, create a new partition and configure /etc/fstab as appropriate."
    level: "Level 2"
    references:
      - "http://tldp.org/HOWTO/LVM-HOWTO/"
    compliance:
      - cis: ["1.1.2.3.1"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0: ["AC.L1-3.1.1", "AC.L1-3.1.2", "AC.L2-3.1.3", "AC.L2-3.1.5", "MP.L2-3.8.2"]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - iso_27001-2013: ["A.9.1.1"]
      - mitre_mitigations: ["M1038"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1499", "T1499.001"]
      - nist_sp_800-53: ["AC-5", "AC-6"]
      - pci_dss_v3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_v4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    condition: all
    rules:
      - 'c:findmnt -kn /home -> r:^\s*/home\s'

# 1.1.2.3.2 Ensure nodev option set on /home partition. (Automated)
  - id: 19
    title: "Ensure nodev option set on /home partition."
    description: "The nodev mount option specifies that the filesystem cannot contain special devices."
    rationale: "Since the /home filesystem is not intended to support devices, set this option to ensure that users cannot create a block or character special devices in /home."
    remediation: "- IF - a separate partition exists for /home. Edit the /etc/fstab file and add nodev to the fourth field (mounting options) for the /home partition. Example: <device> /home <fstype> defaults,rw,nosuid,nodev,noexec,relatime 0 0 Run the following command to remount /home with the configured options: # mount -o remount /home."
    level: "Level 1"
    compliance:
      - cis: ["1.1.2.3.2"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0: ["AC.L1-3.1.1", "AC.L1-3.1.2", "AC.L2-3.1.3", "AC.L2-3.1.5", "MP.L2-3.8.2"]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - iso_27001-2013: ["A.9.1.1"]
      - mitre_mitigations: ["M1038"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1200"]
      - nist_sp_800-53: ["AC-5", "AC-6"]
      - pci_dss_v3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_v4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    condition: all
    rules:
      - 'c:findmnt -kn /home -> r:nodev'

# 1.1.2.3.3 Ensure nosuid option set on /home partition. (Automated)
  - id: 20
    title: "Ensure nosuid option set on /home partition."
    description: "The nosuid mount option specifies that the filesystem cannot contain setuid files."
    rationale: "Since the /home filesystem is only intended for user file storage, set this option to ensure that users cannot create setuid files in /home."
    remediation: "- IF - a separate partition exists for /home. Edit the /etc/fstab file and add nosuid to the fourth field (mounting options) for the /home partition. Example: <device> /home <fstype> defaults,rw,nosuid,nodev,noexec,relatime 0 0 Run the following command to remount /home with the configured options: # mount -o remount /home."
    level: "Level 1"
    compliance:
      - cis: ["1.1.2.3.3"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0: ["AC.L1-3.1.1", "AC.L1-3.1.2", "AC.L2-3.1.3", "AC.L2-3.1.5", "MP.L2-3.8.2"]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - iso_27001-2013: ["A.9.1.1"]
      - mitre_mitigations: ["M1022"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1548", "T1548.001"]
      - nist_sp_800-53: ["AC-5", "AC-6"]
      - pci_dss_v3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_v4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    condition: all
    rules:
      - 'c:findmnt -kn /home -> r:nosuid'

# 1.1.2.4 - Configure /var
#
#

# 1.1.2.4.1 Ensure separate partition exists for /var. (Automated)
  - id: 21
    title: "Ensure separate partition exists for /var."
    description: "The /var directory is used by daemons and other system services to temporarily store dynamic data. Some directories created by these processes may be world-writable."
    rationale: "The reasoning for mounting /var on a separate partition is as follows. The default installation only creates a single / partition. Since the /var directory may contain world writable files and directories, there is a risk of resource exhaustion. It will essentially have the whole disk available to fill up and impact the system. In addition, other operations on the system could fill up the disk unrelated to /var and cause unintended behavior across the system as the disk is full. See man auditd.conf for details. Configuring /var as its own file system allows an administrator to set additional mount options such as noexec/nosuid/nodev. These options limit an attacker's ability to create exploits on the system. Other options allow for specific behavior. See man mount for exact details regarding filesystem-independent and filesystem-specific options. An example of exploiting /var may be an attacker establishing a hard-link to a system setuid program and waiting for it to be updated. Once the program is updated, the hard-link can be broken and the attacker would have their own copy of the program. If the program happened to have a security vulnerability, the attacker could continue to exploit the known flaw."
    impact: "Resizing filesystems is a common activity in cloud-hosted servers. Separate filesystem partitions may prevent successful resizing or may require the installation of additional tools solely for the purpose of resizing operations. The use of these additional tools may introduce their own security considerations."
    remediation: "For new installations, during installation create a custom partition setup and specify a separate partition for /var. For systems that were previously installed, create a new partition and configure /etc/fstab as appropriate."
    level: "Level 2"
    references:
      - "http://tldp.org/HOWTO/LVM-HOWTO/"
    compliance:
      - cis: ["1.1.2.4.1"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0: ["AC.L1-3.1.1", "AC.L1-3.1.2", "AC.L2-3.1.3", "AC.L2-3.1.5", "MP.L2-3.8.2"]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - iso_27001-2013: ["A.9.1.1"]
      - mitre_mitigations: ["M1022"]
      - mitre_tactics: ["TA0006"]
      - mitre_techniques: ["T1499", "T1499.001"]
      - nist_sp_800-53: ["AC-5", "AC-6"]
      - pci_dss_v3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_v4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    condition: all
    rules:
      - 'c:findmnt -kn /var -> r:^\s*/var\s'

# 1.1.2.4.2 Ensure nodev option set on /var partition. (Automated)
  - id: 22
    title: "Ensure nodev option set on /var partition."
    description: "The nodev mount option specifies that the filesystem cannot contain special devices."
    rationale: "Since the /var filesystem is not intended to support devices, set this option to ensure that users cannot create a block or character special devices in /var."
    remediation: "- IF - a separate partition exists for /var. Edit the /etc/fstab file and add nodev to the fourth field (mounting options) for the /var partition. Example: <device> /var <fstype> defaults,rw,nosuid,nodev,noexec,relatime 0 0 Run the following command to remount /var with the configured options: # mount -o remount /var."
    level: "Level 1"
    compliance:
      - cis: ["1.1.2.4.2"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0: ["AC.L1-3.1.1", "AC.L1-3.1.2", "AC.L2-3.1.3", "AC.L2-3.1.5", "MP.L2-3.8.2"]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - iso_27001-2013: ["A.9.1.1"]
      - mitre_mitigations: ["M1022"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1200"]
      - nist_sp_800-53: ["AC-5", "AC-6"]
      - pci_dss_v3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_v4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    condition: all
    rules:
      - 'c:findmnt -kn /var -> r:nodev'

# 1.1.2.4.3 Ensure nosuid option set on /var partition. (Automated)
  - id: 23
    title: "Ensure nosuid option set on /var partition."
    description: "The nosuid mount option specifies that the filesystem cannot contain setuid files."
    rationale: "Since the /var filesystem is only intended for variable files such as logs, set this option to ensure that users cannot create setuid files in /var."
    remediation: "- IF - a separate partition exists for /var. Edit the /etc/fstab file and add nosuid to the fourth field (mounting options) for the /var partition. Example: <device> /var <fstype> defaults,rw,nosuid,nodev,noexec,relatime 0 0 Run the following command to remount /var with the configured options: # mount -o remount /var."
    level: "Level 1"
    compliance:
      - cis: ["1.1.2.4.3"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0: ["AC.L1-3.1.1", "AC.L1-3.1.2", "AC.L2-3.1.3", "AC.L2-3.1.5", "MP.L2-3.8.2"]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - iso_27001-2013: ["A.9.1.1"]
      - mitre_mitigations: ["M1022"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1548", "T1548.001"]
      - nist_sp_800-53: ["AC-5", "AC-6"]
      - pci_dss_v3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_v4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    condition: all
    rules:
      - 'c:findmnt -kn /var -> r:nosuid'

# 1.1.2.5 - Configure /var/tmp
#
#

# 1.1.2.5.1 Ensure separate partition exists for /var/tmp. (Automated)
  - id: 24
    title: "Ensure separate partition exists for /var/tmp."
    description: "The /var/tmp directory is a world-writable directory used for temporary storage by all users and some applications. Temporary files residing in /var/tmp are to be preserved between reboots."
    rationale: "The default installation only creates a single / partition. Since the /var/tmp directory is world-writable, there is a risk of resource exhaustion. In addition, other operations on the system could fill up the disk unrelated to /var/tmp and cause potential disruption to daemons as the disk is full. Configuring /var/tmp as its own file system allows an administrator to set additional mount options such as noexec/nosuid/nodev. These options limit an attacker's ability to create exploits on the system."
    impact: "Resizing filesystems is a common activity in cloud-hosted servers. Separate filesystem partitions may prevent successful resizing or may require the installation of additional tools solely for the purpose of resizing operations. The use of these additional tools may introduce their own security considerations."
    remediation: "For new installations, during installation create a custom partition setup and specify a separate partition for /var/tmp. For systems that were previously installed, create a new partition and configure /etc/fstab as appropriate."
    level: "Level 2"
    references:
      - "http://tldp.org/HOWTO/LVM-HOWTO/"
    compliance:
      - cis: ["1.1.2.5.1"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0: ["AC.L1-3.1.1", "AC.L1-3.1.2", "AC.L2-3.1.3", "AC.L2-3.1.5", "MP.L2-3.8.2"]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - iso_27001-2013: ["A.9.1.1"]
      - mitre_mitigations: ["M1022"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1499", "T1499.001"]
      - nist_sp_800-53: ["AC-5", "AC-6"]
      - pci_dss_v3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_v4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    condition: all
    rules:
      - 'c:findmnt -kn /var/tmp -> r:^\s*/var/tmp\s'

# 1.1.2.5.2 Ensure nodev option set on /var/tmp partition. (Automated)
  - id: 25
    title: "Ensure nodev option set on /var/tmp partition."
    description: "The nodev mount option specifies that the filesystem cannot contain special devices."
    rationale: "Since the /var/tmp filesystem is not intended to support devices, set this option to ensure that users cannot create a block or character special devices in /var/tmp."
    remediation: "- IF - a separate partition exists for /var/tmp. Edit the /etc/fstab file and add nodev to the fourth field (mounting options) for the /var/tmp partition. Example: <device> /var/tmp <fstype> defaults,rw,nosuid,nodev,noexec,relatime 0 0 Run the following command to remount /var/tmp with the configured options: # mount -o remount /var/tmp."
    level: "Level 1"
    compliance:
      - cis: ["1.1.2.5.2"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0: ["AC.L1-3.1.1", "AC.L1-3.1.2", "AC.L2-3.1.3", "AC.L2-3.1.5", "MP.L2-3.8.2"]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - iso_27001-2013: ["A.9.1.1"]
      - mitre_mitigations: ["M1022"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1499", "T1499.001"]
      - nist_sp_800-53: ["AC-5", "AC-6"]
      - pci_dss_v3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_v4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    condition: all
    rules:
      - 'c:findmnt -kn /var/tmp -> r:nodev'

# 1.1.2.5.3 Ensure nosuid option set on /var/tmp partition. (Automated)
  - id: 26
    title: "Ensure nosuid option set on /var/tmp partition."
    description: "The nosuid mount option specifies that the filesystem cannot contain setuid files."
    rationale: "Since the /var/tmp filesystem is only intended for temporary file storage, set this option to ensure that users cannot create setuid files in /var/tmp."
    remediation: "- IF - a separate partition exists for /var/tmp. Edit the /etc/fstab file and add nosuid to the fourth field (mounting options) for the /var/tmp partition. Example: <device> /var/tmp <fstype> defaults,rw,nosuid,nodev,noexec,relatime 0 0 Run the following command to remount /var/tmp with the configured options: # mount -o remount /var/tmp."
    level: "Level 1"
    compliance:
      - cis: ["1.1.2.5.3"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0: ["AC.L1-3.1.1", "AC.L1-3.1.2", "AC.L2-3.1.3", "AC.L2-3.1.5", "MP.L2-3.8.2"]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - iso_27001-2013: ["A.9.1.1"]
      - mitre_mitigations: ["M1022"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1548", "T1548.001"]
      - nist_sp_800-53: ["AC-5", "AC-6"]
      - pci_dss_v3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_v4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    condition: all
    rules:
      - 'c:findmnt -kn /var/tmp -> r:nosuid'

 # 1.1.2.5.4 Ensure noexec option set on /var/tmp partition. (Automated)
  - id: 27
    title: "Ensure noexec option set on /var/tmp partition."
    description: "The noexec mount option specifies that the filesystem cannot contain executable binaries."
    rationale: "Since the /var/tmp filesystem is only intended for temporary file storage, set this option to ensure that users cannot run executable binaries from /var/tmp."
    remediation: "- IF - a separate partition exists for /var/tmp. Edit the /etc/fstab file and add noexec to the fourth field (mounting options) for the /var/tmp partition. Example: <device> /var/tmp <fstype> defaults,rw,nosuid,nodev,noexec,relatime 0 0 Run the following command to remount /var/tmp with the configured options: # mount -o remount /var/tmp."
    level: "Level 1"
    compliance:
      - cis: ["1.1.2.5.4"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0: ["AC.L1-3.1.1", "AC.L1-3.1.2", "AC.L2-3.1.3", "AC.L2-3.1.5", "MP.L2-3.8.2"]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - iso_27001-2013: ["A.9.1.1"]
      - mitre_mitigations: ["M1022"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1204", "T1204.002"]
      - nist_sp_800-53: ["AC-5", "AC-6"]
      - pci_dss_v3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_v4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    condition: all
    rules:
      - 'c:findmnt -kn /var/tmp -> r:noexec'

# 1.1.2.6 - Configure /var/log
#
#

# 1.1.2.6.1 Ensure separate partition exists for /var/log. (Automated)
  - id: 28
    title: "Ensure separate partition exists for /var/log."
    description: "The /var/log directory is used by system services to store log data."
    rationale: "The default installation only creates a single / partition. Since the /var/log directory contains log files which can grow quite large, there is a risk of resource exhaustion. It will essentially have the whole disk available to fill up and impact the system as a whole. Configuring /var/log as its own file system allows an administrator to set additional mount options such as noexec/nosuid/nodev. These options limit an attackers ability to create exploits on the system. Other options allow for specific behavior. See man mount for exact details regarding filesystem-independent and filesystem-specific options. As /var/log contains log files, care should be taken to ensure the security and integrity of the data and mount point."
    impact: "Resizing filesystems is a common activity in cloud-hosted servers. Separate filesystem partitions may prevent successful resizing, or may require the installation of additional tools solely for the purpose of resizing operations. The use of these additional tools may introduce their own security considerations."
    remediation: "For new installations, during installation create a custom partition setup and specify a separate partition for /var/log . For systems that were previously installed, create a new partition and configure /etc/fstab as appropriate."
    level: "Level 2"
    references:
      - "http://tldp.org/HOWTO/LVM-HOWTO/"
    compliance:
      - cis: ["1.1.2.6.1"]
      - cis_csc_v8: ["8.3"]
      - cis_csc_v7: ["6.4"]
      - iso_27001-2013: ["A.12.4.1"]
      - mitre_mitigations: ["M1022"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1499", "T1499.001"]
      - pci_dss_v3.2.1: ["10.7"]
      - soc_2: ["A1.1"]
    condition: all
    rules:
      - 'c:findmnt -kn /var/log -> r:^\s*/var/log\s'

# 1.1.2.6.2 Ensure nodev option set on /var/log partition. (Automated)
  - id: 29
    title: "Ensure nodev option set on /var/log partition."
    description: "The nodev mount option specifies that the filesystem cannot contain special devices."
    rationale: "Since the /var/log filesystem is not intended to support devices, set this option to ensure that users cannot create a block or character special devices in /var/log."
    remediation: "- IF - a separate partition exists for /var/log. Edit the /etc/fstab file and add nodev to the fourth field (mounting options) for the /var/log partition. Example: <device> /var/log <fstype> defaults,rw,nosuid,nodev,noexec,relatime 0 0 Run the following command to remount /var/log with the configured options: # mount -o remount /var/log."
    level: "Level 2"
    compliance:
      - cis: ["1.1.2.6.2"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0: ["AC.L1-3.1.1", "AC.L1-3.1.2", "AC.L2-3.1.3", "AC.L2-3.1.5", "MP.L2-3.8.2"]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - iso_27001-2013: ["A.9.1.1"]
      - mitre_mitigations: ["M1038"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1200"]
      - nist_sp_800-53: ["AC-5", "AC-6"]
      - pci_dss_v3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_v4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    condition: all
    rules:
      - "c:findmnt -kn /var/log -> r:nodev"

# 1.1.2.6.3 Ensure nosuid option set on /var/log partition. (Automated)
  - id: 30
    title: "Ensure nosuid option set on /var/log partition."
    description: "The nosuid mount option specifies that the filesystem cannot contain setuid files."
    rationale: "Since the /var/log filesystem is only intended for log files, set this option to ensure that users cannot create setuid files in /var/log."
    remediation: "- IF - a separate partition exists for /var/log. Edit the /etc/fstab file and add nosuid to the fourth field (mounting options) for the /var/log partition. Example: <device> /var/log <fstype> defaults,rw,nosuid,nodev,noexec,relatime 0 0 Run the following command to remount /var/log with the configured options: # mount -o remount /var/log."
    level: "Level 1"
    compliance:
      - cis: ["1.1.2.6.3"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0: ["AC.L1-3.1.1", "AC.L1-3.1.2", "AC.L2-3.1.3", "AC.L2-3.1.5", "MP.L2-3.8.2"]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - iso_27001-2013: ["A.9.1.1"]
      - mitre_mitigations: ["M1022"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1548", "T1548.001"]
      - nist_sp_800-53: ["AC-5", "AC-6"]
      - pci_dss_v3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_v4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    condition: all
    rules:
      - "c:findmnt -kn /var/log -> r:nosuid"

# 1.1.2.6.4 Ensure noexec option set on /var/log partition. (Automated)
  - id: 31
    title: "Ensure noexec option set on /var/log partition."
    description: "The noexec mount option specifies that the filesystem cannot contain executable binaries."
    rationale: "Since the /var/log filesystem is only intended for log files, set this option to ensure that users cannot run executable binaries from /var/log."
    remediation: "- IF - a separate partition exists for /var/log. Edit the /etc/fstab file and add noexec to the fourth field (mounting options) for the /var/log partition. Example: <device> /var/log <fstype> defaults,rw,nosuid,nodev,noexec,relatime 0 0 Run the following command to remount /var/log with the configured options: # mount -o remount /var/log."
    level: "Level 1"
    compliance:
      - cis: ["1.1.2.6.4"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0: ["AC.L1-3.1.1", "AC.L1-3.1.2", "AC.L2-3.1.3", "AC.L2-3.1.5", "MP.L2-3.8.2"]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - iso_27001-2013: ["A.9.1.1"]
      - mitre_mitigations: ["M1022"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1204", "T1204.002"]
      - nist_sp_800-53: ["AC-5", "AC-6"]
      - pci_dss_v3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_v4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    condition: all
    rules:
      - "c:findmnt -kn /var/log -> r:noexec"

# 1.1.2.7 - Configure /var/log/audit
#
#

# 1.1.2.7.1 Ensure separate partition exists for /var/log/audit. (Automated)
  - id: 32
    title: "Ensure separate partition exists for /var/log/audit."
    description: "The auditing daemon, auditd, stores log data in the /var/log/audit directory."
    rationale: "The default installation only creates a single / partition. Since the /var/log/audit directory contains the audit.log file which can grow quite large, there is a risk of resource exhaustion. It will essentially have the whole disk available to fill up and impact the system as a whole. In addition, other operations on the system could fill up the disk unrelated to /var/log/audit and cause auditd to trigger its space_left_action as the disk is full. See man auditd.conf for details. Configuring /var/log/audit as its own file system allows an administrator to set additional mount options such as noexec/nosuid/nodev. These options limit an attacker's ability to create exploits on the system. Other options allow for specific behavior. See man mount for exact details regarding filesystem-independent and filesystem-specific options. As /var/log/audit contains audit logs, care should be taken to ensure the security and integrity of the data and mount point."
    impact: "Resizing filesystems is a common activity in cloud-hosted servers. Separate filesystem partitions may prevent successful resizing or may require the installation of additional tools solely for the purpose of resizing operations. The use of these additional tools may introduce their own security considerations."
    remediation: "For new installations, during installation create a custom partition setup and specify a separate partition for /var/log/audit. For systems that were previously installed, create a new partition and configure /etc/fstab as appropriate."
    level: "Level 2"
    references:
      - "http://tldp.org/HOWTO/LVM-HOWTO/"
    compliance:
      - cis: ["1.1.2.7.1"]
      - cis_csc_v8: ["8.3"]
      - cis_csc_v7: ["6.4"]
      - iso_27001-2013: ["A.12.4.1"]
      - mitre_mitigations: ["M1022"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1499", "T1499.001"]
      - pci_dss_v3.2.1: ["10.7"]
      - soc_2: ["A1.1"]
    condition: all
    rules:
      - 'c:findmnt -kn /var/log/audit -> r:^\s*/var/log/audit\s'

# 1.1.2.7.2 Ensure nodev option set on /var/log/audit partition. (Automated)
  - id: 33
    title: "Ensure nodev option set on /var/log/audit partition."
    description: "The nodev mount option specifies that the filesystem cannot contain special devices."
    rationale: "Since the /var/log/audit filesystem is not intended to support devices, set this option to ensure that users cannot create a block or character special devices in /var/log/audit."
    remediation: "- IF - a separate partition exists for /var/log/audit. Edit the /etc/fstab file and add nodev to the fourth field (mounting options) for the /var/log/audit partition. Example: <device> /var/log/audit <fstype> defaults,rw,nosuid,nodev,noexec,relatime 0 0 Run the following command to remount /var/log/audit with the configured options: # mount -o remount /var/log/audit."
    level: "Level 1"
    compliance:
      - cis: ["1.1.2.7.2"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0: ["AC.L1-3.1.1", "AC.L1-3.1.2", "AC.L2-3.1.3", "AC.L2-3.1.5", "MP.L2-3.8.2"]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - iso_27001-2013: ["A.9.1.1"]
      - mitre_mitigations: ["M1022"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1200"]
      - nist_sp_800-53: ["AC-5", "AC-6"]
      - pci_dss_v3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_v4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    condition: all
    rules:
      - "c:findmnt -kn /var/log/audit -> r:nodev"

# 1.1.2.7.3 Ensure nosuid option set on /var/log/audit partition. (Automated)
  - id: 34
    title: "Ensure nosuid option set on /var/log/audit partition."
    description: "The nosuid mount option specifies that the filesystem cannot contain setuid files."
    rationale: "Since the /var/log/audit filesystem is only intended for variable files such as logs, set this option to ensure that users cannot create setuid files in /var/log/audit."
    remediation: "- IF - a separate partition exists for /var/log/audit. Edit the /etc/fstab file and add nosuid to the fourth field (mounting options) for the /var/log/audit partition. Example: <device> /var/log/audit <fstype> defaults,rw,nosuid,nodev,noexec,relatime 0 0 Run the following command to remount /var/log/audit with the configured options: # mount -o remount /var/log/audit."
    level: "Level 1"
    compliance:
      - cis: ["1.1.2.7.3"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0: ["AC.L1-3.1.1", "AC.L1-3.1.2", "AC.L2-3.1.3", "AC.L2-3.1.5", "MP.L2-3.8.2"]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - iso_27001-2013: ["A.9.1.1"]
      - mitre_mitigations: ["M1022"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1548", "T1548.001"]
      - nist_sp_800-53: ["AC-5", "AC-6"]
      - pci_dss_v3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_v4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    condition: all
    rules:
      - "c:findmnt -kn /var/log/audit -> r:nosuid"

# 1.1.2.7.4 Ensure noexec option set on /var/log/audit partition. (Automated)
  - id: 35
    title: "Ensure noexec option set on /var/log/audit partition."
    description: "The noexec mount option specifies that the filesystem cannot contain executable binaries."
    rationale: "Since the /var/log/audit filesystem is only intended for audit logs, set this option to ensure that users cannot run executable binaries from /var/log/audit."
    remediation: "- IF - a separate partition exists for /var/log/audit. Edit the /etc/fstab file and add noexec to the fourth field (mounting options) for the /var/log/audit partition. Example: <device> /var/log/audit <fstype> defaults,rw,nosuid,nodev,noexec,relatime 0 0 Run the following command to remount /var/log/audit with the configured options: # mount -o remount /var/log/audit."
    level: "Level 1"
    compliance:
      - cis: ["1.1.2.7.4"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0: ["AC.L1-3.1.1", "AC.L1-3.1.2", "AC.L2-3.1.3", "AC.L2-3.1.5", "MP.L2-3.8.2"]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - iso_27001-2013: ["A.9.1.1"]
      - mitre_mitigations: ["M1022"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1204", "T1204.002"]
      - nist_sp_800-53: ["AC-5", "AC-6"]
      - pci_dss_v3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_v4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    condition: all
    rules:
      - "c:findmnt -kn /var/log/audit -> r:noexec"

# 1.2 - Package Management
# 1.2.1 - Configure Package Repositories
#
#
# The creation of a “to be verified” category seems necessary for rules that can only be implemented entirely manually.

# 1.2.1.1 Ensure GPG Keys are configured (Manual)
#  - id: 36
#    title: "Ensure GPG Keys are configured."
#    description: "Most package managers implement GPG Keys signing to verify package integrity during installation."
#    rationale: "It is important to ensure that updates are obtained from a valide source to protect against spoofing that could lead to the inadvertent installation of malware on the system."
#    remediation: "Update your package manager GPG keys in accordance with site policy."
#    level: "Level 1"
#    compliance:
#      - cis: ["1.2.1.1"]
#      - others: [""]
#    condition: all
#    rules:
#      - 
# This rule is currently not implementable because it requires human intervention

# 1.2.1.2 Ensure package manager repositories are configured (Manual)
#  - id: 37
#    title: "Ensure package manager repositories are configured."
#    description: "Systems need to have package manager repositories configured to ensure they receive the latest patches and updates."
#    rationale: "If a system's package repositories are misconfigured important patches may not be identified or a rogue repository could introduce compromised software."
#    remediation: "Configure your package manager repositories according to site policy."
#    level: "Level 1"
#    compliance:
#      - cis: ["1.2.1.2"]
#      - others: [""]
#    condition: all
#    rules:
#      - "c:apt-cache policy -> r:"
# This rule is currently not implementable because it requires human intervention

# 1.2.2 - Configure Package Updates
#
#

# 1.2.2.1 Ensure update, patches, and additional security software are installed. (Manual)
  - id: 38
    title: "Ensure updates, patches, and additionnal security software are installed."
    description: "Periodically patches are released for included software either due to security flaws or to include additional functionality."
    rationale: ""
    remediation: "Run the following command to update all packages following local site policy guidance. # apt update && apt upgrade or # apt update && apt dist-upgrade."
    level: "Level 1"
    compliance:
      - cis: ["1.2.2.1"]
      - mitre_mitigations: ["M1051"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1195", "T1195.001"]
      - others: [""]
    condition: all
    rules:
      - 'c:apt update -> r:^All packages are up to date.'
      - 'c:apt -s upgrade -> r:^0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.'

# 1.3 - Mandatory Access Control
# 1.3.1 - Configure AppArmor
#
#

# 1.3.1.1 Ensure AppArmor is installed. (Automated)
  - id: 39
    title: "Ensure AppArmor is installed."
    description: "AppArmor provides Mandatory Access Controls."
    rationale: "Without a Mandatory Access Control system installed only the default Discretionary Access Control system will be available."
    remediation: "Install AppArmor. # apt install apparmor apparmor-utils."
    level: "Level 1"
    compliance:
      - cis: ["1.3.1.1"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0: ["AC.L1-3.1.1", "AC.L1-3.1.2", "AC.L2-3.1.3", "AC.L2-3.1.5", "MP.L2-3.8.2"]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - iso_27001-2013: ["A.9.1.1"]
      - mitre_mitigations: ["M1026"]
      - mitre_tactics: ["TA0003"]
      - mitre_techniques: ["T1068", "T1565", "T1565.001", "T1565.003"]
      - nist_sp_800-53: ["AC-5", "AC-6"]
      - pci_dss_v3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_v4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    condition: all
    rules:
      - 'c:dpkg-query -W -f="\${Status}" apparmor -> r:^install ok installed$'
      - 'c:dpkg-query -W -f="\${Status}" apparmor-utils -> r:^install ok installed$'

# 1.3.1.2 Ensure AppArmor is enabled in the bootloader configuration. (Automated)
  - id: 40
    title: "Ensure AppArmor is enabled in the bootloader configuration."
    description: "Configure AppArmor to be enabled at boot time and verify that it has not been overwritten by the bootloader boot parameters. Note: This recommendation is designed around the grub bootloader, if LILO or another bootloader is in use in your environment enact equivalent settings."
    rationale: "AppArmor must be enabled at boot time in your bootloader configuration to ensure that the controls it provides are not overridden."
    remediation: 'Edit /etc/default/grub and add the apparmor=1 and security=apparmor parameters to the GRUB_CMDLINE_LINUX= line GRUB_CMDLINE_LINUX="apparmor=1 security=apparmor" Run the following command to update the grub2 configuration: # update-grub.'
    level: "Level 1"
    compliance:
      - cis: ["1.3.1.2"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0: ["AC.L1-3.1.1", "AC.L1-3.1.2", "AC.L2-3.1.3", "AC.L2-3.1.5", "MP.L2-3.8.2"]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - iso_27001-2013: ["A.9.1.1"]
      - mitre_mitigations: ["M1026"]
      - mitre_tactics: ["TA0003"]
      - mitre_techniques: ["T1068", "T1565", "T1565.001", "T1565.003"]
      - nist_sp_800-53: ["AC-5", "AC-6"]
      - pci_dss_v3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_v4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    condition: all
    rules:
      - 'f:/boot/grub/grub.cfg -> r:\s*\t*linux && !r:apparmor=1'
      - 'f:/boot/grub/grub.cfg -> r:\s*\t*linux && !r:security=apparmor'

# 1.3.1.3 Ensure AppArmor Profiles are in enforce or complain mode. (Automated)
  - id: 41
    title: "Ensure AppArmor Profiles are ine enforce or complain mode."
    description: "AppArmor profiles define what ressources applications are able to access."
    rationale: "Security configuration requirements vary from site to site. This item is intended to ensure that any policies that exist on the system are activated"
    remediation: "Run the following command to set all profiles to enforce mode : # aa-enforce /etc/apparmor.d/* or run this command to set in profiles to complain mode : # aa-complain /etc/apparmor.d/*. NOTE: Any unconfined processes may need to have a profile created or activated for them and then be restarted."
    level: "Level 1"
    compliance:
      - cis: ["1.3.1.3"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - mitre_mitigations: ["----"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1497"]
      - nist_sp_800-53: ["AC-3"]
    condition: all
    rules:
      - 'c:apparmor_status -> r:^\d+\s+profiles\s+are\s+loaded'
      - 'c:apparmor_status -> r:^\d+\s+profiles\s+are\s+in\s+enforce\s+mode'
      - 'c:apparmor_status -> r:^\d+\s+profiles\s+are\s+in\s+complain\s+mode'
      - 'not c:apparmor_status -> r:^[1-9]\d*\s+profiles\s+are\s+unconfined\s+mode'
      - 'not c:apparmor_status -> r:^[1-9]\d*\s+processes\s+are\s+unconfined'

# 1.3.1.4 Ensure all AppArmor Profiles are in enforce mode. (Automated)
  - id: 42
    title: "Ensure AppArmor Profiles are ine enforce or complain mode."
    description: "AppArmor profiles define what ressources applications are able to access."
    rationale: "Security configuration requirements vary from site to site. This item is intended to ensure that any policies that exist on the system are activated"
    remediation: "Run the following command to set all profiles to enforce mode : # aa-enforce /etc/apparmor.d/* or run this command to set in profiles to complain mode : # aa-complain /etc/apparmor.d/*. NOTE: Any unconfined processes may need to have a profile created or activated for them and then be restarted."
    level: "Level 2"
    compliance:
      - cis: ["1.3.1.4"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - mitre_mitigations: ["M1048"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1068", "T1068.000", "T1565", "T1565.001", "T14565.003"]
      - nist_sp_800-53: ["AC-3"]
    condition: all
    rules:
      - 'c:apparmor_status -> r:^[1-9]\d*\s+profiles\s+are\s+loaded'
      - 'c:apparmor_status -> r:^[1-9]\d*\s+profiles\s+are\s+in\s+enforce\s+mode'
      - 'c:apparmor_status -> r:^0\s+profiles\s+are\s+in\s+complain\s+mode'
      - 'c:apparmor_status -> r:^0\s+profiles\s+are\s+in\s+unconfined\s+mode'
      - 'c:apparmor_status -> r:^0\s+processes\s+are\s+unconfined'
      - 'c:apparmor_status -> r:^0\s+processes\s+are\s+in\s+complain\s+mode'

# 1.4 - Configure Bootloader
#
#

# 1.4.1 Ensure bootloader password is set. (Automated)
  - id: 43
    title: "Ensure bootloader password is set."
    description: "Setting the boot loader password will require that anyone rebooting the system must enter a password before being able to set command line boot parameters."
    rationale: "Requiring a boot password upon execution of the boot loader will prevent an unauthorized user from entering boot parameters or changing the boot partition. This prevents users from weakening security (e.g. turning off AppArmor at boot time)."
    impact: 'If password protection is enabled, only the designated superuser can edit a GRUB 2 menu item by pressing "e" or access the GRUB 2 command line by pressing "c" If GRUB 2 is set up to boot automatically to a password-protected menu entry the user has no option to back out of the password prompt to select another menu entry. Holding the SHIFT key will not display the menu in this case. The user must enter the correct username and password. If unable to do so, the configuration files will have to be edited via a LiveCD or other means to fix the problem You can add --unrestricted to the menu entries to allow the system to boot without entering a password. A password will still be required to edit menu items. More Information: https://help.ubuntu.com/community/Grub2/Passwords.'
    remediation: 'Create an encrypted password with grub-mkpasswd-pbkdf2: # grub-mkpasswd-pbkdf2 --iteration-count=600000 --salt=64 Enter password: <password> Reenter password: <password> PBKDF2 hash of your password is <encrypted-password> Add the following into a custom /etc/grub.d configuration file: cat <<EOF exec tail -n +2 $0 set superusers="<username>" password_pbkdf2 <username> <encrypted-password> EOF The superuser/user information and password should not be contained in the /etc/grub.d/00_header file as this file could be overwritten in a package update. If there is a requirement to be able to boot/reboot without entering the password, edit /etc/grub.d/10_linux and add --unrestricted to the line CLASS= Example: CLASS="--class gnu-linux --class gnu --class os --unrestricted" Run the following command to update the grub2 configuration: # update-grub.'
    level: "Level 1"
    compliance:
      - cis: ["1.4.1"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0: ["AC.L1-3.1.1", "AC.L1-3.1.2", "AC.L2-3.1.3", "AC.L2-3.1.5", "MP.L2-3.8.2"]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - iso_27001-2013: ["A.9.1.1"]
      - mitre_mitigations: ["M1046"]
      - mitre_tactics: ["TA0003"]
      - mitre_techniques: ["T1542"]
      - nist_sp_800-53: ["AC-5", "AC-6"]
      - pci_dss_v3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_v4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    condition: all
    rules:
      - 'f:/boot/grub/grub.cfg -> r:^\s*\t*set superusers="[\w@-]+"'
      - 'f:/boot/grub/grub.cfg -> r:^\s*\t*password_pbkdf2\s*\t*[\w@-]+\s+grub\.pbkdf2'

# 1.4.2 Ensure access to bootloader config is configured. (Automated)
  - id: 44
    title: "Ensure access to bootloader config is configured."
    description: "The grub configuration file contains information on boot settings and passwords for unlocking boot options."
    rationale: "Setting the permissions to read and write for root only prevents non-root users from seeing the boot parameters or changing them. Non-root users who read the boot parameters may be able to identify weaknesses in security upon boot and be able to exploit them."
    remediation: "Run the following commands to set permissions on your grub configuration: # chown root:root /boot/grub/grub.cfg # chmod u-x,go-rwx /boot/grub/grub.cfg."
    level: "Level 1"
    compliance:
      - cis: ["1.4.2"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0: ["AC.L1-3.1.1", "AC.L1-3.1.2", "AC.L2-3.1.3", "AC.L2-3.1.5", "MP.L2-3.8.2"]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - iso_27001-2013: ["A.9.1.1"]
      - mitre_mitigations: ["M1022"]
      - mitre_tactics: ["TA0005", "TA0007"]
      - mitre_techniques: ["T1542"]
      - nist_sp_800-53: ["AC-5", "AC-6"]
      - pci_dss_v3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_v4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    condition: all
    rules:
      - 'c:stat -Lc "%a %u %U %g %G" /boot/grub/grub.cfg -> r:^600 0 root 0 root'

# 1.5 - Configure additionnal Process Hardening
#
#

# 1.5.1 Ensure address layout randomization is enabled. (Automated)
  - id: 45
    title: "Ensure access to bootloader config is configured."
    description: "Address space layout randomization (ASLR) is an exploit mitigation technique which randomly arranges the address space of key data areas of a process."
    rationale: "Randomly placing virtual memory regions will make it difficult to write memory page exploits as the memory placement will be consistenly shiftings."
    remediation: "Set the parameter # kernel.randomuze_va_space = 2 in /etc/sysctl.conf or in a file in /etc/sysctl.d/ ending in .conf like va_space.conf."
    level: "Level 1"
    compliance:
      - cis: ["1.5.1"]
      - cis_csc_v8: ["10.5"]
      - cis_csc_v7: ["8.3"]
      - mitre_mitigations: ["M1050"]
      - mitre_tactics: ["TA0002"]
      - mitre_techniques: ["T1068", "T1068.000"]
      - nist_sp_800-53: ["CM-6"]
    condition: all
    rules:
      - 'c:sysctl kernel.randomize_va_space -> r:^kernel\.randomize_va_space\s*=\s*2$'
      - 'f:/etc/sysctl.conf,/etc/sysctl.d/va_space.conf -> r:^\s*kernel\.randomize_va_space\s*=\s*2'
      - 'f:/etc/sysctl.conf,/etc/sysctl.d/va_space.conf -> !r:^\s*kernel\.randomize_va_space\s*=\s*[01]\b'

# 1.5.2 Ensure ptrace_scope is restricted. (Automated)
  - id: 46
    title: "Ensure ptrace_scope is restricted"
    description: "The ptrace() system call provides a means by which one process may observe and control the execution of another process, and examine and change the tracee's memory registers."
    rationale: "If one application is compromised, it would be possible for an attacker to attach to other running processes to extract additional credentials and continue to expand the scope of their attack."
    remediation: "Set the parameter # kernel.yama.ptrace_scope parameter in /etc/sysctl.conf or in a file in /etc/sysctl.d/ ending in .conf (like ptrace.conf) to a value of 1,2 or 3."
    level: "Level 1"
    compliance:
      - cis: ["1.5.2"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["9.2"]
      - mitre_mitigations: ["1040"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1055", "T1055.008"]
      - nist_sp_800-53: ["CM-6"]
    condition: all
    rules:
      - 'c:sysctl kernel.yama.ptrace_scope -> r:^kernel\.yama\.ptrace_scope\s*=s\*[13]'
      - 'f:/etc/sysctl.conf,/etc/sysctl.d/ptrace.conf -> r:^kernel\.yama\.ptrace_scope\s*=s\*[13]'
      - 'f:/etc/sysctl.conf,/etc/sysctl.d/ptrace.conf -> !r:^kernel\.yama\.ptrace_scope\s*=s\*0\b'

# 1.5.3 Ensure core dumps are restricted. (Automated)
  - id: 47
    title: "Ensure core dumps are restricted"
    description: "A core dump is the memory of an executable program. It is used to determine why a program aborted. It can also be used to glean confidential information from a core file."
    rationale: "Setting a hard limit on a core dumps prevents users from overrinding the soft variable. If a core dumps are required, consider sttings limits for user groups."
    remediation: "Add the following line to /etc/security/limits.conf or a /etc/security/limits.d/ file (like hardcore.conf) # * hard core 0. Set the following parameter in /etc/sysctl.conf or a file in /etc/sysctl.d ending in .conf (like suiddump.conf) # fs.suid_dumpable = 0. If systemd-coredump is installed, edit /etc/systemd/coredump.conf and add/modify the following lines # Storage=none ProcessSizeMax=0. Then run # systemctl daemon-reload."
    level: "Level 1"
    compliance:
      - cis: ["1.5.3"]
      - nist_sp_800-53: ["CM-6"]
      - mitre_mitigations: ["M1057"]
      - mitre_tactics: ["TA0007"]
      - mitre_techniques: ["T1005", "T1005.000"]
    condition: all
    rules:
      - 'c:sysctl fs.suid_dumpable -> r:^\s*fs\.suid_dumpable\s*=\s*0$'
      - 'f:/etc/security/limits.conf -> r:^[^#;]\s*\*\s+hard\s*core\s*0\b'
      - 'f:/etc/security/limits.d/hardcore.conf -> r:^[^#;]\s*\*\s+hard\s*core\s*0\b'
      - 'f:/etc/sysctl.conf -> r:^[^#;]\s*fs\.suid_dumpable\s*=\s*0'
      - 'f:/etc/sysctl.conf.d/suiddump.conf -> r:^[^#;]\s*fs\.suid_dumpable\s*=\s*0'


# 1.5.3 Ensure core dumps are restricted. (Automated)
  - id: 48
    title: "Ensure core dumps are restricted with coredump"
    description: "A core dump is the memory of an executable program. It is used to determine why a program aborted. It can also be used to glean confidential information from a core file."
    rationale: "Setting a hard limit on a core dumps prevents users from overrinding the soft variable. If a core dumps are required, consider sttings limits for user groups."
    remediation: "Add the following line to /etc/security/limits.conf or a /etc/security/limits.d/* file # * hard core 0. Set the following parameter in /Etc/sysctl.conf or a file in /etc/sysctl.d ending in .conf # fs.suid_dumpable = 0. If systemd-coredump is installed, edit /etc/systemd/coredump.conf and add/modify the following lines # Storage=none ProcessSizeMax=0. Then run # systemctl daemon-reload."
    level: "Level 1"
    compliance:
      - cis: ["1.5.3"]
      - nist_sp_800-53: ["CM-6"]
      - mitre_mitigations: ["M1057"]
      - mitre_tactics: ["TA0007"]
      - mitre_techniques: ["T1005", "T1005.000"]
    condition: all
    rules:
      - 'c:dpkg-query -W -f="\${Status}" systemd-coredump -> r:^\s*install\s+ok\s+installed$'
      - 'f:/etc/systemd/coredump.conf -> r:^[^#;]\s*Storage=none$' 
      - 'f:/etc/systemd/coredump.conf -> r:^[^#;]\s*ProcessSizeMax=0$'

# 1.6 - Configure Command Line Warning Banners
#
#

# 1.6.1 Ensure message of the day is configured properly. (Automated)
  - id: 49
    title: "Ensure message of the day is configured properly."
    description: "The content of the /etc/motd file are displayed to users after login and function as a message of the day for authenticated users."
    rationale: "Warning messages inform users who are attempting to login to the system of their legal status regarding the system and must include the name of the organizations that owns the system and any monitoring policies that are in place. Displaying OS and patch level information in login banners also has the side effect of providing detailed system information to attackers attempting to target specific exploits of a system."
    remediation: "Edit the /etc/motd file with the appropriate contents according to you site policy, remove any instances of \\m, \\r, \\s,\\v or references to the OS platform. Or if the motd is not used, this file can be removed, run the following command to remove the motd file # rm /etc/motd."
    level: "Level 1"
    compliance:
      - cis: ["1.6.1"]
      - nist_sp_800-53: ["CM-6", "CM-1", "CM-3"]
      - mitre_mitigations: ["----"]
      - mitre_tactics: ["TA0007"]
      - mitre_techniques: ["T1082", "1082.000", "T1592", "T1592.004"]
    condition: any
    rules:
      - 'not f:/etc/motd'
      - 'not f:/etc/motd -> r:\\v|\\r|\\m|\s|Debian|Ubuntu'

# 1.6.2 Ensure local login warning banner is configured properly. (Automated)
  - id: 50
    title: "Ensure local warning banner is configured properly."
    description: "The contents of th /etc/issue file are displayed to users prior to login for local terminals."
    rationale: "Warning messages inform users who are attempting to login to the system of their legal status regarding the system and must include the name of the organizations that owns the system and any monitoring policies that are in place. Displaying OS and patch level information in login banners also has the side effect of providing detailed system information to attackers attempting to target specific exploits of a system."
    remediation: "Edit the /etc/issue file with the appropriate contents according to you site policy, remove any instances of \\m, \\r, \\s,\\v or references to the OS platform."
    level: "Level 1"
    compliance:
      - cis: ["1.6.2"]
      - nist_sp_800-53: ["CM-6", "CM-1", "CM-3"]
      - mitre_mitigations: ["----"]
      - mitre_tactics: ["TA0007"]
      - mitre_techniques: ["T1082", "1082.000", "T1592", "T1592.004"]
    condition: all
    rules:
      - 'not f:/etc/issue -> r:\\v|\\r|\\m|\s|Debian|Ubuntu'

# 1.6.3 Ensure remote login warning banner is configured properly. (Automated)
  - id: 51
    title: "Ensure remote warning banner is configured properly."
    description: "The contents of th /etc/issue.net file are displayed to users prior to login for local terminals."
    rationale: "Warning messages inform users who are attempting to login to the system of their legal status regarding the system and must include the name of the organizations that owns the system and any monitoring policies that are in place. Displaying OS and patch level information in login banners also has the side effect of providing detailed system information to attackers attempting to target specific exploits of a system."
    remediation: "Edit the /etc/issue.net file with the appropriate contents according to you site policy, remove any instances of \\m, \\r, \\s,\\v or references to the OS platform."
    level: "Level 1"
    compliance:
      - cis: ["1.6.3"]
      - nist_sp_800-53: ["CM-6", "CM-1", "CM-3"]
      - mitre_mitigations: ["----"]
      - mitre_tactics: ["TA0007"]
      - mitre_techniques: ["T1082", "1082.000", "T1592", "T1592.004"]
    condition: all
    rules:
      - 'not f:/etc/issue.net -> r:\\v|\\r|\\m|\s|Debian|Ubuntu'

# 1.6.4 Ensure access to /etc/motd is configured. (Automated)
  - id: 52
    title: "Ensure access to /etc/motd is configured."
    description: "The contents of the /etc/motd file are displayed to users after login and function as a message of the day for authenticated users."
    rationale: "- IF - the /etc/motd file does not have the correct access configured, it could be modified by unauthorized users with incorrect or misleading information."
    remediation: "Run the following commands to set mode, owner, and group on /etc/motd: # chown root:root $(readlink -e /etc/motd) # chmod u-x,go-wx $(readlink -e /etc/motd) - OR - Run the following command to remove the /etc/motd file: # rm /etc/motd."
    level: "Level 1"
    compliance:
      - cis: ["1.6.4"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0: ["AC.L1-3.1.1", "AC.L1-3.1.2", "AC.L2-3.1.3", "AC.L2-3.1.5", "MP.L2-3.8.2"]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - iso_27001-2013: ["A.9.1.1"]
      - mitre_mitigations: ["M1022"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1222", "T1222.002"]
      - nist_sp_800-53: ["AC-5", "AC-6"]
      - pci_dss_v3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_v4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    condition: any
    rules:
      - "not f:/etc/motd"
      - 'c:stat -Lc " %a %u %U %g %G" /etc/motd -> r:^644 0 root 0 root$ || ^600 0 root 0 root$ || ^400 0 root 0 root$'

# 1.6.5 Ensure access to /etc/issue is configured. (Automated)
  - id: 53
    title: "Ensure access to /etc/issue is configured."
    description: "The contents of the /etc/issue file are displayed to users prior to login for local terminals."
    rationale: "- IF - the /etc/issue file does not have the correct access configured, it could be modified by unauthorized users with incorrect or misleading information."
    remediation: "Run the following commands to set mode, owner, and group on /etc/issue: # chown root:root $(readlink -e /etc/issue) # chmod u-x,go-wx $(readlink -e /etc/issue)."
    level: "Level 1"
    compliance:
      - cis: ["1.6.5"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0: ["AC.L1-3.1.1", "AC.L1-3.1.2", "AC.L2-3.1.3", "AC.L2-3.1.5", "MP.L2-3.8.2"]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - iso_27001-2013: ["A.9.1.1"]
      - mitre_mitigations: ["M1022"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1222", "T1222.002"]
      - nist_sp_800-53: ["AC-5", "AC-6"]
      - pci_dss_v3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_v4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    condition: all
    rules:
      - 'c:stat -Lc " %a %u %U %g %G" /etc/issue -> r:^644 0 root 0 root$ || ^600 0 root 0 root$ || ^400 0 root 0 root$'

# 1.6.6 Ensure access to /etc/issue.net is configured. (Automated)
  - id: 54
    title: "Ensure access to /etc/issue.net is configured."
    description: "The contents of the /etc/issue.net file are displayed to users prior to login for remote connections from configured services."
    rationale: "- IF - the /etc/issue.net file does not have the correct access configured, it could be modified by unauthorized users with incorrect or misleading information."
    remediation: "Run the following commands to set mode, owner, and group on /etc/issue.net: # chown root:root $(readlink -e /etc/issue.net) # chmod u-x,go-wx $(readlink -e /etc/issue.net)."
    level: "Level 1"
    compliance:
      - cis: ["1.6.6"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0: ["AC.L1-3.1.1", "AC.L1-3.1.2", "AC.L2-3.1.3", "AC.L2-3.1.5", "MP.L2-3.8.2"]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - iso_27001-2013: ["A.9.1.1"]
      - mitre_mitigations: ["M1022"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1222", "T1222.002"]
      - nist_sp_800-53: ["AC-5", "AC-6"]
      - pci_dss_v3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_v4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    condition: all
    rules:
      - 'c:stat -Lc "%a %u %U %g %G" /etc/issue.net -> r:^644 0 root 0 root$ || ^600 0 root 0 root$ || ^400 0 root 0 root$'

# 1.7 - Configure GNOME Display Manager
#
#

# 1.7.1 Ensure GDM is removed. (Automated)
  - id: 55
    title: "Ensure GDM is removed."
    description: "The GNOME Display Manager (GDM) is a program that manages graphical display servers and handles graphical user logins."
    rationale: "If a Graphical User Interface (GUI) is not required, it should be removed to reduce the attack surface of the system."
    impact: "Removing the GNOME Display manager will remove the Graphical User Interface (GUI) from the system."
    remediation: "Run the following commands to uninstall gdm3 and remove unused dependencies: # apt purge gdm3 # apt autoremove gdm3."
    level: "Level 2"
    compliance:
      - cis: ["1.7.1"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["9.2"]
      - cmmc_v2.0: ["CM.L2-3.4.7", "CM.L2-3.4.8", "SC.L2-3.13.6"]
      - iso_27001-2013: ["A.13.1.3"]
      - mitre_mitigations: ["M1033"]
      - mitre_tactics: ["TA0002"]
      - mitre_techniques: ["T1543", "T1543.002"]
      - pci_dss_v3.2.1: ["1.1.6", "1.2.1", "2.2.2", "2.2.5"]
      - pci_dss_v4.0: ["1.2.5", "2.2.4", "6.4.1"]
      - soc_2: ["CC6.3", "CC6.6"]
    condition: all
    rules:
      - 'not c:dpkg-query -W -f="\${Status}" gdm3 -> r:^install ok installed$'

# 1.7.2 Ensure GDM login banner is configured. (Automated)
  - id: 56
    title: "Ensure GDM login banner is configured"
    description: "GDM is the Gnome Display Manager which handles graphic login for GNOME based systems."
    rationale: "Warnin messages inform users who are attempting to login to the system of their legal status regarding th system and must include the name of the organization that owns the system and any monitoring policies that are in place."
    impact:
    remediation: "IF A user profile is already created run the following commands to set and enable the text banner message on login screen: # cgsettings set org.gnome.login-screen banner-message-text 'Authorized uses only. All activity may be monitored and reported' # gsettings set org.gnome.login-screen banner-message-enable true. OR A user profile does not existe, create or edit the gdm profile in the /etc/dconf/profile/gdm with the following lines : # user-db:user system-db:gdm file-db:/usr/share/gdm/greeter-dconf-defaults. Create a gdm keyfile for machine-wide settings in /etc/dconf/db/gdm.d/01-banner-message : [org/gnome/login-screen] banner-message-enable=true banner-message-text='Type the banner message here.' Then update the system databases : # dconf update."
    level: "Level 1"
    compliance:
      - cis: ["1.7.2"]
      - nist_sp_800-53: ["CM-1", "CM-2", "CM-6", "CM-7", "IA-5"]
      - mitre_mitigations: ["M1028"]
      - mitre_tactics: ["TA0007"]
      - mitre_techniques: ["T1078", "T1078.001", "T1078.002", "T1078.003", "T1087", "T1087.001", "T1087.002"]
    condition: all
    rules:
      - 'c:gsettings get org.gnome.login-screen banner-message-enable -> r:^true$'
      - 'not c:gsettings get org.gnome.login-screen banner-message-text -> r:^''''$'

# 1.7.3 Ensure GDM disable-user-list option is enabled. (Automadted)
  - id: 57
    title: "Ensure GDM disable-user-list is enabled"
    description: "GDM is the Gnome Display Manager which handles graphic login for GNOME based systems. The disable-user-list options control if a list of users is displayed on the login screen."
    rationale: "Displaying the user list eliminates half of the Userid/Password equation that an unauthorized person would need to log on."
    impact:
    remediation: "IF a user profile exists run the following command to enable the disblae-user-list: # gsettings set org.gnome.login-screen disable-user-list true. OR a user profile does not existe, create or edit the gdm profile in /etc/dconf/profile.gdm with the following lines: # user-db:user system-db:gdm file-db:/usr/share/gdm/greeter-dconf-defaults. Create a gdm keyfile for machine-wide settings in /etc/dconf/db/gdm.d/00-login-screen: [org/gnome/login-screen] disable-user-list=true. The update the system databases: # dconf update."
    level: "Level 1"
    compliance:
      - cis: ["1.7.2"]
      - nist_sp_800-53: ["CM-1", "CM-2", "CM-6", "CM-7", "IA-5"]
      - mitre_mitigations: ["M1028"]
      - mitre_tactics: ["TA0007"]
      - mitre_techniques: ["T1078", "T1078.001", "T1078.002", "T1078.003", "T1087", "T1087.001", "T1087.002"]
    condition: all
    rules:
      - 'c:gsettings get org.gnome.login-screen disable-user-list -> r:^true$'

# 1.7.4 Ensure GDM screen locks when the user is idle. (Automated)
  - id: 58
    title: "Ensure GDM screen locks when the user is idle."
    description: "GNOME Desktop Manager can make the screen lock automatically whenever the user is idle for some amount of time."
    rationale: "Settings a lock-out value reduces the window of opportunity for unauthorized user access to another user's session that has been left unattended."
    impact:
    remediation: "IF a user profile is already created run the following commands enable screen locks when the user is idle: # gsettings set org.gnome.desktop.screensaver lock-delay 5 # gsettings set org.gnome.desktop.session idle-delay 900. IF a user profile does not exist, create or edit the user profile in the /etc/dconf/profile/ and verify it includes the following: # user-db:user system-db:{NAME_OF_DCONF_DATABASE}. Create the directory /etc/dconf/dc/local.d/ if it doesn't existe. Create the keyfile /etc/dconf/db/local.d/00-screensaver to provide information for the local database. Exemple key file : # Specify the dconf path [org/gnome/desktop/session] # Number of seconds of inactivity before the screen goes blank # Set to 0 seconds if you want to deactivate the screensaver. idle-delay=uint32 180 # Specify the dconf path [org/gnome/desktop/screensaver] # Number of seconds after the screen is blank before locking the screen lock-delay=uint32 0. Then run the following command to update the system databases: # dconf update."
    level: "Level 1"
    compliance: 
      - cis: ["1.7.4"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["16.11"]
      - mitre_mitigations: ["M1012"]
      - mitre_tactics: ["TA0027"]
      - mitre_techniques: ["T1461"]
    condition: all
    rules:
      - 'c:gsettings get org.gnome.desktop.screensaver lock-delay  | awk ''{print $2}'' -> n:(\d+) compare <= 5'
      - 'c:gsettings get org.gnome.desktop.session idle-delay | awk ''{print $2}'' -> n:(\d+) compare <= 900'

# 1.7.5 Ensure GDM screen locks cannot be overriden. (Automated)
  - id: 59
    title: "Ensure GDM scree, locks cannot be overridden."
    description: "GNOME Desktop Manager can lock down specific settings by using the lockdown mode in dconf to prevent users from changing specific settings. To lock down a dconf key or subpath, create a locks subdirectory in the keyfile directory. The files inside this directory contain a list of keys or subpaths to lock. Just as with the keyfiles, you may add any number of files to this directory."
    rationale: "Setting a lock-out value reduces the window of opportunity for unauthorized user access to another user's session that has been left unattended. Without locking down the system settings, user settings take precedence over the system settings."
    impact:
    remediation: "To prevent the user from overriding these settings, create a file /etc/dconf/db/local.d/00-screensaver with the following content: # /org/gnome/desktop/session/idle-delay # /org/gnome/desktop/screensaver/lock-delay. The update the system database : # dconf update."
    level: "Level 1"
    compliance:
      - cis: ["1.7.5"]
      - nist_sp_800-53: ["CM-11"]
      - cis_csc_v8: ["4.3"]
      - cis_csc_v7: ["16.11"]
      - mitre_mitigations: ["M1001"]
      - mitre_tactics: ["TA0027"]
      - mitre_techniques: ["T1456"]
    condition: all
    rules:
      - 'f:/etc/dconf/db/local.d/locks/00-screensaver -> r:^[^";]\s*/org/gnome/desktop/session/idle-delay\b'
      - 'f:/etc/dconf/db/local.d/locks/00-screensaver -> r:^[^";]\s*/org/gnome/desktop/screensaver/lock-delay\b'

# 1.7.6 Ensure GDM automatic mounting of removable media is disabled. (Automated) --- Implementation in progress
# 1.7.7 Ensure GDM disabling automatic mountig of removable media is not overriden. (Automated) --- Implementation in progress
# 1.7.8 Ensure GDM autorun-never is enabled. (Automated) --- Implementation in progress
# 1.7.9 Ensure GDM autorun-never is not overriden. (Automated) --- Implementation in progress
# 1.7.10 Ensure XDMCP is not enabled. (Automated) --- Implementation in progress


# 2 - Services
# 2.1 - Configure Server Services
#
#

# 2.1.1 Ensure autofs service are not in use. (Automated)
  - id: 65
    title: "Ensure autofs services are not in use."
    description: "autofs allows automatic mounting of devices, typically including CD/DVDs and USB drives."
    rationale: "With automounting enabled anyone with physical access could attach a USB drive or disc and have its contents available in the filesystem even if they lacked permissions to mount it themselves."
    impact: "The use of portable hard drives is very common for workstation users. If your organization allows the use of portable storage or media on workstations and physical access controls to workstations is considered adequate there is little value add in turning off automounting. There may be packages that are dependent on the autofs package. If the autofs package is removed, these dependent packages will be removed as well. Before removing the autofs package, review any dependent packages to determine if they are required on the system. - IF - a dependent package is required: stop and mask the autofs.service leaving the autofs package installed."
    remediation: "Run the following commands to stop autofs.service and remove the autofs package: # systemctl stop autofs.service # apt purge autofs - OR - - IF - the autofs package is required as a dependency: Run the following commands to stop and mask autofs.service: # systemctl stop autofs.service # systemctl mask autofs.service."
    level: "Level 1"
    compliance:
      - cis: ["2.1.2"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["9.2"]
      - cmmc_v2.0: ["CM.L2-3.4.7", "CM.L2-3.4.8", "SC.L2-3.13.6"]
      - iso_27001-2013: ["A.13.1.3"]
      - mitre_mitigations: ["M1042"]
      - mitre_tactics: ["TA0008"]
      - mitre_techniques: ["T1203", "T1210", "T1543", "T1543.002"]
      - pci_dss_v3.2.1: ["1.1.6", "1.2.1", "2.2.2", "2.2.5"]
      - pci_dss_v4.0: ["1.2.5", "2.2.4", "6.4.1"]
      - soc_2: ["CC6.3", "CC6.6"]
    condition: any
    rules:
      - 'not c:dpkg-query -W -f="\${Status}" autofs -> r:^install ok installed$'
      - 'not c:systemctl is-enabled autofs.service -> r:^enabled$'
      - 'not c:systemctl is-active autofs.service -> r:^active$'
    
# 2.1.2 Ensure avahi daemon services are not in use. (Automated)
  - id: 66
    title: "Ensure avahi daemon services are not in use."
    description: "Avahi is a free zeroconf implementation, including a system for multicast DNS/DNS-SD service discovery. Avahi allows programs to publish and discover services and hosts running on a local network with no specific configuration. For example, a user can plug a computer into a network and Avahi automatically finds printers to print to, files to look at and people to talk to, as well as network services running on the machine."
    rationale: "Automatic discovery of network services is not normally required for system functionality. It is recommended to remove this package to reduce the potential attack surface."
    impact: "There may be packages that are dependent on the avahi package. If the avahi package is removed, these dependent packages will be removed as well. Before removing the avahi package, review any dependent packages to determine if they are required on the system. - IF - a dependent package is required: stop and mask the avahi-daemon.socket and avahi-daemon.service leaving the avahi package installed."
    remediation: "Run the following commands to stop avahi-daemon.socket and avahi-daemon.service, and remove the avahi-daemon package: # systemctl stop avahi-daemon.socket avahi-daemon.service # apt purge avahi-daemon - OR -- IF - the avahi-daemon package is required as a dependency: Run the following commands to stop and mask the avahi-daemon.socket and avahi-daemon.service: # systemctl stop avahi-daemon.socket avahi-daemon.service # systemctl mask avahi-daemon.socket avahi-daemon.service."
    level: "Level 1"
    compliance:
      - cis: ["2.1.2"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["9.2"]
      - cmmc_v2.0: ["CM.L2-3.4.7", "CM.L2-3.4.8", "SC.L2-3.13.6"]
      - iso_27001-2013: ["A.13.1.3"]
      - mitre_mitigations: ["M1042"]
      - mitre_tactics: ["TA0008"]
      - mitre_techniques: ["T1203", "T1210", "T1543", "T1543.002"]
      - pci_dss_v3.2.1: ["1.1.6", "1.2.1", "2.2.2", "2.2.5"]
      - pci_dss_v4.0: ["1.2.5", "2.2.4", "6.4.1"]
      - soc_2: ["CC6.3", "CC6.6"]
    condition: any
    rules:
      - 'not c:dpkg-query -W -f="\${Status}" avahi-daemon -> r:^install ok installed$'
      - 'not c:systemctl is-enabled avahi-daemon.socket avahi-daemon.service -> r:^enabled$'
      - 'not c:systemctl is-active avahi-daemon.socket avahi-daemon.service -> r:^active$'

# 2.1.3 Ensure dhcp server services are not in use. (Automated)
  - id: 67
    title: "Ensure dhcp server services are not in use."
    description: "The Dynamic Host Configuration Protocol (DHCP) is a service that allows machines to be dynamically assigned IP addresses. There are two versions of the DHCP protocol DHCPv4 and DHCPv6. At startup the server may be started for one or the other via the -4 or -6 arguments."
    rationale: "Unless a system is specifically set up to act as a DHCP server, it is recommended that this package be removed to reduce the potential attack surface."
    impact: "There may be packages that are dependent on the isc-dhcp-server package. If the isc-dhcp-server package is removed, these dependent packages will be removed as well. Before removing the isc-dhcp-server package, review any dependent packages to determine if they are required on the system. - IF - a dependent package is required: stop and mask the isc-dhcp-server.service and isc-dhcp-server6.service leaving the isc-dhcp-server package installed."
    remediation: "Run the following commands to stop isc-dhcp-server.service and isc-dhcp- server6.service and remove the isc-dhcp-server package: # systemctl stop isc-dhcp-server.service isc-dhcp-server6.service # apt purge isc-dhcp-server - OR -- IF - the isc-dhcp-server package is required as a dependency: Run the following commands to stop and mask isc-dhcp-server.service and isc - dhcp-server6.service: # systemctl stop isc-dhcp-server.service isc-dhcp-server6.service # systemctl mask isc-dhcp-server isc-dhcp-server6.service."
    references:
      - "http://www.isc.org/software/dhcp."
    level: "Level 1"
    compliance:
      - cis: ["2.1.3"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["9.2"]
      - cmmc_v2.0: ["CM.L2-3.4.7", "CM.L2-3.4.8", "SC.L2-3.13.6"]
      - iso_27001-2013: ["A.13.1.3"]
      - mitre_mitigations: ["M1042"]
      - mitre_tactics: ["TA0008"]
      - mitre_techniques: ["T1203", "T1210", "T1543", "T1543.002"]
      - pci_dss_v3.2.1: ["1.1.6", "1.2.1", "2.2.2", "2.2.5"]
      - pci_dss_v4.0: ["1.2.5", "2.2.4", "6.4.1"]
      - soc_2: ["CC6.3", "CC6.6"]
    condition: any
    rules:
      - 'not c:dpkg-query -W -f="\${Status}" isc-dhcp-server -> r:^install ok installed$'
      - 'not c:systemctl is-enabled isc-dhcp-server.service isc-dhcp-server6.service -> r:^enabled$'
      - 'not c:systemctl is-active isc-dhcp-server.service isc-dhcp-server6.service -> r:^active$'

# 2.1.4 Ensure dns server services are not in use. (Automated)
  - id: 68
    title: "Ensure dns server services are not in use."
    description: "The Domain Name System (DNS) is a hierarchical naming system that maps names to IP addresses for computers, services and other resources connected to a network. Note: bind9 is the package and bind.service is the alias for named.service."
    rationale: "Unless a system is specifically designated to act as a DNS server, it is recommended that the package be deleted to reduce the potential attack surface."
    impact: "There may be packages that are dependent on the bind9 package. If the bind9 package is removed, these dependent packages will be removed as well. Before removing the bind9 package, review any dependent packages to determine if they are required on the system. - IF - a dependent package is required: stop and mask named.service leaving the bind9 package installed."
    remediation: "Run the following commands to stop named.service and remove the bind9 package: # systemctl stop named.service # apt purge bind9 - OR - - IF - the bind9 package is required as a dependency: Run the following commands to stop and mask bind9.service: # systemctl stop named.service # systemctl mask named.service."
    level: "Level 1"
    compliance:
      - cis: ["2.1.4"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["9.2"]
      - cmmc_v2.0: ["CM.L2-3.4.7", "CM.L2-3.4.8", "SC.L2-3.13.6"]
      - iso_27001-2013: ["A.13.1.3"]
      - mitre_mitigations: ["M1042"]
      - mitre_tactics: ["TA0008"]
      - mitre_techniques: ["T1203", "T1210", "T1543", "T1543.002"]
      - pci_dss_v3.2.1: ["1.1.6", "1.2.1", "2.2.2", "2.2.5"]
      - pci_dss_v4.0: ["1.2.5", "2.2.4", "6.4.1"]
      - soc_2: ["CC6.3", "CC6.6"]
    condition: any
    rules:
      - 'not c:dpkg-query -W -f="\${Status}" bind9 -> r:^install ok installed$'
      - 'not c:systemctl is-enabled named.service -> r:^enabled$'
      - 'not c:systemctl is-active named.service -> r:^active$'


# 2.1.5 Ensure dnsmasq services are not in use. (Automated)
  - id: 69
    title: "Ensure dnsmasq services are not in use."
    description: "dnsmasq is a lightweight tool that provides DNS caching, DNS forwarding and DHCP (Dynamic Host Configuration Protocol) services."
    rationale: "Unless a system is specifically designated to act as a DNS caching, DNS forwarding and/or DHCP server, it is recommended that the package be removed to reduce the potential attack surface."
    impact: "There may be packages that are dependent on the dnsmasq package. If the dnsmasq package is removed, these dependent packages will be removed as well. Before removing the dnsmasq package, review any dependent packages to determine if they are required on the system. - IF - a dependent package is required: stop and mask the dnsmasq.service leaving the dnsmasq package installed."
    remediation: "Run the following commands to stop dnsmasq.service and remove dnsmasq package: # systemctl stop dnsmasq.service # apt purge dnsmasq - OR - - IF - the dnsmasq package is required as a dependency: Run the following commands to stop and mask the dnsmasq.service: # systemctl stop dnsmasq.service # systemctl mask dnsmasq.service."
    compliance:
      - cis: ["2.1.5"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["9.2"]
      - cmmc_v2.0: ["CM.L2-3.4.7", "CM.L2-3.4.8", "SC.L2-3.13.6"]
      - iso_27001-2013: ["A.13.1.3"]
      - mitre_mitigations: ["M1042"]
      - mitre_tactics: ["TA0008"]
      - mitre_techniques: ["T1203", "T1210", "T1543", "T1543.002"]
      - pci_dss_v3.2.1: ["1.1.6", "1.2.1", "2.2.2", "2.2.5"]
      - pci_dss_v4.0: ["1.2.5", "2.2.4", "6.4.1"]
      - soc_2: ["CC6.3", "CC6.6"]
    condition: any
    rules:
      - 'not c:dpkg-query -W -f="\${Status}" dnsmasq -> r:^install ok installed$'
      - 'not c:systemctl is-enabled dnsmasq.service -> r:^enabled$'
      - 'not c:systemctl is-active dnsmasq.service -> r:^active$'


# 2.1.6 Ensure ftp server services are not in use. (Automated)
  - id: 70
    title: "Ensure ftp server services are not in use."
    description: "The File Transfer Protocol (FTP) provides networked computers with the ability to transfer files. vsftpd is the Very Secure File Transfer Protocol Daemon."
    rationale: "FTP does not protect the confidentiality of data or authentication credentials. It is recommended SFTP be used if file transfer is required. Unless there is a need to run the system as a FTP server (for example, to allow anonymous downloads), it is recommended that the package be deleted to reduce the potential attack surface."
    impact: "There may be packages that are dependent on the vsftpd package. If the vsftpd package is removed, these dependent packages will be removed as well. Before removing the vsftpd package, review any dependent packages to determine if they are required on the system. - IF - a dependent package is required: stop and mask the vsftpd.service leaving the vsftpd package installed."
    remediation: "Run the following commands to stop vsftpd.service and remove the vsftpd package: # systemctl stop vsftpd.service # apt purge vsftpd - OR - - IF - the vsftpd package is required as a dependency: Run the following commands to stop and mask the vsftpd.service: # systemctl stop vsftpd.service # systemctl mask vsftpd.service Note: Other ftp server packages may exist. If not required and authorized by local site policy, they should also be removed. If the package is required for a dependency, the service should be stopped and masked."
    level: "Level 1"
    compliance:
      - cis: ["2.1.6"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["9.2"]
      - cmmc_v2.0: ["CM.L2-3.4.7", "CM.L2-3.4.8", "SC.L2-3.13.6"]
      - iso_27001-2013: ["A.13.1.3"]
      - mitre_mitigations: ["M1042"]
      - mitre_tactics: ["TA0008"]
      - mitre_techniques: ["T1203", "T1210", "T1543", "T1543.002"]
      - pci_dss_v3.2.1: ["1.1.6", "1.2.1", "2.2.2", "2.2.5"]
      - pci_dss_v4.0: ["1.2.5", "2.2.4", "6.4.1"]
      - soc_2: ["CC6.3", "CC6.6"]
    condition: any
    rules:
      - 'not c:dpkg-query -W -f="\${Status}" vsftpd -> r:^install ok installed$'
      - 'not c:systemctl is-enabled vsftpd.service -> r:^enabled$'
      - 'not c:systemctl is-active vsftpd.service -> r:^active$'

# 2.1.7 Ensure ldap server services are not in use. (Automated)
  - id: 71
    title: "Ensure ldap server services are not in use."
    description: "The Lightweight Directory Access Protocol (LDAP) was introduced as a replacement for NIS/YP. It is a service that provides a method for looking up information from a central database."
    rationale: "If the system will not need to act as an LDAP server, it is recommended that the software be removed to reduce the potential attack surface."
    impact: "There may be packages that are dependent on the slapd package. If the slapd package is removed, these dependent packages will be removed as well. Before removing the slapd package, review any dependent packages to determine if they are required on the system. - IF - a dependent package is required: stop and mask the slapd.service leaving the slapd package installed."
    remediation: "Run the following commands to stop slapd.service and remove the slapd package: # systemctl stop slapd.service # apt purge slapd - OR - - IF - the slapd package is required as a dependency: Run the following commands to stop and mask slapd.service: # systemctl stop slapd.service # systemctl mask slapd.service."
    references:
      - "http://www.openldap.org."
    level: "Level 1"
    compliance:
      - cis: ["2.1.7"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["9.2"]
      - cmmc_v2.0: ["CM.L2-3.4.7", "CM.L2-3.4.8", "SC.L2-3.13.6"]
      - iso_27001-2013: ["A.13.1.3"]
      - mitre_mitigations: ["M1042"]
      - mitre_tactics: ["TA0008"]
      - mitre_techniques: ["T1203", "T1210", "T1543", "T1543.002"]
      - pci_dss_v3.2.1: ["1.1.6", "1.2.1", "2.2.2", "2.2.5"]
      - pci_dss_v4.0: ["1.2.5", "2.2.4", "6.4.1"]
      - soc_2: ["CC6.3", "CC6.6"]
    condition: any
    rules:
      - 'not c:dpkg-query -W -f="\${Status}" slapd -> r:^install ok installed$'
      - 'not c:systemctl is-enabled slapd.service -> r:^enabled$'
      - 'not c:systemctl is-active slapd.service -> r:^active$'

# 2.1.8 Ensure message access server services are not in use. (Automated)
  - id: 72
    title: "Ensure message access server services are not in use."
    description: "dovecot-imapd and dovecot-pop3d are an open source IMAP and POP3 server for Linux based systems."
    rationale: "Unless POP3 and/or IMAP servers are to be provided by this system, it is recommended that the package be removed to reduce the potential attack surface. Note: Several IMAP/POP3 servers exist and can use other service names. These should also be audited and the packages removed if not required."
    impact: "There may be packages that are dependent on dovecot-imapd and/or dovecot-pop3d packages. If dovecot-imapd and dovecot-pop3d packages are removed, these dependent packages will be removed as well. Before removing dovecot-imapd and/or dovecot-pop3d packages, review any dependent packages to determine if they are required on the system. - IF - a dependent package is required: stop and mask dovecot.socket and dovecot.service leaving dovecot-imapd and/or dovecot-pop3d packages installed."
    remediation: "Run one of the following commands to remove dovecot-imapd and dovecot-pop3d: Run the following commands to stop dovecot.socket and dovecot.service, and remove the dovecot-imapd and dovecot-pop3d packages: # systemctl stop dovecot.socket dovecot.service # apt purge dovecot-imapd dovecot-pop3d - OR - - IF - a package is installed and is required for dependencies: Run the following commands to stop and mask dovecot.socket and dovecot.service: # systemctl stop dovecot.socket dovecot.service # systemctl mask dovecot.socket dovecot.service."
    level: "Level 1"
    compliance:
      - cis: ["2.1.8"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["9.2"]
      - cmmc_v2.0: ["CM.L2-3.4.7", "CM.L2-3.4.8", "SC.L2-3.13.6"]
      - iso_27001-2013: ["A.13.1.3"]
      - mitre_mitigations: ["M1042"]
      - mitre_tactics: ["TA0008"]
      - mitre_techniques: ["T1203", "T1210", "T1543", "T1543.002"]
      - pci_dss_v3.2.1: ["1.1.6", "1.2.1", "2.2.2", "2.2.5"]
      - pci_dss_v4.0: ["1.2.5", "2.2.4", "6.4.1"]
      - soc_2: ["CC6.3", "CC6.6"]
    condition: any
    rules:
      - 'not c:dpkg-query -W -f="\${Status}" dovecot-imapd dovecot-pop3d -> r:^install ok installed$'
      - 'not c:systemctl is-enabled dovecot.socket dovecot.service -> r:^enabled$'
      - 'not c:systemctl is-active dovecot.socket dovecot.service -> r:^active$'

# 2.1.9 Ensure network file system services are not in use. (Automated)
  - id: 73
    title: "Ensure network file system services are not in use."
    description: "The Network File System (NFS) is one of the first and most widely distributed file systems in the UNIX environment. It provides the ability for systems to mount file systems of other servers through the network."
    rationale: "If the system does not export NFS shares, it is recommended that the nfs-kernel-server package be removed to reduce the remote attack surface."
    impact: "There may be packages that are dependent on the nfs-kernel-server package. If the nfs-kernel-server package is removed, these dependent packages will be removed as well. Before removing the nfs-kernel-server package, review any dependent packages to determine if they are required on the system. - IF - a dependent package is required: stop and mask the nfs-server.service leaving the nfs-kernel-server package installed."
    remediation: "Run the following command to stop nfs-server.service and remove nfs-kernel- server package: # systemctl stop nfs-server.service # apt purge nfs-kernel-server - OR - - IF - the nfs-kernel-server package is required as a dependency: Run the following commands to stop and mask the nfs-server.service: # systemctl stop nfs-server.service # systemctl mask nfs-server.service."
    level: "Level 1"
    compliance:
      - cis: ["2.1.9"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["9.2"]
      - cmmc_v2.0: ["CM.L2-3.4.7", "CM.L2-3.4.8", "SC.L2-3.13.6"]
      - iso_27001-2013: ["A.13.1.3"]
      - mitre_mitigations: ["M1042"]
      - mitre_tactics: ["TA0008"]
      - mitre_techniques: ["T1005", "T1039", "T1083", "T1135", "T1210"]
      - pci_dss_v3.2.1: ["1.1.6", "1.2.1", "2.2.2", "2.2.5"]
      - pci_dss_v4.0: ["1.2.5", "2.2.4", "6.4.1"]
      - soc_2: ["CC6.3", "CC6.6"]
    condition: any
    rules:
      - 'not c:dpkg-query -W -f="\${Status}" nfs-kernel-server -> r:^install ok installed$'
      - 'not c:systemctl is-enabled nfs-server.service -> r:^enabled$'
      - 'not c:systemctl is-active nfs-server.service -> r:^active$'

# 2.1.10 Ensure nis server services are not in use. (Automated)
  - id: 74
    title: "Ensure nis server services are not in use."
    description: "The Network Information Service (NIS) (formally known as Yellow Pages) is a client-server directory service protocol for distributing system configuration files. The NIS server is a collection of programs that allow for the distribution of configuration files. The NIS client (ypbind) was used to bind a machine to an NIS server and receive the distributed configuration files."
    rationale: "ypserv.service is inherently an insecure system that has been vulnerable to DOS attacks, buffer overflows and has poor authentication for querying NIS maps. NIS generally has been replaced by such protocols as Lightweight Directory Access Protocol (LDAP). It is recommended that ypserv.service be removed and other, more secure services be used."
    impact: "There may be packages that are dependent on the ypserv package. If the ypserv package is removed, these dependent packages will be removed as well. Before removing the ypserv package, review any dependent packages to determine if they are required on the system. - IF - a dependent package is required: stop and mask the ypserv.service leaving the ypserv package installed."
    remediation: "Run the following commands to stop ypserv.service and remove ypserv package: # systemctl stop ypserv.service # apt purge ypserv - OR - - IF - the ypserv package is required as a dependency: Run the following commands to stop and mask ypserv.service: # systemctl stop ypserv.service # systemctl mask ypserv.service."
    level: "Level 1"
    compliance:
      - cis: ["2.1.10"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["9.2"]
      - cmmc_v2.0: ["CM.L2-3.4.7", "CM.L2-3.4.8", "SC.L2-3.13.6"]
      - iso_27001-2013: ["A.13.1.3"]
      - mitre_mitigations: ["M1042"]
      - mitre_tactics: ["TA0008"]
      - mitre_techniques: ["T1203", "T1210", "T1543", "T1543.002"]
      - pci_dss_v3.2.1: ["1.1.6", "1.2.1", "2.2.2", "2.2.5"]
      - pci_dss_v4.0: ["1.2.5", "2.2.4", "6.4.1"]
      - soc_2: ["CC6.3", "CC6.6"]
    condition: any
    rules:
      - 'not c:dpkg-query -W -f="\${Status}" ypserv -> r:^install ok installed$'
      - 'not c:systemctl is-enabled ypserv.service -> r:^enabled$'
      - 'not c:systemctl is-active ypserv.service -> r:^active$'

# 2.1.11 Ensure print server services are not in use. (Automated)
  - id: 75
    title: "Ensure print server services are not in use."
    description: "The Common Unix Print System (CUPS) provides the ability to print to both local and network printers. A system running CUPS can also accept print jobs from remote systems and print them to local printers. It also provides a web based remote administration capability."
    rationale: "If the system does not need to print jobs or accept print jobs from other systems, it is recommended that CUPS be removed to reduce the potential attack surface."
    impact: "Removing the cups package, or disabling cups.socket and/or cups.service will prevent printing from the system, a common task for workstation systems. There may be packages that are dependent on the cups package. If the cups package is removed, these dependent packages will be removed as well. Before removing the cups package, review any dependent packages to determine if they are required on the system. - IF - a dependent package is required: stop and mask cups.socket and cups.service leaving the cups package installed."
    remediation: "Run the following commands to stop cups.socket and cups.service, and remove the cups package: # systemctl stop cups.socket cups.service # apt purge cups - OR - - IF - the cups package is required as a dependency: Run the following commands to stop and mask the cups.socket and cups.service: # systemctl stop cups.socket cups.service # systemctl mask cups.socket cups.service."
    references:
      - "http://www.cups.org"
    level: "Level 1"
    compliance:
      - cis: ["2.1.11"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["9.2"]
      - cmmc_v2.0: ["CM.L2-3.4.7", "CM.L2-3.4.8", "SC.L2-3.13.6"]
      - iso_27001-2013: ["A.13.1.3"]
      - mitre_mitigations: ["M1042"]
      - mitre_tactics: ["TA0008"]
      - mitre_techniques: ["T1203", "T1210", "T1543", "T1543.002"]
      - pci_dss_v3.2.1: ["1.1.6", "1.2.1", "2.2.2", "2.2.5"]
      - pci_dss_v4.0: ["1.2.5", "2.2.4", "6.4.1"]
      - soc_2: ["CC6.3", "CC6.6"]
    condition: any
    rules:
      - 'not c:dpkg-query -W -f="\${Status}" cups -> r:^install ok installed$'
      - 'not c:systemctl is-enabled cups.socket cups.service -> r:^enabled$'
      - 'not c:systemctl is-active cups.socket cups.service -> r:^active$'

# 2.1.12 Ensure rpcbind services are not in use. (Automated)
  - id: 76
    title: "Ensure rpcbind services are not in use."
    description: "The rpcbind utility maps RPC services to the ports on which they listen. RPC processes notify rpcbind when they start, registering the ports they are listening on and the RPC program numbers they expect to serve. The client system then contacts rpcbind on the server with a particular RPC program number. The rpcbind.service redirects the client to the proper port number so it can communicate with the requested service. Portmapper is an RPC service, which always listens on tcp and udp 111, and is used to map other RPC services (such as nfs, nlockmgr, quotad, mountd, etc.) to their corresponding port number on the server. When a remote host makes an RPC call to that server, it first consults with portmap to determine where the RPC server is listening."
    rationale: "A small request (~82 bytes via UDP) sent to the Portmapper generates a large response (7x to 28x amplification), which makes it a suitable tool for DDoS attacks. If rpcbind is not required, it is recommended to remove rpcbind package to reduce the potential attack surface."
    impact: "Many of the libvirt packages used by Enterprise Linux virtualization, and the nfs-utils package used for The Network File System (NFS), are dependent on the rpcbind package. If the rpcbind package is removed, these dependent packages will be removed as well. Before removing the rpcbind package, review any dependent packages to determine if they are required on the system. - IF - a dependent package is required: stop and mask the rpcbind.socket and rpcbind.service leaving the rpcbind package installed."
    remediation: "Run the following commands to stop rpcbind.socket and rpcbind.service, and remove the rpcbind package: # systemctl stop rpcbind.socket rpcbind.service # apt purge rpcbind - OR - - IF - the rpcbind package is required as a dependency: Run the following commands to stop and mask the rpcbind.socket and rpcbind.service: # systemctl stop rpcbind.socket rpcbind.service # systemctl mask rpcbind.socket rpcbind.service."
    level: "Level 1"
    compliance:
      - cis: ["2.1.12"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["9.2"]
      - cmmc_v2.0: ["CM.L2-3.4.7", "CM.L2-3.4.8", "SC.L2-3.13.6"]
      - iso_27001-2013: ["A.13.1.3"]
      - mitre_mitigations: ["M1042"]
      - mitre_tactics: ["TA0008"]
      - mitre_techniques: ["T1203", "T1210", "T1498", "T1498.002", "T1543", "T1543.002"]
      - pci_dss_v3.2.1: ["1.1.6", "1.2.1", "2.2.2", "2.2.5"]
      - pci_dss_v4.0: ["1.2.5", "2.2.4", "6.4.1"]
      - soc_2: ["CC6.3", "CC6.6"]
    condition: any
    rules:
      - 'not c:dpkg-query -W -f="\${Status}" rpcbind -> r:^install ok installed$'
      - 'not c:systemctl is-enabled rpcbind.socket rpcbind.service -> r:^enabled$'
      - 'not c:systemctl is-active rpcbind.socket rpcbind.service -> r:^active$'

# 2.1.13 Ensure rsync services are not in use. (Automated)
  - id: 77
    title: "Ensure rsync services are not in use."
    description: "The rsync service can be used to synchronize files between systems over network links."
    rationale: "rsync.service presents a security risk as the rsync protocol is unencrypted. The rsync package should be removed to reduce the attack area of the system."
    impact: "There may be packages that are dependent on the rsync package. If the rsync package is removed, these dependent packages will be removed as well. Before removing the rsync package, review any dependent packages to determine if they are required on the system. - IF - a dependent package is required: stop and mask rsync.service leaving the rsync package installed."
    remediation: "Run the following commands to stop rsync.service, and remove the rsync package: # systemctl stop rsync.service # apt purge rsync - OR - - IF - the rsync package is required as a dependency: Run the following commands to stop and mask rsync.service: # systemctl stop rsync.service # systemctl mask rsync.service."
    level: "Level 1"
    compliance:
      - cis: ["2.1.13"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["9.2"]
      - cmmc_v2.0: ["CM.L2-3.4.7", "CM.L2-3.4.8", "SC.L2-3.13.6"]
      - iso_27001-2013: ["A.13.1.3"]
      - mitre_mitigations: ["M1042"]
      - mitre_tactics: ["TA0008"]
      - mitre_techniques: ["T1105", "T1203", "T1210", "T1543", "T1543.002", "T1570"]
      - pci_dss_v3.2.1: ["1.1.6", "1.2.1", "2.2.2", "2.2.5"]
      - pci_dss_v4.0: ["1.2.5", "2.2.4", "6.4.1"]
      - soc_2: ["CC6.3", "CC6.6"]
    condition: any
    rules:
      - 'not c:dpkg-query -W -f="\${Status}" rsync -> r:^install ok installed$'
      - 'not c:systemctl is-enabled rsync.service -> r:^enabled$'
      - 'not c:systemctl is-active rsync.service -> r:^active$'

# 2.1.14 Ensure samba file server services are not in use. (Automated)
  - id: 78
    title: "Ensure samba file server services are not in use."
    description: "The Samba daemon allows system administrators to configure their Linux systems to share file systems and directories with Windows desktops. Samba will advertise the file systems and directories via the Server Message Block (SMB) protocol. Windows desktop users will be able to mount these directories and file systems as letter drives on their systems."
    rationale: "If there is no need to mount directories and file systems to Windows systems, then this service should be deleted to reduce the potential attack surface."
    impact: "There may be packages that are dependent on the samba package. If the samba package is removed, these dependent packages will be removed as well. Before removing the samba package, review any dependent packages to determine if they are required on the system. - IF - a dependent package is required: stop and mask the smbd.service leaving the samba package installed."
    remediation: "Run the following commands to stop smbd.service and remove samba package: # systemctl stop smbd.service # apt purge samba - OR - - IF - the samba package is required as a dependency: Run the following commands to stop and mask the smbd.service: # systemctl stop smbd.service # systemctl mask smbd.service."
    level: "Level 1"
    compliance:
      - cis: ["2.1.14"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["9.2"]
      - cmmc_v2.0: ["CM.L2-3.4.7", "CM.L2-3.4.8", "SC.L2-3.13.6"]
      - iso_27001-2013: ["A.13.1.3"]
      - mitre_tactics: ["TA0008"]
      - mitre_techniques: ["T1005", "T1039", "T1083", "T1135", "T1203", "T1210", "T1543", "T1543.002"]
      - pci_dss_v3.2.1: ["1.1.6", "1.2.1", "2.2.2", "2.2.5"]
      - pci_dss_v4.0: ["1.2.5", "2.2.4", "6.4.1"]
      - soc_2: ["CC6.3", "CC6.6"]
    condition: any
    rules:
      - 'not c:dpkg-query -W -f="\${Status}" samba -> r:^install ok installed$'
      - 'not c:systemctl is-enabled smbd.service -> r:^enabled$'
      - 'not c:systemctl is-active smbd.service -> r:^active$'

# 2.1.15 Ensure snmp services are not in use. (Automated)
  - id: 79
    title: "Ensure snmp services are not in use."
    description: 'Simple Network Management Protocol (SNMP) is a widely used protocol for monitoring the health and welfare of network equipment, computer equipment and devices like UPSs. Net-SNMP is a suite of applications used to implement SNMPv1 (RFC 1157), SNMPv2 (RFCs 1901-1908), and SNMPv3 (RFCs 3411-3418) using both IPv4 and IPv6. Support for SNMPv2 classic (a.k.a. "SNMPv2 historic" - RFCs 1441-1452) was dropped with the 4.0 release of the UCD-snmp package. The Simple Network Management Protocol (SNMP) server is used to listen for SNMP commands from an SNMP management system, execute the commands or collect the information and then send results back to the requesting system.'
    rationale: "The SNMP server can communicate using SNMPv1, which transmits data in the clear and does not require authentication to execute commands. SNMPv3 replaces the simple/clear text password sharing used in SNMPv2 with more securely encoded parameters. If the the SNMP service is not required, the snmpd package should be removed to reduce the attack surface of the system. Note: If SNMP is required: - The server should be configured for SNMP v3 only. User Authentication and Message Encryption should be configured. If SNMP v2 is absolutely necessary, modify the community strings' values. -."
    impact: "There may be packages that are dependent on the snmpd package. If the snmpd package is removed, these packages will be removed as well. Before removing the snmpd package, review any dependent packages to determine if they are required on the system. If a dependent package is required, stop and mask the snmpd.service leaving the snmpd package installed."
    remediation: "Run the following commands to stop snmpd.service and remove the snmpd package: # systemctl stop snmpd.service # apt purge snmpd - OR - If the package is required for dependencies: Run the following commands to stop and mask the snmpd.service: # systemctl stop snmpd.service # systemctl mask snmpd.service."
    level: "Level 1"
    compliance:
      - cis: ["2.1.15"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["9.2"]
      - cmmc_v2.0: ["CM.L2-3.4.7", "CM.L2-3.4.8", "SC.L2-3.13.6"]
      - iso_27001-2013: ["A.13.1.3"]
      - mitre_mitigations: ["M1042"]
      - mitre_tactics: ["TA0008"]
      - mitre_techniques: ["T1203", "T1210", "T1543", "T1543.002"]
      - pci_dss_v3.2.1: ["1.1.6", "1.2.1", "2.2.2", "2.2.5"]
      - pci_dss_v4.0: ["1.2.5", "2.2.4", "6.4.1"]
      - soc_2: ["CC6.3", "CC6.6"]
    condition: any
    rules:
      - 'not c:dpkg-query -W -f="\${Status}" snmpd -> r:^install ok installed$'
      - 'not c:systemctl is-enabled snmpd.service -> r:^enabled$'
      - 'not c:systemctl is-active snmpd.service -> r:^active$'

# 2.1.16 Ensure tftp server services are not in use. (Automated)
  - id: 80
    title: "Ensure tftp server services are not in use."
    description: "Trivial File Transfer Protocol (TFTP) is a simple protocol for exchanging files between two TCP/IP machines. TFTP servers allow connections from a TFTP Client for sending and receiving files."
    rationale: "Unless there is a need to run the system as a TFTP server, it is recommended that the package be removed to reduce the potential attack surface. TFTP does not have built-in encryption, access control or authentication. This makes it very easy for an attacker to exploit TFTP to gain access to files."
    impact: "TFTP is often used to provide files for network booting such as for PXE based installation of servers. There may be packages that are dependent on the tftpd-hpa package. If the tftpd-hpa package is removed, these dependent packages will be removed as well. Before removing the tftpd-hpa package, review any dependent packages to determine if they are required on the system. - IF - a dependent package is required: stop and mask tftpd-hpa.service leaving the tftpd-hpa package installed."
    remediation: "Run the following commands to stop tftpd-hpa.service, and remove the tftpd-hpa package: # systemctl stop tftpd-hpa.service # apt purge tftpd-hpa - OR - - IF - the tftpd-hpa package is required as a dependency: Run the following commands to stop and mask tftpd-hpa.service: # systemctl stop tftpd-hpa.service # systemctl mask tftpd-hpa.service."
    level: "Level 1"
    compliance:
      - cis: ["2.1.16"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["9.2"]
      - cmmc_v2.0: ["CM.L2-3.4.7", "CM.L2-3.4.8", "SC.L2-3.13.6"]
      - iso_27001-2013: ["A.13.1.3"]
      - mitre_mitigations: ["M1042"]
      - mitre_tactics: ["TA0008"]
      - mitre_techniques: ["T1203", "T1210", "T1543", "T1543.002"]
      - pci_dss_v3.2.1: ["1.1.6", "1.2.1", "2.2.2", "2.2.5"]
      - pci_dss_v4.0: ["1.2.5", "2.2.4", "6.4.1"]
      - soc_2: ["CC6.3", "CC6.6"]
    condition: any
    rules:
      - 'not c:dpkg-query -W -f="\${Status}" tftpd-hpa -> r:^install ok installed$'
      - 'not c:systemctl is-enabled tftpd-hpa.service -> r:^enabled$'
      - 'not c:systemctl is-active tftpd-hpa.service -> r:^active$'

# 2.1.17 Ensure web proxy server services are not in use. (Automated)
  - id: 81
    title: "Ensure web proxy server services are not in use."
    description: "Squid is a standard proxy server used in many distributions and environments."
    rationale: "Unless a system is specifically set up to act as a proxy server, it is recommended that the squid package be removed to reduce the potential attack surface. Note: Several HTTP proxy servers exist. These should be checked and removed unless required."
    impact: "There may be packages that are dependent on the squid package. If the squid package is removed, these dependent packages will be removed as well. Before removing the squid package, review any dependent packages to determine if they are required on the system. - IF - a dependent package is required: stop and mask the squid.service leaving the squid package installed."
    remediation: "Run the following commands to stop squid.service and remove the squid package: # systemctl stop squid.service # apt purge squid - OR - If the squid package is required as a dependency: Run the following commands to stop and mask the squid.service: # systemctl stop squid.service # systemctl mask squid.service."
    level: "Level 1"
    compliance:
      - cis: ["2.1.17"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["9.2"]
      - cmmc_v2.0: ["CM.L2-3.4.7", "CM.L2-3.4.8", "SC.L2-3.13.6"]
      - iso_27001-2013: ["A.13.1.3"]
      - mitre_mitigations: ["M1042"]
      - mitre_tactics: ["TA0008"]
      - mitre_techniques: ["T1203", "T1210", "T1543", "T1543.002"]
      - pci_dss_v3.2.1: ["1.1.6", "1.2.1", "2.2.2", "2.2.5"]
      - pci_dss_v4.0: ["1.2.5", "2.2.4", "6.4.1"]
      - soc_2: ["CC6.3", "CC6.6"]
    condition: any
    rules:
      - 'not c:dpkg-query -W -f="\${Status}" squid -> r:^install ok installed$'
      - 'not c:systemctl is-enabled squid.service -> r:^enabled$'
      - 'not c:systemctl is-active squid.service -> r:^active$'

# 2.1.18 Ensure web server services are not in use. (Automated)
  - id: 82
    title: "Ensure web server services are not in use."
    description: "Web servers provide the ability to host web site content."
    rationale: "Unless there is a local site approved requirement to run a web server service on the system, web server packages should be removed to reduce the potential attack surface."
    impact: "Removal of web server packages will remove that ability for the server to host web services. - IF - the web server package is required for a dependency, any related service or socket should be stopped and masked. Note: If the remediation steps to mask a service are followed and that package is not installed on the system, the service and/or socket will still be masked. If the package is installed due to an approved requirement to host a web server, the associated service and/or socket would need to be unmasked before it could be enabled and/or started."
    remediation: "Run the following commands to stop httpd.socket, httpd.service, and nginx.service, and remove apache2 and nginx packages: # systemctl stop apache2.socket apache2.service nginx.service # apt purge apache2 nginx - OR - - IF - a package is installed and is required for dependencies: Run the following commands to stop and mask apache2.socket, apache2.service, and nginx.service: # systemctl stop apache2.socket apache2.service nginx.service # systemctl mask apache2.socket apache2.service nginx.service Note: Other web server packages may exist. If not required and authorized by local site policy, they should also be removed. If the package is required for a dependency, the service and socket should be stopped and masked."
    level: "Level 1"
    compliance:
      - cis: ["2.1.18"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["9.2"]
      - cmmc_v2.0: ["CM.L2-3.4.7", "CM.L2-3.4.8", "SC.L2-3.13.6"]
      - iso_27001-2013: ["A.13.1.3"]
      - mitre_mitigations: ["M1042"]
      - mitre_tactics: ["TA0008"]
      - mitre_techniques: ["T1203", "T1210", "T1543", "T1543.002"]
      - pci_dss_v3.2.1: ["1.1.6", "1.2.1", "2.2.2", "2.2.5"]
      - pci_dss_v4.0: ["1.2.5", "2.2.4", "6.4.1"]
      - soc_2: ["CC6.3", "CC6.6"]
    condition: any
    rules:
      - 'not c:dpkg-query -W -f="\${Status}" apache2 -> r:^install ok installed$'
      - 'not c:systemctl is-enabled apache2.service apache2.socket -> r:^enabled$'
      - 'not c:systemctl is-active apache2.service apache2.socket -> r:^active$'

# 2.1.19 Ensure xinetd services are not in use. (Automated)
  - id: 83
    title: "Ensure xinetd services are not in use."
    description: "The eXtended InterNET Daemon (xinetd) is an open source super daemon that replaced the original inetd daemon. The xinetd daemon listens for well known services and dispatches the appropriate daemon to properly respond to service requests."
    rationale: "If there are no xinetd services required, it is recommended that the package be removed to reduce the attack surface are of the system. Note: If an xinetd service or services are required, ensure that any xinetd service not required is stopped and masked."
    impact: "There may be packages that are dependent on the xinetd package. If the xinetd package is removed, these dependent packages will be removed as well. Before removing the xinetd package, review any dependent packages to determine if they are required on the system. -IF- a dependent package is required: stop and mask xinetd.service leaving the xinetd package installed."
    remediation: "Run the following commands to stop xinetd.service, and remove the xinetd package: # systemctl stop xinetd.service # apt purge xinetd -OR- -IF- the xinetd package is required as a dependency: Run the following commands to stop and mask the xinetd.service: # systemctl stop xinetd.service # systemctl mask xinetd.service."
    level: "Level 1"
    compliance:
      - cis: ["2.1.19"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["9.2"]
      - cmmc_v2.0: ["CM.L2-3.4.7", "CM.L2-3.4.8", "SC.L2-3.13.6"]
      - iso_27001-2013: ["A.13.1.3"]
      - mitre_mitigations: ["M1042"]
      - mitre_tactics: ["TA0008"]
      - mitre_techniques: ["T1203", "T1210", "T1543", "T1543.002"]
      - pci_dss_v3.2.1: ["1.1.6", "1.2.1", "2.2.2", "2.2.5"]
      - pci_dss_v4.0: ["1.2.5", "2.2.4", "6.4.1"]
      - soc_2: ["CC6.3", "CC6.6"]
    condition: any
    rules:
      - 'not c:dpkg-query -W -f="\${Status}" xinetd -> r:^install ok installed$'
      - 'not c:systemctl is-enabled xinetd.service -> r:^enabled$'
      - 'not c:systemctl is-active xinetd.service apache2.socket -> r:^active$'

# 2.1.20 Ensure X window server services are not in use. (Automated)
  - id: 84
    title: "Ensure X window server services are not in use."
    description: "The X Window System provides a Graphical User Interface (GUI) where users can have multiple windows in which to run programs and various add on. The X Windows system is typically used on workstations where users login, but not on servers where users typically do not login."
    rationale: "Unless your organization specifically requires graphical login access via X Windows, remove it to reduce the potential attack surface."
    impact: 'If a Graphical Desktop Manager (GDM) is in use on the system, there may be a dependency on the xorg-x11-server-common package. If the GDM is required and approved by local site policy, the package should not be removed. Many Linux systems run applications which require a Java runtime. Some Linux Java packages have a dependency on specific X Windows xorg-x11-fonts. One workaround to avoid this dependency is to use the "headless" Java packages for your specific Java runtime.'
    remediation: "- IF - a Graphical Desktop Manager or X-Windows server is not required and approved by local site policy: Run the following command to remove the X Windows Server package: # apt purge xserver-common."
    level: "Level 1"
    compliance:
      - cis: ["2.1.20"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["2.6"]
      - cmmc_v2.0: ["CM.L2-3.4.7", "CM.L2-3.4.8", "SC.L2-3.13.6"]
      - iso_27001-2013: ["A.12.5.1", "A.12.6.2"]
      - mitre_mitigations: ["M1042"]
      - mitre_tactics: ["TA0008"]
      - mitre_techniques: ["T1203", "T1210", "T1543", "T1543.002"]
      - pci_dss_v3.2.1: ["1.1.6", "1.2.1", "2.2.2", "2.2.5"]
      - pci_dss_v4.0: ["1.2.5", "2.2.4", "6.4.1"]
      - soc_2: ["CC6.3", "CC6.6"]
    condition: all
    rules:
      - 'not c:dpkg-query -W -f="\${Status}" xserver-common -> r:^install ok installed$'

# 2.1.21 Ensure mail transfer agent is configured for local-only mode. (Automated)
  - id: 85
    title: "Ensure mail transfer agent is configured for local-only mode"
    description: "Mail Transfer Agents (MTA), such as sendmail and Postfix, are used to listen for incoming mail and transfer messages to the appropriate user or mail server. If the system is not intended to be a mail server, it is recommended that the MTA be configured to only process local mail."
    rationale: "The software for all Mail Transfer Agent is complex and most have a long history of security issues. While it is important to ensure that the system car process local mail messages, it is not necessary to have the MTA's daemon listening on a port unless the server is intended to be a mail server that receives and processes mail from other systems."
    impact: ""
    remediation: "Edit /etc/postfix/main.cf and add the following line to the RECEIVING MAIL section. If tthe line is already exists, change it to look like the line below: # inet_interfaces = loopback-only. Run the following command to restart postfix: # systemctl restart postfix."
    level: "Level 1"
    compliance:
      - cis: ["2.1.21"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["9.2"]
      - nist_sp_800-53: ["CM-7"]
      - mitre_mitigations: ["M1042"]
      - mitre_tactics: ["TA0008"]
      - mitre_techniques: ["T1018", "T1018.000", "T1210", "T1210.000"]
    condition: all
    rules:
      - 'not c:ss -plntu | grep -E -- ":25\b" -> !r:127\.0\.0\.1: && !r:\[::1\]:'
      - 'not c:ss -plntu | grep -E -- ":465\b" -> !r:127\.0\.0\.1: && !r:\[::1\]:'
      - 'not c:ss -plntu | grep -E -- ":587\b" -> !r:127\.0\.0\.1: && !r:\[::1\]:'
      - 'f:/etc/postfix/main.cf -> r:^[^#;]\*inet_interfaces\s*=\s*loopback-only\b'

# 2.1.22 Ensure only approved services are listening on a network interface. (Manual)
# This rule is currently not implementable because it requires human intervention.


# 2.2 - Configure Client Services.
#
#

# 2.2.1 Ensure NIS Client is not installed. (Automated)
  - id: 87
    title: "Ensure NIS Client is not installed."
    description: "The Network Information Service (NIS), formerly known as Yellow Pages, is a client-server directory service protocol used to distribute system configuration files. The NIS client was used to bind a machine to an NIS server and receive the distributed configuration files."
    rationale: "The NIS service is inherently an insecure system that has been vulnerable to DOS attacks, buffer overflows and has poor authentication for querying NIS maps. NIS generally has been replaced by such protocols as Lightweight Directory Access Protocol (LDAP). It is recommended that the service be removed."
    impact: "Many insecure service clients are used as troubleshooting tools and in testing environments. Uninstalling them can inhibit capability to test and troubleshoot. If they are required it is advisable to remove the clients after use to prevent accidental or intentional misuse."
    remediation: "Uninstall nis: # apt purge nis."
    level: "Level 1"
    compliance:
      - cis: ["2.2.1"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["2.6"]
      - cmmc_v2.0: ["CM.L2-3.4.7", "CM.L2-3.4.8", "SC.L2-3.13.6"]
      - iso_27001-2013: ["A.12.5.1", "A.12.6.2"]
      - mitre_mitigations: ["M1042"]
      - mitre_tactics: ["TA0008"]
      - mitre_techniques: ["T1203", "T1543", "T1543.002"]
      - pci_dss_v3.2.1: ["1.1.6", "1.2.1", "2.2.2", "2.2.5"]
      - pci_dss_v4.0: ["1.2.5", "2.2.4", "6.4.1"]
      - soc_2: ["CC6.3", "CC6.6"]
    condition: all
    rules:
      - 'not c:dpkg-query -W -f="\${Status}" nis -> r:^install ok installed$'

 # 2.2.2 Ensure rsh client is not installed. (Automated)
  - id: 88
    title: "Ensure rsh client is not installed."
    description: "The rsh-client package contains the client commands for the rsh services."
    rationale: "These legacy clients contain numerous security exposures and have been replaced with the more secure SSH package. Even if the server is removed, it is best to ensure the clients are also removed to prevent users from inadvertently attempting to use these commands and therefore exposing their credentials. Note that removing the rsh-client package removes the clients for rsh , rcp and rlogin."
    impact: "Many insecure service clients are used as troubleshooting tools and in testing environments. Uninstalling them can inhibit capability to test and troubleshoot. If they are required it is advisable to remove the clients after use to prevent accidental or intentional misuse."
    remediation: "Uninstall rsh: # apt purge rsh-client."
    level: "Level 1"
    compliance:
      - cis: ["2.2.2"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["9.2"]
      - cmmc_v2.0: ["CM.L2-3.4.7", "CM.L2-3.4.8", "SC.L2-3.13.6"]
      - iso_27001-2013: ["A.13.1.3"]
      - mitre_mitigations: ["M1041", "M1042"]
      - mitre_tactics: ["TA0008"]
      - mitre_techniques: ["T1040", "T1203", "T1543", "T1543.002"]
      - pci_dss_v3.2.1: ["1.1.6", "1.2.1", "2.2.2", "2.2.5"]
      - pci_dss_v4.0: ["1.2.5", "2.2.4", "6.4.1"]
      - soc_2: ["CC6.3", "CC6.6"]
    condition: all
    rules:
      - 'not c:dpkg-query -W -f="\${Status}" rsh-client -> r:^install ok installed$'

# 2.2.3 Ensure talk client is not installed. (Automated)
  - id: 89
    title: "Ensure talk client is not installed."
    description: "The talk software makes it possible for users to send and receive messages across systems through a terminal session. The talk client, which allows initialization of talk sessions, is installed by default."
    rationale: "The software presents a security risk as it uses unencrypted protocols for communication."
    impact: "Many insecure service clients are used as troubleshooting tools and in testing environments. Uninstalling them can inhibit capability to test and troubleshoot. If they are required it is advisable to remove the clients after use to prevent accidental or intentional misuse."
    remediation: "Uninstall talk: # apt purge talk."
    level: "Level 1"
    compliance:
      - cis: ["2.2.3"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["9.2"]
      - cmmc_v2.0: ["CM.L2-3.4.7", "CM.L2-3.4.8", "SC.L2-3.13.6"]
      - iso_27001-2013: ["A.13.1.3"]
      - mitre_mitigations: ["M1041", "M1042"]
      - mitre_tactics: ["TA0006", "TA0008"]
      - mitre_techniques: ["T1203", "T1543", "T1543.002"]
      - pci_dss_v3.2.1: ["1.1.6", "1.2.1", "2.2.2", "2.2.5"]
      - pci_dss_v4.0: ["1.2.5", "2.2.4", "6.4.1"]
      - soc_2: ["CC6.3", "CC6.6"]
    condition: all
    rules:
      - 'not c:dpkg-query -W -f="\${Status}" talk -> r:^install ok installed$'

# 2.2.4 Ensure telnet client is not installed. (Automated)
  - id: 90
    title: "Ensure telnet client is not installed."
    description: "The inetutils-telnet package contains the telnet client, which allows users to start connections to other systems via the telnet protocol."
    rationale: "The telnet protocol is insecure and unencrypted. The use of an unencrypted transmission medium could allow an unauthorized user to steal credentials. The ssh package provides an encrypted session and stronger security and is included in most Linux distributions."
    impact: "Many insecure service clients are used as troubleshooting tools and in testing environments. Uninstalling them can inhibit capability to test and troubleshoot. If they are required it is advisable to remove the clients after use to prevent accidental or intentional misuse."
    remediation: "Run the following commands to uninstall telnet & inetutils-telnet: # apt purge telnet # apt purge inetutils-telnet."
    level: "Level 1"
    compliance:
      - cis: ["2.2.4"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["9.2"]
      - cmmc_v2.0: ["CM.L2-3.4.7", "CM.L2-3.4.8", "SC.L2-3.13.6"]
      - iso_27001-2013: ["A.13.1.3"]
      - mitre_mitigations: ["M1041", "M1042"]
      - mitre_tactics: ["TA0006", "TA0008"]
      - mitre_techniques: ["T1040", "T1203", "T1543", "T1543.002"]
      - pci_dss_v3.2.1: ["1.1.6", "1.2.1", "2.2.2", "2.2.5"]
      - pci_dss_v4.0: ["1.2.5", "2.2.4", "6.4.1"]
      - soc_2: ["CC6.3", "CC6.6"]
    condition: all
    rules:
      - 'not c:dpkg-query -W -f="\${Status}" telnet inetutils-telnet -> r:^install ok installed$'

# 2.2.5 Ensure ldap client is not installed. (Automated)
  - id: 91
    title: "Ensure ldap client is not installed."
    description: "The Lightweight Directory Access Protocol (LDAP) was introduced as a replacement for NIS/YP. It is a service that provides a method for looking up information from a central database."
    rationale: "If the system will not need to act as an LDAP client, it is recommended that the software be removed to reduce the potential attack surface."
    impact: "Removing the LDAP client will prevent or inhibit using LDAP for authentication in your environment."
    remediation: "Uninstall ldap-utils: # apt purge ldap-utils."
    level: "Level 1"
    compliance:
      - cis: ["2.2.5"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["9.2"]
      - cmmc_v2.0: ["CM.L2-3.4.7", "CM.L2-3.4.8", "SC.L2-3.13.6"]
      - iso_27001-2013: ["A.13.1.3"]
      - mitre_mitigations: ["M1042"]
      - mitre_tactics: ["TA0008"]
      - mitre_techniques: ["T1203", "T1543", "T1543.002"]
      - pci_dss_v3.2.1: ["1.1.6", "1.2.1", "2.2.2", "2.2.5"]
      - pci_dss_v4.0: ["1.2.5", "2.2.4", "6.4.1"]
      - soc_2: ["CC6.3", "CC6.6"]
    condition: all
    rules:
      - 'not c:dpkg-query -W -f="\${Status}" ldap-utils -> r:^install ok installed$'
  
# 2.2.6 Ensure ftp client is not installed. (Automated)
  - id: 92
    title: "Ensure ftp client is not installed."
    description: "tnftp an enhanced FTP client, is the user interface to the Internet standard File Transfer Protocol. The program allows a user to transfer files to and from a remote network site."
    rationale: "Unless there is a need to run the system using Internet standard File Transfer Protocol (for example, to allow anonymous downloads), it is recommended that the package be removed to reduce the potential attack surface."
    remediation: "Run the following commands to uninstall tnftp & ftp: # apt purge ftp # apt purge tnftp."
    level: "Level 1"
    compliance:
      - cis: ["2.2.6"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["9.2"]
      - cmmc_v2.0: ["CM.L2-3.4.7", "CM.L2-3.4.8", "SC.L2-3.13.6"]
      - iso_27001-2013: ["A.13.1.3"]
      - mitre_mitigations: ["M1042"]
      - mitre_tactics: ["TA0008"]
      - mitre_techniques: ["T1203", "T1543", "T1543.002"]
      - pci_dss_v3.2.1: ["1.1.6", "1.2.1", "2.2.2", "2.2.5"]
      - pci_dss_v4.0: ["1.2.5", "2.2.4", "6.4.1"]
      - soc_2: ["CC6.3", "CC6.6"]
    condition: all
    rules:
      - 'not c:dpkg-query -W -f="\${Status}" ftp tftp -> r:^install ok installed$'

# 2.3 - Configure Time Synchronization
# 2.3.1 - Ensure time synchronization is in use
#
#

# 2.3.1.1 Ensure a single time synchronization daemon is in use. (Automated)
  - id: 93
    title: "Ensure a signle time synchronization daemon is in use (Test for chrony)"
    description: "System time should be synchronized between all systems in an environment. This is typically done by establishing an authoritative time server or a set of servers and having all systems synchronize their clocks to them. NOTE: Only ONE time synchronization method should be in use on the system. Configuring multiple time synchronization methods could lead to unexpected or unreliable results."
    rationale: "Time synchronization is important to support time sensitive security mechanisms and ensures log files have consistent time records across the enterprise, which aids in forensic investigations."
    remediation: "On physical system, and virtual systems where host based time synchronization is not available. Select ONE of the two time synchronization daemons; chrony or systemd-timesyncd and following the remediation procedure for the selected daemon. Run the following command to install chrony: # apt install chrony. Run the following commands to stop and mask the systemd-timesyncd daemon: systemctl stop systemd-timesyncd.service # systemctl mask systemd-timesyncd.service"
    level: "Level 1"
    compliance:
      - cis: ["2.3.1.1"]
      - cis_csc_v8: ["8.4"]
      - cis_csc_v7: ["6.1"]
      - nist_sp_800-53: ["AU-3", "AU-12"]
      - mitre_mitigations: [""]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1070", "T1070.002", "T1562", "T1562.001"]
    condition: all
    rules:
        - 'c:dpkg-query -W -f="\${Status}" chrony -> r:^install ok installed$'
        - 'not c:systemctl is-enabled systemd-timesyncd.service -> r:^enabled$'
        - 'not c:systemctl is-active systemd-timesyncd.service -> r:^active$'

# 2.3.1.1 Ensure a single time synchronization daemon is in use. (Automated)
  - id: 94
    title: "Ensure a signle time synchronization daemon is in use (Test for systemd-timesyncd)"
    description: "System time should be synchronized between all systems in an environment. This is typically done by establishing an authoritative time server or a set of servers and having all systems synchronize their clocks to them. NOTE: Only ONE time synchronization method should be in use on the system. Configuring multiple time synchronization methods could lead to unexpected or unreliable results."
    rationale: "Time synchronization is important to support time sensitive security mechanisms and ensures log files have consistent time records across the enterprise, which aids in forensic investigations."
    remediation: "On physical system, and virtual systems where host based time synchronization is not available. Select ONE of the two time synchronization daemons; chrony or systemd-timesyncd and following the remediation procedure for the selected daemon. Run the following command to remove chrony: # apt purge chrony # apt autoremove chrony."
    level: "Level 1"
    compliance:
      - cis: ["2.3.1.1"]
      - cis_csc_v8: ["8.4"]
      - cis_csc_v7: ["6.1"]
      - nist_sp_800-53: ["AU-3", "AU-12"]
      - mitre_mitigations: [""]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1070", "T1070.002", "T1562", "T1562.001"]
    condition: all
    rules:
        - 'not c:dpkg-query -W -f="\${Status}" chrony -> r:^install ok installed$'
        - 'c:systemctl is-enabled systemd-timesyncd.service -> r:^enabled$'
        - 'c:systemctl is-active systemd-timesyncd.service -> r:^active$'

# 2.3.2 - Configure systemd-timesyncd
#
#

# 2.3.2.1 Ensure systemd-tilesyncd configured with authorized timeserver. (Automated)
  - id: 95
    title: "Ensure systemd-timesyncd configured with authorized timeserver."
    description: "NTP= - A space-separated list of NTP server hostnames or IP addresses. Systemd-timesyncd will contact all configured system or per-interface servers in turn, until one responds. This setting defaults to an empty list. FallbackNTP= - A space-separated list of NTP server hostnames or IP addresses to be used as the fallback NTP servers."
    rationale: "Time synchronization is important to support time sensitive security mechanisms and to ensure log files have consistent time records across the enterprise to aid in forensic investigations."
    remediation: "Set NTP and/or FallbackNTP parameters to local site approved authoritative time server(s) in /Etc/systemd/timesyncd.conf or a file in /etc/systemd/timesyncd.conf.d/ ending in .conf in the [Time] section. NOTE if this setting appears in a canonnically later file, or later in the same file, the setting will be overwritten. Run the following command to update the paraeters in the service: # systemctl reload|restart systemd-timesyncd."
    references:
      - "https://www.freedesktop.org/software/systemd/man/timesyncd.conf.html"
      - "https://tf.nist.gov/tf-cgi/servers.cgi"
    level: "Level 1"
    compliance:
      - cis: ["2.3.2.1"]
      - cis_csc_v8: ["8.4"]
      - cis_csc_v7: ["6.1"]
      - nist_sp_800-53: ["AU-7", "AU-8"]
    condition: all
    rules:
      - 'c:systemd-analyze cat-config systemd/timesyncd.conf | awk ''/^\s*NTP=/{line=$0} END{print line}'' -> r:^\s*NTP\s*=\s*\S+'
      - 'c:systemd-analyze cat-config systemd/timesyncd.conf | awk ''/^\s*FallbackNTP=/{line=$0} END{print line}'' -> r:^\s*FallbackNTP\s*=\s*\S+'

# 2.3.2.2 Ensure systemd-timesyncd is enabled and running. (Automated)
  - id: 96
    title: "Ensure systemd-timesyncd is enabled and running."
    description: "systemd-timesyncd is a daemon that has been added for synchronizing the system clock across the network."
    rationale: "systemd-timesyncd needs to be enabled and running in order to synchronize the system to a timeserver. Time synchronization is important to support time sensitive security mechanisms and to ensure log files have consistent time records across the enterprise to aid in forensic investigations."
    remediation: "- IF - systemd-timesyncd is in use on the system, run the following commands: Run the following command to unmask systemd-timesyncd.service: # systemctl unmask systemd-timesyncd.service Run the following command to enable and start systemd-timesyncd.service: # systemctl --now enable systemd-timesyncd.service - OR - If another time synchronization service is in use on the system, run the following command to stop and mask systemd-timesyncd: # systemctl --now mask systemd-timesyncd.service."
    level: "Level 1"
    compliance:
      - cis: ["2.3.2.2"]
      - cis_csc_v8: ["8.4"]
      - cis_csc_v7: ["6.1"]
      - cmmc_v2.0: ["AU.L2-3.3.7"]
      - iso_27001-2013: ["A.12.4.4"]
      - mitre_mitigations: ["M1022"]
      - mitre_tactics: ["TA0002"]
      - mitre_techniques: ["T1070", "T1070.002", "T1562", "T1562.001"]
      - nist_sp_800-53: ["AU-7"]
      - pci_dss_v3.2.1: ["10.4"]
      - pci_dss_v4.0: ["10.6", "10.6.1", "10.6.2", "10.6.3"]
      - soc_2: ["CC4.1", "CC5.2"]
    condition: all
    rules:
      - 'c:systemctl is-enabled systemd-timesyncd.service -> r:^enabled$'
      - 'c:systemctl is-active systemd-timesyncd.service -> r:^active$'

# 2.3.3 - Configure Chrony
#
#

# 2.3.3.1 Ensure chrony is configured with authorized timeserver. (Automated)
  - id: 97
    title: "Ensure chrony is configured with authorized timeserver"
    description: "server - The server directive specifies an NTP server which can be used as a time source. The client-server relationship is strictly hierarchicaled. This directive can be used multiple time to specify multiple servers. The directive is immediately followed by either the name of the server or its IP address. pool - The syntax of this directive is similar to that for the server directive, except that is used to specify a pool of NTP servers rather than a single NTP server. The pool name is expected to resolve to multiple addresses which might change over time. This directive can be used multiple time to specify multiple servers. All options valide in the server directive can be used in this directive too."
    rationale: "Time synchronization is important to support time sensitive security mechanisms and to ensure log files have consistent time records across the enterprise to aid in forensic investigations."
    remediation: "Edit /etc/chrony/chrony.conf or create and edit timeserver.sources in /etc/chrony/sources.d and add or edit server or pool lines as appropriate according to local site policy. Edit the chrony configuration and add or edit the server and/or pool lines returned by the aduti procedure as appropriate according to local site policy."
    references:
      - "chrony.conf(5) Manual Page"
      - "https://tf.nist.gov/tf-cgi/servers.cgi"
    level: "Level 1"
    compliance: 
      - cis: ["2.3.3.1"]
      - cis_csc_v8: ["8.4"]
      - cis_csc_v7: ["6.1"]
      - nist_sp_800-53: ["AU-3", "AU-12"]
      - mitre_mitigations: ["M1022"]
      - mitre_tactics: ["TA0002"]
      - mitre_techniques: ["T1070", "T1070.002", "T1562", "T1562.001"]
    condition: all
    rules:
      - 'f:/etc/chrony/chrony.conf -> r:^[^#;]\s*server\s+\S+'
      - 'f:/etc/chrony/sources.d/timeserver.sources -> r:^[^#;]\s*server\s+\S+'
      - 'f:/etc/chrony/chrony.conf -> r:^[^#;]\s*pool\s+\S+'
      - 'f:/etc/chrony/sources.d/timeserver.sources -> r:^[^#;]\s*pool\s+\S+'

# 2.3.3.2 Ensure chrony is running as user _chrony. (Automated)
  - id: 98
    title: "Ensure chrony is running as user _chrony."
    description: "The chrony package is installed with a dedicated user account _chrony. This account is granted the access required by the chronyd service."
    rationale: "The chronyd service should run with only the required privlidges."
    remediation: "Add or edit the user line to /etc/chrony/chrony.conf or a file ending in .conf in /etc/chrony/conf.d/: user _chrony - OR - If another time synchronization service is in use on the system, run the following command to remove chrony from the system: # apt purge chrony # apt autoremove chrony."
    level: "Level 1"
    compliance:
      - cis: ["2.3.3.2"]
      - cis_csc_v8: ["8.4"]
      - cis_csc_v7: ["6.1"]
      - cmmc_v2.0: ["AU.L2-3.3.7"]
      - iso_27001-2013: ["A.12.4.4"]
      - mitre_mitigations: ["M1022"]
      - mitre_tactics: ["TA0002"]
      - mitre_techniques: ["T1070", "T1070.002", "T1562", "T1562.001"]
      - nist_sp_800-53: ["AU-7"]
      - pci_dss_v3.2.1: ["10.4"]
      - pci_dss_v4.0: ["10.6", "10.6.1", "10.6.2", "10.6.3"]
      - soc_2: ["CC4.1", "CC5.2"]
    condition: all
    rules:
      - 'f:/etc/chrony/chrony.conf -> r:user\s*\t*_chrony'
      - 'd:/etc/chrony/conf.d/ -> r:.+\.conf$ -> r:user\s*\t*_chrony'

# 2.3.3.3 Ensure chrony is enabled and running. (Automated)
  - id: 99
    title: "Ensure chrony is enabled and running."
    description: "chrony is a daemon for synchronizing the system clock across the network."
    rationale: "chrony needs to be enabled and running in order to synchronize the system to a timeserver. Time synchronization is important to support time sensitive security mechanisms and to ensure log files have consistent time records across the enterprise to aid in forensic investigations."
    remediation: "- IF - chrony is in use on the system, run the following commands: Run the following command to unmask chrony.service: # systemctl unmask chrony.service Run the following command to enable and start chrony.service: # systemctl --now enable chrony.service - OR - If another time synchronization service is in use on the system, run the following command to remove chrony: # apt purge chrony # apt autoremove chrony."
    level: "Level 1"
    compliance:
      - cis: ["2.3.3.3"]
      - cis_csc_v8: ["8.4"]
      - cis_csc_v7: ["6.1"]
      - cmmc_v2.0: ["AU.L2-3.3.7"]
      - iso_27001-2013: ["A.12.4.4"]
      - mitre_mitigations: ["M1022"]
      - mitre_tactics: ["TA0002"]
      - mitre_techniques: ["T1070", "T1070.002", "T1562", "T1562.001"]
      - nist_sp_800-53: ["AU-7"]
      - pci_dss_v3.2.1: ["10.4"]
      - pci_dss_v4.0: ["10.6", "10.6.1", "10.6.2", "10.6.3"]
      - soc_2: ["CC4.1", "CC5.2"]
    condition: all
    rules:
      - "c:systemctl is-enabled chrony.service -> r:^enabled$"
      - "c:systemctl is-active chrony.service -> r:^active$"

# 2.4.1 - Configure cron
#
#

# 2.4.1.1 Ensure cron daemon is enabled and active. (Automated)
  - id: 100
    title: "Ensure cron daemon is enabled and active."
    description: "The cron daemon is used to execute batch jobs on the system."
    rationale: "While there may not be user jobs that need to be run on the system, the system does have maintenance jobs that may include security monitoring that have to run, and cron is used to execute them."
    remediation: "- IF - cron is installed on the system: Run the following commands to unmask, enable, and start cron: # systemctl unmask \"$(systemctl list-unit-files | awk '$1~/^crond?\\.service/{print $1}')\" # systemctl --now enable \"$(systemctl list-unit-files | awk '$1~/^crond?\\.service/{print $1}')\"."
    level: "Level 1"
    compliance:
      - cis: ["2.4.1.1"]
      - mitre_mitigations: ["M1018"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1562", "T1562.001"]
    condition: all
    rules:
      - 'c:systemctl list-unit-files | awk "\$1~/^crond?\.service/{print \$2}" -> r:^enabled$'
      - 'c:systemctl list-units | awk "\$1~/^crond?\.service/{print \$3}" -> r:^active$'

# 2.4.1.2 Ensure permissions on /etc/crontab are configured. (Automated)
  - id: 101
    title: "Ensure permissions on /etc/crontab are configured."
    description: "The /etc/crontab file is used by cron to control its own jobs. The commands in this item make sure that root is the user and group owner of the file and that only the owner can access the file."
    rationale: "This file contains information on what system jobs are run by cron. Write access to these files could provide unprivileged users with the ability to elevate their privileges. Read access to these files could provide users with the ability to gain insight on system jobs that run on the system and could provide them a way to gain unauthorized privileged access."
    remediation: "- IF - cron is installed on the system: Run the following commands to set ownership and permissions on /etc/crontab: # chown root:root /etc/crontab # chmod og-rwx /etc/crontab."
    level: "Level 1"
    compliance:
      - cis: ["2.4.1.2"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0: ["AC.L1-3.1.1", "AC.L1-3.1.2", "AC.L2-3.1.3", "AC.L2-3.1.5", "MP.L2-3.8.2"]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - iso_27001-2013: ["A.9.1.1"]
      - mitre_mitigations: ["M1018"]
      - mitre_tactics: ["TA0002", "TA0007"]
      - mitre_techniques: ["T1053", "T1053.003"]
      - nist_sp_800-53: ["AC-5", "AC-6"]
      - pci_dss_v3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_v4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    condition: all
    rules:
      - 'c:stat -Lc "%a %u %U %g %G" /etc/crontab -> r:^600 0 root 0 root$'

 # 2.4.1.3 Ensure permissions on /etc/cron.hourly are configured. (Automated)
  - id: 102
    title: "Ensure permissions on /etc/cron.hourly are configured."
    description: "This directory contains system cron jobs that need to run on an hourly basis. The files in this directory cannot be manipulated by the crontab command, but are instead edited by system administrators using a text editor. The commands below restrict read/write and search access to user and group root, preventing regular users from accessing this directory."
    rationale: "Granting write access to this directory for non-privileged users could provide them the means for gaining unauthorized elevated privileges. Granting read access to this directory could give an unprivileged user insight in how to gain elevated privileges or circumvent auditing controls."
    remediation: "- IF - cron is installed on the system: Run the following commands to set ownership and permissions on the /etc/cron.hourly directory: # chown root:root /etc/cron.hourly/ # chmod og-rwx /etc/cron.hourly/."
    level: "Level 1"
    compliance:
      - cis: ["2.4.1.3"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0: ["AC.L1-3.1.1", "AC.L1-3.1.2", "AC.L2-3.1.3", "AC.L2-3.1.5", "MP.L2-3.8.2"]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - iso_27001-2013: ["A.9.1.1"]
      - mitre_mitigations: ["M1018"]
      - mitre_tactics: ["TA0002", "TA0007"]
      - mitre_techniques: ["T1053", "T1053.003"]
      - nist_sp_800-53: ["AC-5", "AC-6"]
      - pci_dss_v3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_v4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    condition: all
    rules:
      - 'c:stat -Lc "%a %u %U %g %G" /etc/cron.hourly -> r:^700 0 root 0 root$'

 # 2.4.1.4 Ensure permissions on /etc/cron.daily are configured. (Automated)
  - id: 103
    title: "Ensure permissions on /etc/cron.daily are configured."
    description: "The /etc/cron.daily directory contains system cron jobs that need to run on a daily basis. The files in this directory cannot be manipulated by the crontab command, but are instead edited by system administrators using a text editor. The commands below restrict read/write and search access to user and group root, preventing regular users from accessing this directory."
    rationale: "Granting write access to this directory for non-privileged users could provide them the means for gaining unauthorized elevated privileges. Granting read access to this directory could give an unprivileged user insight in how to gain elevated privileges or circumvent auditing controls."
    remediation: "- IF - cron is installed on the system: Run the following commands to set ownership and permissions on the /etc/cron.daily directory: # chown root:root /etc/cron.daily/ # chmod og-rwx /etc/cron.daily/."
    level: "Level 1"
    compliance:
      - cis: ["2.4.1.4"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0: ["AC.L1-3.1.1", "AC.L1-3.1.2", "AC.L2-3.1.3", "AC.L2-3.1.5", "MP.L2-3.8.2"]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - iso_27001-2013: ["A.9.1.1"]
      - mitre_mitigations: ["M1018"]
      - mitre_tactics: ["TA0002", "TA0007"]
      - mitre_techniques: ["T1053", "T1053.003"]
      - nist_sp_800-53: ["AC-5", "AC-6"]
      - pci_dss_v3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_v4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    condition: all
    rules:
      - 'c:stat -Lc "%a %u %U %g %G" /etc/cron.daily -> r:^700 0 root 0 root$'

# 2.4.1.5 Ensure permissions on /etc/cron.weekly are configured. (Automated)
  - id: 104
    title: "Ensure permissions on /etc/cron.weekly are configured."
    description: "The /etc/cron.weekly directory contains system cron jobs that need to run on a weekly basis. The files in this directory cannot be manipulated by the crontab command but are instead edited by system administrators using a text editor. The commands below restrict read/write and search access to user and group root, preventing regular users from accessing this directory."
    rationale: "Granting write access to this directory for non-privileged users could provide them the means for gaining unauthorized elevated privileges. Granting read access to this directory could give an unprivileged user insight in how to gain elevated privileges or circumvent auditing controls."
    remediation: "- IF - cron is installed on the system: Run the following commands to set ownership and permissions on the /etc/cron.weekly directory: # chown root:root /etc/cron.weekly/ # chmod og-rwx /etc/cron.weekly/."
    level: "Level 1"
    compliance:
      - cis: ["2.4.1.5"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0: ["AC.L1-3.1.1", "AC.L1-3.1.2", "AC.L2-3.1.3", "AC.L2-3.1.5", "MP.L2-3.8.2"]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - iso_27001-2013: ["A.9.1.1"]
      - mitre_mitigations: ["M1018"]
      - mitre_tactics: ["TA0002", "TA0007"]
      - mitre_techniques: ["T1053", "T1053.003"]
      - nist_sp_800-53: ["AC-5", "AC-6"]
      - pci_dss_v3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_v4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    condition: all
    rules:
      - 'c:stat -Lc "%a %u %U %g %G" /etc/cron.weekly -> r:^700 0 root 0 root$'

# 2.4.1.6 Ensure permissions on /etc/cron.monthly are configured. (Automated)
  - id: 105
    title: "Ensure permissions on /etc/cron.monthly are configured."
    description: "The /etc/cron.monthly directory contains system cron jobs that need to run on a monthly basis. The files in this directory cannot be manipulated by the crontab command but are instead edited by system administrators using a text editor. The commands below restrict read/write and search access to user and group root, preventing regular users from accessing this directory."
    rationale: "Granting write access to this directory for non-privileged users could provide them the means for gaining unauthorized elevated privileges. Granting read access to this directory could give an unprivileged user insight in how to gain elevated privileges or circumvent auditing controls."
    remediation: "- IF - cron is installed on the system: Run the following commands to set ownership and permissions on the /etc/cron.monthly directory: # chown root:root /etc/cron.monthly/ # chmod og-rwx /etc/cron.monthly/."
    level: "Level 1"
    compliance:
      - cis: ["2.4.1.6"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0: ["AC.L1-3.1.1", "AC.L1-3.1.2", "AC.L2-3.1.3", "AC.L2-3.1.5", "MP.L2-3.8.2"]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - iso_27001-2013: ["A.9.1.1"]
      - mitre_mitigations: ["M1018"]
      - mitre_tactics: ["TA0002", "TA0007"]
      - mitre_techniques: ["T1053", "T1053.003"]
      - nist_sp_800-53: ["AC-5", "AC-6"]
      - pci_dss_v3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_v4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    condition: all
    rules:
      - 'c:stat -Lc "%a %u %U %g %G" /etc/cron.monthly -> r:^700 0 root 0 root$'

# 2.4.1.7 Ensure permissions on /etc/cron.d are configured. (Automated)
  - id: 106
    title: "Ensure permissions on /etc/cron.d are configured."
    description: "The /etc/cron.d directory contains system cron jobs that need to run in a similar manner to the hourly, daily weekly and monthly jobs from /etc/crontab, but require more granular control as to when they run. The files in this directory cannot be manipulated by the crontab command but are instead edited by system administrators using a text editor. The commands below restrict read/write and search access to user and group root, preventing regular users from accessing this directory."
    rationale: "Granting write access to this directory for non-privileged users could provide them the means for gaining unauthorized elevated privileges. Granting read access to this directory could give an unprivileged user insight in how to gain elevated privileges or circumvent auditing controls."
    remediation: "- IF - cron is installed on the system: Run the following commands to set ownership and permissions on the /etc/cron.d directory: # chown root:root /etc/cron.d/ # chmod og-rwx /etc/cron.d/."
    level: "Level 1"
    compliance:
      - cis: ["2.4.1.7"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0: ["AC.L1-3.1.1", "AC.L1-3.1.2", "AC.L2-3.1.3", "AC.L2-3.1.5", "MP.L2-3.8.2"]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - iso_27001-2013: ["A.9.1.1"]
      - mitre_mitigations: ["M1018"]
      - mitre_tactics: ["TA0002", "TA0007"]
      - mitre_techniques: ["T1053", "T1053.003"]
      - nist_sp_800-53: ["AC-5", "AC-6"]
      - pci_dss_v3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_v4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    condition: all
    rules:
      - 'c:stat -Lc "%a %u %U %g %G" /etc/cron.d -> r:^700 0 root 0 root$'

# 2.4.1.8 Ensure crontab is restricted to authorized users. (Automated)
  - id: 107
    title: "Ensure crontab is restrited to authorized users."
    description: "Crontab is the program used to isntall, deinstall or list the tables used to drive the cron daemon. Each user can have their own crontab, and though these are files in /var/spool/cron/crontabs, they are not intended to be edited directly. If the /etc/cron.allow file exists, then you must be listed therin in order to be allowed to use this commande. If there is no /etc/cron.allow file, but the /etc/cron.deny file exist, then you must not be listed in the /etc/cron.deny file in order to use this command. If both file exist the /etc/cron.allow takes precedence. The file /etc/cron.allow and /etc/cron.deny, if they exist, must be either world-readable, or readable by group crontab. If they are not, then cron will deny access to all users until the permissions are fixed."
    rationale: "On many systems, only the system administrator is authorized to schedule cron jobs. Using the cron.allow file to control who can run cron jobs enforces this policy. It is easier to manage an allow list than a deny list. In a deny list, you could potentially add a user ID to the system and forget to add it to deny files."
    remediation: "IF cron is installed on the system : Create /etc/cron.allow if it doesn't exist, change owner to user root, change group owner to group root OR group crontab if it exists and change mode to 640 or more restrictive. IF /etc/cron.deny exists, change owner to user root, change owner to group root OR group crontab if it exists and change mode to 640 or more restrictive."
    level: "Level 1"
    compliance:
      - cis: ["2.4.1.8"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - nist_sp_800-53: ["AC-3", "MP-2"]
      - mitre_mitigations: ["M1018"]
      - mitre_tactics: ["TA0002"]
      - mitre_techniques: ["T1053", "T1053.003"]
    condition: all
    rules:
      - 'f:/etc/cron.allow'
      - 'c:stat -Lc "%a %U %G" /etc/cron.allow -> r:^640 root root$ || ^640 root crontab$ || ^600 root root$ || ^600 root crontab$ || ^400 root root$ || ^400 root crontab$'
      - 'not f:/etc/cron.deny'

# 2.4.2 - Configure at
#
#

# 2.4.2.1 Ensure at is restricted to authorized users. (Automated)
  - id: 108
    title: "Ensure at is restricted to authorized users."
    description: "at allow fairly complex time specifications, extending the POSIX.2 standard. It accepts times of the form HH:MM to run a job at a specific time of the day. You can also say what day the job will be run, by giving a date in the form month-name day with optional year, or giving a date of the form MMDD[CC]YY, MM/DD/[CC]YY, DD.MM.[CC]YY or [CC]YY-MM-DD. The /etc/at.allow and /etc/at.deny files determine which user can submit commands for later execution via at or batch. The format of the files is a list of usernames, one on each line. If /etc/at.allow does not exist, /etc/ad.deny is checked, every username not mentionned in it is then allowe to use at. An empty /etc/at.deny means that every user may use at. If neither file exists, only the superuser is allowed to use at."
    rationale: "On many systems, only the system administrator is authorized to schedule at jobs. Using the at.allow file to control who can run cron jobs enforces this policy. It is easier to manage an allow list than a deny list. In a deny list, you could potentially add a user ID to the system and forget to add it to deny files."
    remediation: "IF at is installed on the system: - /etc/at.allow: Create the file if it doesn't exist, change owner or user root, if group daemon exists, change to group daemon, else change group to root, change mode to 640 or more restrictive. IF /etc/at.deny exists: Change owner or user root, if group daemon exists, change to group daemon, else change group to root, change mode to 640 or more restrictive."
    level: "Level 1"
    compliance:
      - cis: ["2.4.2.1"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - nist_sp_800-53: ["AC-3", "MP-2"]
      - mitre_mitigations: ["M1018"]
      - mitre_tactics: ["TA0002"]
      - mitre_techniques: ["T1053", "T1053.003"]
    condition: all
    rules:
      - 'f:/etc/at.allow'
      - 'not f:/etc/at.deny'
      - 'c:stat -Lc "%a %U %G" /etc/at.allow -> r:^640 root root$ || ^640 root daemon$ || ^600 root root$ || ^600 root daemon$ || ^400 root root$ || ^400 root daemon$'

# 3 - Network
# 3.1 - Configure Network Devices
#
#

# 3.1.1 Ensure IPv6 status is identified. (Manual)
# Verify that IPv6 is enabled, change the value to 1 to verify that IPv6 is disabled. Consider modifying the rules in accordance with the IPv6 activation or deactivation site policy.
  - id: 109
    title: "Ensure IPv6 status is identified."
    description: "INFO: Verify that IPv6 is disabled, change the value to 0 to verify that IPv6 is enabled. IPv6 is the most recent version of IP. It's designed to supply IP addressing and additional security to support the predicted growth of connected devices. IPv6 is based on 128-bit addressing and can support 340 undecillion unique addresses."
    rationale: "IETF RFC 4038 recommends that applications are built with an assumption of dual stack. It is recommended that IPv6 be enabled and configured in accordance with Benchmark recommendations. IF - dual stack and IPv6 are not used in you environment, IPv6 may be disabled to reduce the attack surface of the system, and recommendations pertaining to IPv6 can be skipped."
    impact: "IETF RFC 4038 recommends that applications are built with an assumption of dual stack. When enabled, IPv6 will require additional configuration to reduce risk to the system."
    remediation: "Enable or disable IPv6 in accordance with system requirements and local site policy"
    level: "Level 1"
    compliance:
      - cis: ["3.1.1"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["9.2"]
      - nist_sp_800-53: ["CM-7"]
      - mitre_mitigations: ["M1042"]
      - mitre_tactics: ["TA0008"]
      - mitre_techniques: ["T157", "T1557.000", "T1595", "T1595.001", "T1595.002"]
    condition: any
    rules:
      - 'f:/sys/module/ipv6/parameters/disable -> r:^0$'
      - 'c:sysctl net.ipv6.conf.all.disable_ipv6 -> r:^net\.ipv6\.conf\.all\.disable_ipv6\s*=\s*0$'
      - 'c:sysctl net.ipv6.conf.default.disable_ipv6 -> r:^net\.ipv6\.conf\.default\.disable_ipv6\s*=\s*0$'
  
# 3.1.2 Ensure wireless interfaces are disabled. (Automated)
  - id: 110
    title: "Ensure wireless interfaces are disabled."
    description: "Wireless networking is used when wired networks are unavailable."
    rationale: "IF wireless is not to be used, wireless devices can be disabled to reduce the potential attack surface."
    impact: "Many if not all laptop workstations and som desktop workstations will connect via wireless requiring these interfaces be enabled."
    remediation: "Identify the kernel module for your wireless devie with # lspci -k. Create a file in /etc/modprobe.d/ ending in .conf. Then adding this following line # install <module_name> /bin/false # blacklist <module_name>. Finally, unload the module with modprobe -r <module_name>."
    level: "Level 1"
    compliance:
      - cis: ["3.1.2"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["15.4", "15.5"]
      - nist_sp_800-53: ["CM-7"]
      - mitre_mitigations: ["M1028"]
      - mitre_tactics: ["TA0010"]
      - mitre_techniques: ["T1011", "T1011.000", "T1595", "T1595.001", "T1595.002"]
    condition: all
    rules:
      - 'not c:lsmod -> r:iwlwifi|ath|ath9k|ath10k|brcmfmac|rt2x00|rtlwifi'

# 3.1.3 Ensure bluetooth services are not in use. (Automated)
  - id: 111
    title: "Ensure bluetooth services are not in use."
    description: "Bluetooth is a short-range wireless technology standard that is used for exchanging data between devices over short distances. It employs UHF radio waves in the ISM bands, from 2.402 GHz to 2.48 GHz. It is mainly used as an alternative to wire connections."
    rationale: "An attacker may be able to find a way to access or corrupt your data. One example of this type of activity is bluesnarfing, which refers to attackers using a Bluetooth connection to steal information off of your Bluetooth device. Also, viruses or other malicious code can take advantage of Bluetooth technology to infect other devices. If you are infected, your data may be corrupted, compromised, stolen, or lost."
    impact: "Many personal electronic devices (PEDs) use Bluetooth technology. For example, you may be able to operate your computer with a wireless keyboard. Disabling Bluetooth will prevent these devices from connecting to the system. There may be packages that are dependent on the bluez package. If the bluez package is removed, these dependent packages will be removed as well. Before removing the bluez package, review any dependent packages to determine if they are required on the system. -IF- a dependent package is required: stop and mask bluetooth.service leaving the bluez package installed."
    remediation: "Run the following commands to stop bluetooth.service, and remove the bluez package: # systemctl stop bluetooth.service # apt purge bluez - OR - - IF - the bluez package is required as a dependency: Run the following commands to stop and mask bluetooth.service: # systemctl stop bluetooth.service # systemctl mask bluetooth.service Note: A reboot may be required."
    references:
      - "https://www.cisa.gov/tips/st05-015"
    level: "Level 1"
    compliance:
      - cis: ["3.1.3"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["9.2"]
      - cmmc_v2.0: ["CM.L2-3.4.7", "CM.L2-3.4.8", "SC.L2-3.13.6"]
      - iso_27001-2013: ["A.13.1.3"]
      - mitre_mitigations: ["M1042"]
      - mitre_tactics: ["TA0010"]
      - mitre_techniques: ["T1011", "T1011.001"]
      - pci_dss_v3.2.1: ["1.1.6", "1.2.1", "2.2.2", "2.2.5"]
      - pci_dss_v4.0: ["1.2.5", "2.2.4", "6.4.1"]
      - soc_2: ["CC6.3", "CC6.6"]
    condition: any
    rules:
      - 'not c:dpkg-query -W -f="\${Status}" bluez -> r:install ok installed'
      - 'not c:systemctl is-enabled bluetooth.service -> r:^enabled$'
      - 'not c:systemctl is-active bluetooth.service" -> r:^active$'

# 3.2 - Configure Network Kernel Modules
#
#

# 3.2.1 Ensure dccp kernel module is not available. (Automated)
  - id: 112
    title: "Ensure dccp kernel module is not available."
    description: "The Datagram Congestion Control Protocol is a transport layer protocol that supports streaming media and telephony. DCCP provides a way to gain access to congestion control, without having to do it at the application layer, but does not provide in-sequence delivery."
    rationale: "IF the protocol is not required, it is recommend that the dirvers not be installed to reduce the potential attack surface."
    remediation: "Run the following script to unload and disable the dccp module: IF the dccp kernel module is available in ANY installed kernel: # Create a file ending in .conf with install dccp /bin/(false|true) in the /etc/modprobe.d/ directory. # Create a file ending in .conf with blacklist dccp in the /etc/modprobe.d/ directory. Run modprobe -r dccp 2>/dev/null; rmmod dccp 2>/dev/null to remove dccp from the kernel. IF the dccp kernel module is not available on the system, or pre-compiled into the kernel , no remediation is necessary."
    level: "Level 2"
    compliance:
      - cis: ["3.2.1"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["9.2"]
      - nist_sp_800-53: ["SI-4", "CM-7"]
      - mitre_mitigations: ["M1042"]
      - mitre_tactics: ["TA0008"]
      - mitre_techniques: ["T1068", "T1068.000", "T1210", "T1210.000"]
    condition: all
    rules:
      - 'c:modprobe -n -v dccp -> r:^\s*install\s+/bin/false | ^\s*install\s+/bin/true'
      - 'c:modprobe --showconfig | grep blacklist -> r:^\s*blacklist\s+dccp'
      - 'not c:lsmod -> r:^dccp\s'

# 3.2.2 Ensure tipc kernel module is not available. (Automated)
  - id: 113
    title: "Ensure tipc kernel module is not available."
    description: "The Transparent Inter-Process Communication protocol is designed to provide communication between cluster nodes."
    rationale: "IF the protocol is not required, it is recommend that the dirvers not be installed to reduce the potential attack surface."
    remediation: "Run the following script to unload and disable the tipc module: IF the tipc kernel module is available in ANY installed kernel: # Create a file ending in .conf with install tipc /bin/(false|true) in the /etc/modprobe.d/ directory. # Create a file ending in .conf with blacklist tipc in the /etc/modprobe.d/ directory. Run modprobe -r tipc 2>/dev/null; rmmod tipc 2>/dev/null to remove tipc from the kernel. IF the tipc kernel module is not available on the system, or pre-compiled into the kernel , no remediation is necessary."
    level: "Level 2"
    compliance:
      - cis: ["3.2.2"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["9.2"]
      - nist_sp_800-53: ["SI-4", "CM-7"]
      - mitre_mitigations: ["M1042"]
      - mitre_tactics: ["TA0008"]
      - mitre_techniques: ["T1068", "T1068.000", "T1210", "T1210.000"]
    condition: all
    rules:
      - 'c:modprobe -n -v tipc -> r:^\s*install\s+/bin/false | ^\s*install\s+/bin/true'
      - 'c:modprobe --showconfig | grep blacklist -> r:^\s*blacklist\s+tipc'
      - 'not c:lsmod -> r:^tipc\s'

# 3.2.3 Ensure rds kernel module is not available. (Automated)
  - id: 114
    title: "Ensure rds kernel module is not available."
    description: "The Reliable Datagram Sockets protocol is a transport layer protocol designed to provide low-latency, high-bandwidth communication between cluster nodes. It was developed by Oracle."
    rationale: "IF the protocol is not being used, it is recommended that kernel module not be loaded, disabling the service to reduce the potential attack surface."
    remediation: "Run the following script to unload and disable the rds module: IF the rds kernel module is available in ANY installed kernel: # Create a file ending in .conf with install rds /bin/(false|true) in the /etc/modprobe.d/ directory. # Create a file ending in .conf with blacklist rds in the /etc/modprobe.d/ directory. Run modprobe -r rds 2>/dev/null; rmmod rds 2>/dev/null to remove rds from the kernel. IF the rds kernel module is not available on the system, or pre-compiled into the kernel, no remediation is necessary."
    level: "Level 2"
    compliance:
      - cis: ["3.2.3"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["9.2"]
      - nist_sp_800-53: ["SI-4", "CM-7"]
      - mitre_mitigations: ["M1042"]
      - mitre_tactics: ["TA0008"]
      - mitre_techniques: ["T1068", "T1068.000", "T1210", "T1210.000"]
    condition: all
    rules:
      - 'c:modprobe -n -v rds -> r:^\s*install\s+/bin/false | ^\s*install\s+/bin/true'
      - 'c:modprobe --showconfig | grep blacklist -> r:^\s*blacklist\s+rds'
      - 'not c:lsmod -> r:^rds\s'

# 3.2.4 Ensure sctp kernel module is not available. (Automated)
  - id: 115
    title: "Ensure sctp kernel module is not available."
    description: "The Stream Control transmission Protocol is a transport layer protocol used to support messaged oriented communication, with several streams of message in one connection. It serves a similar function as TCP and UDP, incorporating features of both. It is message-oriented like UDP, and ensures reliable in-sequence transport of messages with congestion control like TCP."
    rationale: "IF the protocol is not being used, it is recommended that kernel module not be loaded, disabling the service to reduce the potential attack surface."
    remediation: "Run the following script to unload and disable the sctp module: IF the sctp kernel module is available in ANY installed kernel: # Create a file ending in .conf with install sctp /bin/(false|true) in the /etc/modprobe.d/ directory. # Create a file ending in .conf with blacklist sctp in the /etc/modprobe.d/ directory. Run modprobe -r sctp 2>/dev/null; rmmod sctp 2>/dev/null to remove sctp from the kernel. IF the sctp kernel module is not available on the system, or pre-compiled into the kernel, no remediation is necessary."
    level: "Level 2"
    compliance:
      - cis: ["3.2.3"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["9.2"]
      - nist_sp_800-53: ["SI-4", "CM-7"]
      - mitre_mitigations: ["M1042"]
      - mitre_tactics: ["TA0008"]
      - mitre_techniques: ["T1068", "T1068.000", "T1210", "T1210.000"]
    condition: all
    rules:
      - 'c:modprobe -n -v sctp -> r:^\s*install\s+/bin/false | ^\s*install\s+/bin/true'
      - 'c:modprobe --showconfig | grep blacklist -> r:^\s*blacklist\s+sctp'
      - 'not c:lsmod -> r:^sctp\s'

# 3.3 - Configure Network Kernel Parameters
#
#

# 3.3.1 Ensure ip forwarding is disabled. (Automated)
  - id: 116
    title: "Ensure ip forwarding is disabled."
    description: "The net.ipv4.ip_forward and net.ipv6.conf.all.forwarding flags are used to tell the system whether it can forward packets or not."
    rationale: Setting net.ipv4.ip_forward and net.ipv6.conf.all.forwarding to 0 ensures that a system with multiple interfaces (for example, a hard proxy), will never be able to forward packets, and therefore, never serve as a router.
    impact: "IP forwarding is required on systems configured to act as a router. If these parameters are disabled, the system will not be able to perform as a router. Many CSP hosted systems require IP forwarding to be enabled. If the system is running on a CSP platform, this requirement should be reviewed before disabling IP forwarding."
    remediation: "Set the following parameter in /etc/sysctl.conf or a file in /etc/sysctl.d/ ending in .conf (like network.conf): # net.ipv4.ip_forward = 0, # net.ipv6.conf.all.forwarding = 0."
    level: "Level 1"
    compliance:
      - cis: ["3.3.1"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["9.2"]
      - nist_sp_800-53: ["CM-1", "CM-2", "CM-6", "CM-7", "IA-5"]
      - mitre_mitigations: ["M1030", "M1042"]
      - mitre_tactics: ["TA006", "TA0009"]
      - mitre_techniques: ["T1557", "T1557.000"]
    condition: all
    rules:
      - 'c:sysctl net.ipv4.ip_forward -> r:^net\.ipv4\.ip_forward\s*=\s*0$'
      - 'c:sysctl net.ipv6.conf.all.forwarding -> r:^$net\.ipv6\.conf\.all\.forwarding\s*=\s*0'
      - 'f:/etc/sysctl.conf-> ignore:"file not found" && r:^[^#;]\s*net\.ipv4\.ip_forward\s*=\s*0$'
      - 'f:/etc/sysctl.d/network.conf -> r:^[^#;]\s*net\.ipv4\.ip_forward\s*=\s*0$'
      - 'f:/etc/sysctl.conf -> r:^[^#;]\s*net\.ipv6\.conf\.all\.forwarding\s*=\s*0$'
      - 'f:/etc/sysctl.d/network.conf -> r:^[^#;]\s*net\.ipv6\.conf\.all\.forwarding\s*=\s*0$'

# 3.3.2 Ensure packet redirect sending is disabled. (Automated)
  - id: 117
    title: "Ensure packet redirect sending is disabled."
    description: "ICMP redirects are used to send routing information to other hosts. As a host itself does not act as a router, there is no nedd to send redirects."
    rationale: "An attacker could use a compromised host to send invalid ICMP redirects to other router devices in an attempt to corrupt routing and have users access a system set up by the attacker as opposed to a valid system."
    impact: "IP forwarding is required on systems configured to act as router. If these parameters are disabled, the system will not be able to perform as a router."
    remediation: "Set the following parameters in /etc/sysctl.conf or a file in /etc/sysctl.d/ ending in .conf (like redirects.conf): # net.ipv4.conf.all.send_redirects = 0, # net.ipv4.conf.default.send_redirects = 0."
    level: "Level 1"
    compliance:
      - cis: ["3.2.2"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["9.2"]
      - nist_sp_800-53: ["CM-1", "CM-2", "CM-6", "CM-7", "IA-5"]
      - mitre_mitigations: ["M1030", "M1042"]
      - mitre_tactics: ["TA006", "TA0009"]
      - mitre_techniques: ["T1557", "T1557.000"]
    condition: all
    rules:
      - 'c:sysctl net.ipv4.conf.all.send_redirects -> r:^net\.ipv4\.conf\.all\.send_redirects\s*=\s*0$'
      - 'c:sysctl net.ipv4.conf.default.send_redirects -> r:^net\.ipv4\.conf\.default\.send_redirects\s*=\s*0$'
      - 'f:/etc/sysctl.conf -> r:^[^#;]\s*net\.ipv4\.conf\.all\.send_redirects\s*=\s*0$'
      - 'f:/etc/sysctl.d/network.conf -> r:^[^#;]\s*net\.ipv4\.conf\.all\.send_redirects\s*=\s*0$'
      - 'f:/etc/sysctl.conf -> r:^[^#;]\s*net\.ipv4\.conf\.default\.send_redirects\s*=\s*0$'
      - 'f:/etc/sysctl.d/network.conf -> r:^[^#;]\s*net\.ipv4\.conf\.default\.send_redirects\s*=\s*0$'

# 3.3.3 Ensure bogus icmp responses are ignored. (Automated)
  - id: 118
    title: "Ensure bogus icmp responses are ignored"
    description: "Setting net.ipv4.icmp_ignore_bogus_error_responses to 1 prevents the kernel from logging bogus responses (RFC-1122 non-compliant) from broadcast reframes, keeping file systems from filling up with useless log messages."
    rationale: "Some routers (and some attackers) will send responses that violate RFC-1122 and attempt to fill up a log file system with many useless error messages."
    remediation: "Set the following parameter in /etc/sysctl.conf or a file in /etc/sysctl.d/ ending in .conf (like network.conf): # net.ipv4.icmp_ignore_bogus_error_responses = 1."
    level: "Level 1"
    compliance:
      - cis: ["3.3.3"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["9.2"]
      - nist_sp_800-53: ["CM-1", "CM-2", "CM-6", "CM-7", "IA-5"]
      - mitre_mitigations: ["M1030", "M1042"]
      - mitre_tactics: ["TA0006", "TA0009"]
      - mitre_techniques: ["T1557", "T1557.000"]
    condition: all
    rules:
      - 'c:sysctl net.ipv4.icmp_ignore_bogus_error_responses -> r:^net\.ipv4\.icmp_ignore_bogus_error_responses\s*=\s*1$'
      - 'f:/etc/sysctl.conf -> r:^[^#;]\s*net\.ipv4\.icmp_ignore_bogus_error_responses\s*=\s*1$'
      - 'f:/etc/sysctl.d/network.conf -> r:^[^#;]\s*net\.ipv4\.icmp_ignore_bogus_error_responses\s*=\s*1$'

# 3.3.4 Ensure broadcast icmp request are ignored. (Automated)
  - id: 119
    title: "Ensure broadcast icmp request are ignored."
    description: "Setting net.ipv4.icmp_echo_ignore_broadcasts to 1 will cause the system to ignore all ICMP echo and timestamp requests to broadcast and multicast addresses."
    rationale: "Accepting ICMP echo and timestamp requests with broadcast or multicast destinations for your network could be used to trick your host into starting (or participating) in a Smurf attack. A Smurf attack relies on an attacker sending large amounts of ICMP broadcast messages with a spoofed source address. All hosts receiving this message and responding would send echo-reply messages back to the spoofed address, which is probably not routable. If many hosts respond to the packets, the amount of traffic on the network could be significantly multiplied."
    remediation: "Set the following parameter in /etc/sysctl.conf or a file in /etc/sysctl.d/ ending in .conf (like network.conf): # net.ipv4.icmp_echo_ignore_broadcasts = 1."
    level: "Level 1"
    compliance:
      - cis: ["3.3.4"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["9.2"]
      - nist_sp_800-53: ["CM-1", "CM-2", "CM-6", "CM-7", "IA-5"]
      - mitre_mitigations: ["M1037"]
      - mitre_tactics: ["TA0040"]
      - mitre_techniques: ["T1497", "T1498.001"]
    condition: all
    rules: 
      - 'c:sysctl net.ipv4.icmp_echo_ignore_broadcasts -> r:^net\.ipv4\.icmp_echo_ignore_broadcasts\s*=\s*1$'
      - 'f:/etc/sysctl.conf -> r:^[^#;]\s*net\.ipv4\.icmp_echo_ignore_broadcasts\s*=\s*1$'
      - 'f:/etc/sysctl.d/network.conf -> r:^[^#;]\s*net\.ipv4\.icmp_echo_ignore_broadcasts\s*=\s*1$'

# 3.3.5 Ensure icmp redirects are not accepted. (Automated)
  - id: 120
    title: "Ensure icmp redirects are not accepted."
    description: "ICMP redirect messages are packets that convey routing information and tell your host (acting as a router) to send packets via an alternate path. It is a way of allowing an outside routing device to update your system routing tables."
    rationale: "ICMP redirect messages are packets that convey routing information and tell your host (acting as a router) to send packets via an alternate path. It is a way of allowing an outside routing device to update your system routing tables. By setting net.ipv4.conf.all.accept_redirects, net.ipv4.conf.default.accept_redirects, net.ipv6.conf.all.accept_redirects, and net.ipv6.conf.default.accept_redirects to 0, the system will not accept any ICMP redirect messages, and therefore, won't allow outsiders to update the system's routing tables."
    remediation: "Set the following parameters in /etc/sysctl.conf or a file in /etc/sysctl.d/ ending in .conf (like network.conf): # net.ipv4.conf.all.accept_redirects = 0, # net.ipv4.conf.default.accept_redirects = 0."
    level: "Level 1"
    compliance:
      - cis: ["3.3.5"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["9.2"]
      - nist_sp_800-53: ["CM-1", "CM-2", "CM-6", "CM-7", "IA-5"]
      - mitre_mitigations: ["M1030", "M1042"]
      - mitre_tactics: ["TA0006", "TA0009"]
      - mitre_techniques: ["T1557", "T1557.000"]
    condition: all
    rules:
      - 'c:sysctl net.ipv4.conf.all.accept_redirects -> r:^net\.ipv4\.conf\.all\.accept_redirects\s*=\s*0$'
      - 'c:sysctl net.ipv4.conf.default.accept_redirects -> r:^net\.ipv4\.conf\.default\.accept_redirects\s*=\s*0$'
      - 'c:sysctl net.ipv6.conf.all.accept_redirects -> r:^net\.ipv6\.conf\.all\.accept_redirects\s*=\s*0$'
      - 'c:sysctl net.ipv6.conf.default.accept_redirects -> r:^net\.ipv6\.conf\.default\.accept_redirects\s*=\s*0$'
      - 'f:/etc/sysctl.conf -> r:^[^#;]\s*net\.ipv4\.conf\.all\.accept_redirects\s*=\s*0$'
      - 'f:/etc/sysctl.d/network.conf -> r:^[^#;]\s*net\.ipv4\.conf\.all\.accept_redirects\s*=\s*0$'
      - 'f:/etc/sysctl.conf -> r:^[^#;]\s*net\.ipv4\.conf\.default\.accept_redirects\s*=\s*0$'
      - 'f:/etc/sysctl.d/network.conf -> r:^[^#;]\s*net\.ipv4\.conf\.default\.accept_redirects\s*=\s*0$'
      - 'f:/etc/sysctl.conf -> r:^[^#;]\s*net\.ipv6\.conf\.all\.accept_redirects\s*=\s*0$'
      - 'f:/etc/sysctl.d/network.conf -> r:^[^#;]\s*net\.ipv6\.conf\.all\.accept_redirects\s*=\s*0$'
      - 'f:/etc/sysctl.conf -> r:^[^#;]\s*net\.ipv6\.conf\.default\.accept_redirects\s*=\s*0$'
      - 'f:/etc/sysctl.d/network.conf -> r:^[^#;]\s*net\.ipv6\.conf\.default\.accept_redirects\s*=\s*0$'

# 3.3.6 Ensure secure icmp redirects are not accepted. (Automated)
  - id: 121
    title: "Ensure secure icmp redirects are not accepted."
    description: "Secure ICMP redirects are the same as ICMP redirects, except they come from gateways listed on the default gateway list. It is assumed that these gateways are known to your system, and that they are likely to be secure."
    rationale: "It is still possible for even known gateways to be compromised. Setting net.ipv4.conf.all.secure_redirects and net.ipv4.conf.default.secure_redirects to 0 protects the system from routing table updates by possibly compromised known gateways"
    remediation: "Set the following parameters in /etc/sysctl.conf or a file in /etc/sysctl.d/ ending in .conf (like network.conf): # net.ipv4.conf.all.secure_redirects = 0 # net.ipv4.conf.default.secure_redirects = 0"
    level: "Level 1"
    compliance:
      - cis: ["3.3.6"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["9.2"]
      - nist_sp_800-53: ["CM-1", "CM-2", "CM-6", "CM-7", "IA-5"]
      - mitre_mitigations: ["M1030", "M1042"]
      - mitre_tactics: ["TA0006", "TA0009"]
      - mitre_techniques: ["T1557", "T1557.000"]
    condition: all
    rules:
      - 'c:sysctl net.ipv4.conf.all.secure_redirects -> r:^net\.ipv4\.conf\.all\.secure_redirects\s*=\s*1$'
      - 'c:sysctl net.ipv4.conf.default.secure_redirects -> r:^net\.ipv4\.conf\.default\.secure_redirects\s*=\s*1$'
      - 'f:/etc/sysctl.conf -> r:^[^#;]\s*net\.ipv4\.conf\.all\.secure_redirects\s*=\s*1$'
      - 'f:/etc/sysctl.d/network.conf -> r:^[^#;]\s*net\.ipv4\.conf\.all\.secure_redirects\s*=\s*1$'
      - 'f:/etc/sysctl.conf -> r:^[^#;]\s*net\.ipv4\.conf\.default\.secure_redirects\s*=\s*1$'
      - 'f:/etc/sysctl.d/network.conf -> r:^[^#;]\s*net\.ipv4\.conf\.default\.secure_redirects\s*=\s*1$'

# 3.3.7 Ensure reverse path filtering is enabled. (Automated)
  - id: 122
    title: "Enure reverse path filtering is enabled."
    description: "Setting net.ipv4.conf.all.rp_filter and net.ipv4.conf.default.rp_filter to 1 forces the Linux kernel to utilize reverse path filtering on a received packet to determine if the packet was valid. Essentially, with reverse path filtering, if the return packet does not go out the same interface that the corresponding source packet came from, the packet is dropped (and logged if log_martians is set)."
    rationale: "Setting net.ipv4.conf.all.rp_filter and net.ipv4.conf.default.rp_filter to 1 is a good way to deter attackers from sending your system bogus packets that cannot be responded to. One instance where this feature breaks down is if asymmetrical routing is employed. This would occur when using dynamic routing protocols (bgp, ospf, etc) on your system. If you are using asymmetrical routing on your system, you will not be able to enable this feature without breaking the routing."
    impact: "If you are using asymmetrical routing on your system, you will not be able to enable this feature without breaking the routing."
    remediation: "Set the following parameters in /etc/sysctl.conf or a file in /etc/sysctl.d/ ending in .conf (like network.conf): # net.ipv4.conf.all.rp_filter = 1 # net.ipv4.conf.default.rp_filter = 1"
    level: "Level 1"
    compliance:
      - cis: ["3.3.7"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["9.2"]
      - nist_sp_800-53: ["CM-1", "CM-2", "CM-6", "CM-7", "IA-5"]
      - mitre_mitigations: ["M1030", "M1042"]
      - mitre_tactics: ["TA0006", "TA0009"]
      - mitre_techniques: ["T1557", "T1557.000"]
    condition: all
    rules:
      - 'c:sysctl net.ipv4.conf.all.rp_filter -> r:^net\.ipv4\.conf\.all\.rp_filter\s*=\s*1$'
      - 'c:sysctl net.ipv4.conf.default.rp_filter -> r:^net\.ipv4\.conf\.default\.rp_filter\s*=\s*1$'
      - 'f:/etc/sysctl.conf -> r:^[^#;]\s*net\.ipv4\.conf\.all\.rp_filter\s*=\s*1$'
      - 'f:/etc/sysctl.conf -> r:^[^#;]\s*net\.ipv4\.conf\.default\.rp_filter\s*=\s*1$'
      - 'f:/etc/sysctl.d/network.conf -> r:^[^#;]\s*net\.ipv4\.conf\.all\.rp_filter\s*=\s*1$'
      - 'f:/etc/sysctl.d/network.conf -> r:^[^#;]\s*net\.ipv4\.conf\.default\.rp_filter\s*=\s*1$'

# 3.3.8 Ensure source routed packets are not accepted. (Automated)
  - id: 123
    title: "Enure source routed packets are not accepted."
    description: "In networking, source routing allows a sender to partially or fully specify the route packets take through a network. In contrast, non-source routed packets travel a path determined by routers in the network. In some cases, systems may not be routable or reachable from some locations (e.g. private addresses vs. Internet routable), and so source routed packets would need to be used."
    rationale: "Setting net.ipv4.conf.all.accept_source_route, net.ipv4.conf.default.accept_source_route, net.ipv6.conf.all.accept_source_route and net.ipv6.conf.default.accept_source_route to 0 disables the system from accepting source routed packets. Assume this system was capable of routing packets to Internet routable addresses on one interface and private addresses on another interface. Assume that the private addresses were not routable to the Internet routable addresses and vice versa. Under normal routing circumstances, an attacker from the Internet routable addresses could not use the system as a way to reach the private address systems. If, however, source routed packets were allowed, they could be used to gain access to the private address systems as the route could be specified, rather than rely on routing protocols that did not allow this routing."
    remediation: "Set the following parameters in /etc/sysctl.conf or a file in /etc/sysctl.d/ ending in .conf (like network.conf): # net.ipv4.conf.all.accept_source_route = 0, # net.ipv4.conf.default.accept_source_route = 0"
    level: "Level 1"
    compliance:
      - cis: ["3.3.8"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["9.2"]
      - nist_sp_800-53: ["CM-1", "CM-2", "CM-6", "CM-7", "IA-5"]
      - mitre_mitigations: [""]
      - mitre_tactics: ["TA0007"]
      - mitre_techniques: ["T1590", "T1590.005"]
    condition: all
    rules:
      - 'c:sysctl net.ipv4.conf.all.accept_source_route -> r:^net\.ipv4\.conf\.all\.accept_source_route\s*=\s*0$'
      - 'c:sysctl net.ipv4.conf.default.accept_source_route -> r:^net\.ipv4\.conf\.default\.accept_source_route\s*=\s*0$'
      - 'c:net.ipv6.conf.all.accept_source_route -> r:^net\.ipv6\.conf\.all\.accept_source_route\s*=\s*0$'
      - 'c:net.ipv6.conf.default.accept_source_route -> r:^net\.ipv6\.conf\.default\.accept_source_route\s*=\s*0$'
      - 'f:/etc/sysctl.conf -> r:^[^#;]\s*net\.ipv4\.conf\.all\.accept_source_route\s*=\s*0$'
      - 'f:/etc/sysc.conf -> r:^[^#;]\s*net\.ipv4\.conf\.default\.accept_source_route\s*=\s*0$'
      - 'f:/etc/sysctl.d/network.conf -> r:^[^#;]\s*net\.ipv4\.conf\.all\.accept_source_route\s*=\s*0$'
      - 'f:/etc/sysctl.d/network.conf -> r:^[^#;]\s*net\.ipv4\.conf\.default\.accept_source_route\s*=\s*0$'
      - 'f:/etc/sysctl.conf -> r:^[^#;]\s*net\.ipv6\.conf\.all\.accept_source_route\s*=\s*0$'
      - 'f:/etc/sysc.conf -> r:^[^#;]\s*net\.ipv6\.conf\.default\.accept_source_route\s*=\s*0$'
      - 'f:/etc/sysctl.d/network.conf -> r:^[^#;]\s*net\.ipv6\.conf\.all\.accept_source_route\s*=\s*0$'
      - 'f:/etc/sysctl.d/network.conf -> r:^[^#;]\s*net\.ipv6\.conf\.default\.accept_source_route\s*=\s*0$'

# 3.3.9 Ensure suspicious packets are logged. (Automated)
  - id: 124
    title: "Ensure suspicious packets are logged."
    description: "When enabled, this feature logs packets with un-routable source addresses to the kernel log."
    rationale: "Setting net.ipv5.conf.all.log_martians and net.ipv4.conf.default.log_martians to 1 enables this feature. Logging these packets allow an administrator to investigate the possibility that an attacker is sending spoofed packets to their system."
    remediation: "Set the following parameters in /etc/sysctl.conf or a file in /etc/sysctl.d/ ending in .conf (like network.conf): # net.ipv4.conf.all.log_martians = 1, # net.ipv4.conf.default.log_martians = 1"
    level: "Level 1"
    compliance:
      - cis: ["3.3.9"]
      - cis_csc_v8: ["8.5"]
      - cis_csc_v7: ["6.2", "6.3"]
      - nist_sp_800-53: ["AU-3"]
      - mitre_mitigations: [""]
      - mitre_tactics: ["TA005"]
      - mitre_techniques: ["T1562", "T1562.006"]
    condition: all
    rules:
      - 'c:sysctl net.ipv4.conf.all.log_martians -> r:^net\.ipv4\.conf\.all\.log_martians\s*=\s=*1$'
      - 'c:sysctl net.ipv4.conf.default.log_martians -> r:^net\.ipv4\.conf\.default\.log_martians\s*=\s*1$'
      - 'f:/etc/sysctl.conf -> r:^[^#;]\s*net\.ipv4\.conf\.all\.log_martians\s*=\s=*1$'
      - 'f:/etc/sysctl.conf -> r:^[^#;]\s*net\.ipv4\.conf\.default\.log_martians\s*=\s*1$'
      - 'f:/etc/sysctl.d/network.conf -> r:^[^#;]\s*net\.ipv4\.conf\.all\.log_martians\s*=\s=*1$'
      - 'f:/etc/sysctl.d/network.conf -> r:^[^#;]\s*net\.ipv4\.conf\.default\.log_martians\s*=\s*1$'

# 3.3.10 Ensure tcp syn cookies is enabled. (Automated)
  - id: 125
    title: "Ensure tcp syn cookies is enabled."
    description: "When tcp_syncookies is set, the kernel will handle TCP SYN packets normally until the half-open connection queue is full, at which time, the SYN cookie functionality kicks in. SYN cookies work by not using the SYN queue at all. Instead, the kernel simply replies to the SYN with a SYN/ACK, but will include a specially crafted TCP sequence number that encodes the source and destination IP address and port number and the time the packet was sent. A legitimate connection would send the ACK packet of the three way handshake with the specially crafted sequence number. This allows the system to verify that it has received a valid response to a SYN cookie and allow the connection, even though there is no corresponding SYN in the queue."
    rationale: "Attackers use SYN flood attacks to perform a denial of service attacked on a system by sending many SYN packets without completing the three way handshake. This will quickly use up slots in the kernel's half-open connection queue and prevent legitimate connections from succeeding. Setting net.ipv4.tcp_syncookies to 1 enables SYN cookies, allowing the system to keep accepting valid connections, even if under a denial of service attack."
    remediation: "Set the following parameter in /etc/sysctl.conf or a file in /etc/sysctl.d/ ending in .conf (like network.conf): # net.ipv4.tcp_syncookies = 1"
    level: "Level 1"
    compliance:
      - cis: ["3.3.10"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["9.2"]
      - nist_sp_800-53: ["CM-1", "CM-2", "CM-6", "CM-7", "IA-5"]
      - mitre_mitigations: ["M1037"]
      - mitre_tactics: ["TA0040"]
      - mitre_techniques: ["T1499", "T1499.001"]
    condition: all
    rules:
      - 'c:sysctl net.ipv4.tcp_syncookies -> r:^net\.ipv4\.tcp_syncookies\s*=\s*1$'
      - 'f:/etc/sysc.conf -> r:^[^#;]\s*net\.ipv4\.tcp_syncookies\s*=\s*1$'
      - 'f:/etc/sysctl.d/network.conf -> r:^[^#;]\s*net\.ipv4\.tcp_syncookies\s*=\s*1$'

# 3.3.11 Ensure IPv6 router advertisements are not accepted. (Automated)
  - id: 126
    title: "Ensure IPv6 router advertisements are not accepted."
    description: "Routers periodically multicast Router Advertisement messages to announce their availability and convey information to neighboring nodes that enable them to be automatically configured on the network. net.ipv6.conf.all.accept_ra and net.ipv6.conf.default.accept_ra determine the systems ability to accept these advertisements"
    rationale: "It is recommended that systems do not accept router advertisements as they could be tricked into routing traffic to compromised machines. Setting hard routes within the system (usually a single default route to a trusted router) protects the system from bad routes. Setting net.ipv6.conf.all.accept_ra and net.ipv6.conf.default.accept_ra to 0 disables the system's ability to accept IPv6 router advertisements."
    remediation: "IF IPv6 is enabled on the system: Set the following parameters in /etc/sysctl.conf or a file in /etc/sysctl.d/ ending in .conf (like network.conf): # net.ipv6.conf.all.accept_ra = 0 # net.ipv6.conf.default.accept_ra = 0"
    level: "Level 1"
    compliance:
      - cis: ["3.3.11"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["9.2"]
      - nist_sp_800-53: ["CM-1", "CM-2", "CM-6", "CM-7", "IA-5"]
      - mitre_mitigations: ["M1030", "M1042"]
      - mitre_tactics: ["TA0006", "TA0040"]
      - mitre_techniques: ["T1557", "T1557.000"]      
    condition: all
    rules:
      - 'c:sysctl net.ipv6.conf.all.accept_ra -> r:^net\.ipv6\.conf\.all\.accept_ra\s*=\s*0$'
      - 'c:sysctl net.ipv6.conf.default.accept_ra -> r:^net\.ipv6\.conf\.default\.accept_ra\s*=\s*0$'
      - 'f:/etc/sysctl.conf -> r:^net\.ipv6\.conf\.all\.accept_ra\s*=\s*0$'
      - 'f:/etc/sysctl.conf -> r:^net\.ipv6\.conf\.default\.accept_ra\s*=\s*0$'
      - 'f:/etc/sysctl.d/network.conf -> r:^net\.ipv6\.conf\.all\.accept_ra\s*=\s*0$'
      - 'f:/etc/sysctl.d/network.conf -> r:^net\.ipv6\.conf\.default\.accept_ra\s*=\s*0$'
      
# 4 - Host Based Firewall
# 4.1 - Configure a signle firewall utility
#
#

# 4.1.1 Ensure a single firewall configuration utility is in use. (Automated)
# Following security recommendations and given the obsolescence of IPTables, the test focuses on verifying that NFTables is indeed the only firewall used. This can be modified for UFW or IPTables.
  - id: 127
    title: "Ensure a signle firewall configuration utility is in use."
    description: "In Linux security, employing a single, effective firewall configuration utility ensures that only legitimate traffic gets processed, reducing the system’s exposure to potential threats. The choice between ufw, nftables, and iptables depends on organizational needs."
    rationale: "Proper configuration of a single firewall utility minimizes cyber threats and protects services and data, while avoiding vulnerabilities like open ports or exposed services. Standardizing on a single tool simplifies management, reduces errors, and fortifies security across Linux systems."
    impact: "The use of more than one firewall utility may produce unexpected results."
    remediation: "Remediating to a single firewall configuration is a complex process and involves several steps. The following provides the basic steps to follow for a single firewall configuration: 1. Determine which firewall utility best fits organizational needs 2. Follow the recommendations in the subsequent subsection for the single firewall to be used. 3. Return to this recommendation to ensure a single firewall configuration utility is in use"
    level: "Level 1"
    references:
      - "https://wiki.debian.org/DebianFirewall"
      - "https://wiki.ubuntu.com/UncomplicatedFirewall"
      - "https://assets.ubuntu.com/v1/544d9904-ubuntu-server-guide-2024-01-22.pdf"
      - "https://www.debian.org/doc/manuals/debian-reference/debian-reference.en.pdf"
    compliance:
      - cis: ["4.1.1"]
      - cis_csc_v8: ["4.4", "4.5"]
      - cis_csc_v7: ["9.4"]
      - mitre_mitigations: ["M1031", "M1037"]
      - mitre_tactics: ["TA0011"]
      - mitre_techniques: ["T1562", "T1562.004"]
    condition: all
    rules:
      - 'c:sh -c "
          {
            systemctl is-active ufw;
            systemctl is-enabled ufw;
            systemctl is-active nftables;
            systemctl is-enabled nftables;
            systemctl is-active iptables;
            systemctl is-enabled iptables;
          } 2>/dev/null | grep -E ''^(active|enabled)$'' | wc -l
        " -> r:^2$'

# 4.2 - Configure UncomplicatedFirewall
#
#

# 4.2.1 Ensure ufw is installed. (Automated)
  - id: 128
    title:  "Ensure ufw is installed."
    description: "The Uncomplicated Firewall (ufw) is a frontend for iptables and is particularly well-suited for host-based firewalls. ufw provides a framework for managing netfilter, as well as a command-line interface for manipulating the firewall."
    rationale: "A firewall utility is required to configure the Linux kernel's netfilter framework via the iptables or nftables back-end. The Linux kernel's netfilter framework host-based firewall can protect against threats originating from within a corporate network to include malicious mobile code and poorly configured software on a host. Note: Only one firewall utility should be installed and configured. UFW is dependent on the iptables package"
    remediation: "Run the following command to install UFC: # apt install ufw"
    level: "Level 1"
    compliance:
      - cis: ["4.2.1"]
      - cis_csc_v8: ["4.4", "4.5"]
      - cis_csc_v7: ["9.4"]
      - nist_sp_800-53: ["SC-7"]
      - mitre_mitigations: ["M1031", "M1037"]
      - mitre_tactics: ["TA0011"]
      - mitre_techniques: ["T1562", "T1562.004"]
    condition: all
    rules:
      - 'c:dpkg-query -W -f="\${Status}" ufw -> r:^install ok installed$'

# 4.2.2 Ensure iptables-persistent is not installed with UFW. (Automated)
  - id: 129
    title: "Ensure iptables-persistent is not installed with UFW."
    description: "The iptables-persistent is a boot-time loader for netfilter rules, iptables plugin."
    rationale: "Running bot ufw and the services included in the iptables-persistent package may lead to conflict."
    remediation: "Run the following command to remove the iptables-persistent package: # apt purge iptables-persistent"
    level: "Level 1"
    compliance:
      - cis: ["4.2.2"]
      - cis_csc_v8: ["4.4", "4.5"]
      - cis_csc_v7: ["9.4"]
      - nist_sp_800-53: ["SC-7"]
      - mitre_mitigations: ["M1033"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1562", "T1562.004"]
    condition: all
    rules:
      - 'not c:dpkg-query -W -f="\${Status}" iptables-persistent -> r:^install ok installed$'

# 4.2.3 Ensure UFW is enabled. (Automated)
  - id: 130
    title: "Ensure UFW service is enabled."
    description: "UncomplicatedFirewall (ufw) is a frontend for iptables. ufw provides a framework for managing netfilter, as well as a command-line and available graphical user interface for manipulating the firewall."
    rationale: "The UFW service must be enabled and running in order for UFW to protect the system."
    impact: "Changing firewall settings while connected over network can result in being locked out of the system."
    remediation: "Rune the following command to unmask the UFW daemon: # systemctl unmask ufw.service. Run the following command to enable and start the ufw daemon:# systemctl --now enable ufw.service. Run the following command to enable ufw: # ufw enable."
    level: "Level 1"
    references:
      - "http://manpages.ubuntu.com/manpages/precise/en/man8/ufw.8.html"
    compliance:
      - cis: ["4.2.3"]
      - cis_csc_v8: ["4.4", "4.5"]
      - cis_csc_v7: ["9.4"]
      - nist_sp_800-53: ["SC-7"]
      - mitre_mitigations: ["M1018"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1562", "T1562.004"]
    condition: all
    rules:
      - 'c:systemctl is-enabled ufw.service -> r:^enabled$'
      - 'c:systemctl is-active ufw -> r:^active$'

# 4.2.4 Ensure UFW loopback traffic is configured. (Automated)
  - id: 131
    title: "Ensure UFW loopback is configured."
    description: "Configure the loopback interface to accept traffic. Configure all other interfaces to deny traffic to the loopback network (127.0.0.0/8 for IPv4 and ::1/128 for IPv6)."
    rationale: "Loopback traffic is generated between processes on machine and is typically critical to operation of the system. The loopback interface is the only place that loopback network (127.0.0.0/8 for IPv4 and ::1/128 for IPv6) traffic should be seen, all other interfaces should ignore traffic on this network as an anti-spoofing measure."
    remediation: "Run the following commands to configure the loopback interface to accept traffic: # ufw allow in on lo, # ufw allow out on lo. Run the following commands to configure all other interfaces to deny traffic to the loopback network: # ufw deny in from 127.0.0.0/8, # ufw deny in from ::1"
    level: "Level 1" 
    references:
      - "https://manpages.ubuntu.com/manpages/jammy/en/man8/ufw-framework.8.html"
    compliance:
      - cis: ["4.2.4"]
      - cis_csc_v8: ["4.4", "4.5"]
      - cis_csc_v7: ["9.4"]
      - nist_sp_800-53: ["SC-7"]
      - mitre_mitigations: ["M1031", "M1037"]
      - mitre_tactics: ["TA0011"]
      - mitre_techniques: ["T1562", "T1562.004"]
    condition: all
    rules:
      - 'f:/etc/ufw/before.rules -> r:^[^#;]\s*-A\s*ufw-before-input\s*-i\s*lo\s*-j\s*ACCEPT$'
      - 'f:/etc/ufw/before.rules -> r:^[^#;]\s*-A\s+ufw-before-output\s+-o\s+lo\s+-j\s+ACCEPT'
      - 'c:ufw status verbose -> r:^\s*127\.0\.0\.0/8\s+DENY IN\s+Anywhere$'
      - 'c:ufw status verbose -> r:^\s*::1\s+DENY IN\s+Anywhere\s+\(v6\)$'

# 4.2.5 Ensure UFW outbound connections are configured. (Manual)
  - id: 132
    title: "Ensure UFW outbound connections are configured."
    description: "Configure the firewall rules for new outbound connections."
    rationale: "If rules are not in place for new outbound connections all packets will be dropped by the default policy preventing network usage."
    remediation: "Configure ufw in accordance with site policy. The following commands will implement a policy to allow all outbound connections on all interfaces: # ufw allow out on all"
    level: "Level 1"
    compliance: 
    condition:
    rules: